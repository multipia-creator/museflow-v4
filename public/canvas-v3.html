<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas - MuseFlow</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* ===============================================
           MuseFlow Canvas V3 - Hybrid UX
           Floating Toolbar + Role-based Widget System
           =============================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            /* Colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F5F5F5;
            --bg-tertiary: #FAFAFA;
            
            --border-primary: #E5E5E5;
            --border-secondary: #DADADA;
            --border-hover: #C4C4C4;
            
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            
            --accent-primary: #8B5CF6;
            --accent-hover: #7C3AED;
            --accent-light: #EDE9FE;
            
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 8px 32px rgba(0, 0, 0, 0.16);
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 24px;
            
            /* Animation */
            --transition-fast: 0.15s ease;
            --transition-base: 0.2s ease;
            --transition-slow: 0.3s ease;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ===============================================
           Layout
           =============================================== */
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }
        
        /* Top Toolbar - Minimalist */
        .top-toolbar {
            height: 48px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-lg);
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }
        
        .logo {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .project-info {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .save-status {
            font-size: 12px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }
        
        /* Left Panel - Role-based Widget Palette */
        .left-panel {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-slow);
            z-index: 50;
        }
        
        .left-panel.collapsed {
            transform: translateX(-100%);
        }
        
        .panel-toggle {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 80px;
            background: var(--bg-primary);
            border: 1px solid var(--border-primary);
            border-left: none;
            border-radius: 0 8px 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-base);
            z-index: 60;
        }
        
        .panel-toggle:hover {
            background: var(--bg-secondary);
            width: 28px;
        }
        
        .left-panel.collapsed + .panel-toggle {
            left: 0;
        }
        
        /* Role Selector */
        .role-selector {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-primary);
        }
        
        .role-dropdown {
            width: 100%;
            height: 40px;
            padding: 0 var(--space-md);
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            outline: none;
            transition: all var(--transition-base);
        }
        
        .role-dropdown:hover {
            border-color: var(--accent-primary);
        }
        
        /* Widget Palette */
        .widget-palette {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }
        
        .widget-group {
            margin-bottom: var(--space-xl);
        }
        
        .group-header {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            margin-bottom: var(--space-md);
        }
        
        .widget-item {
            height: 48px;
            padding: 0 var(--space-md);
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: var(--space-md);
            cursor: grab;
            margin-bottom: var(--space-sm);
            transition: all var(--transition-base);
        }
        
        .widget-item:hover {
            background: var(--bg-primary);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }
        
        .widget-item:active {
            cursor: grabbing;
        }
        
        .widget-icon {
            width: 20px;
            height: 20px;
            color: var(--accent-primary);
            flex-shrink: 0;
        }
        
        .widget-info {
            flex: 1;
        }
        
        .widget-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .widget-desc {
            font-size: 11px;
            color: var(--text-tertiary);
        }
        
        /* Canvas Container */
        .canvas-container {
            flex: 1;
            position: relative;
            background: var(--bg-secondary);
            overflow: hidden;
        }
        
        #canvas {
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        
        #canvas:active {
            cursor: grabbing;
        }
        
        #nodes-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }
        
        #nodes-container > * {
            pointer-events: auto;
        }
        
        /* Canvas Node */
        .canvas-node {
            position: absolute;
            width: 200px;
            min-height: 100px;
            background: var(--bg-primary);
            border: 2px solid var(--border-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            cursor: move;
            transition: all var(--transition-base);
        }
        
        .canvas-node:hover {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-lg);
        }
        
        .canvas-node.selected {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }
        
        .node-header {
            padding: var(--space-md);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .node-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .node-body {
            padding: var(--space-md);
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Connection Handles */
        .node-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--bg-primary);
            border: 2px solid var(--accent-primary);
            border-radius: 50%;
            cursor: crosshair;
            transition: all var(--transition-base);
            opacity: 0;
        }
        
        .canvas-node:hover .node-handle {
            opacity: 1;
        }
        
        .node-handle:hover {
            transform: scale(1.5);
            box-shadow: 0 0 0 3px var(--accent-light);
        }
        
        .node-handle.top { top: -6px; left: 50%; transform: translateX(-50%); }
        .node-handle.right { right: -6px; top: 50%; transform: translateY(-50%); }
        .node-handle.bottom { bottom: -6px; left: 50%; transform: translateX(-50%); }
        .node-handle.left { left: -6px; top: 50%; transform: translateY(-50%); }
        
        /* Floating Toolbar - Figma Style */
        .floating-toolbar {
            position: absolute;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: var(--space-sm);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            z-index: 1000;
        }
        
        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: var(--border-primary);
            margin: 0 var(--space-xs);
        }
        
        .toolbar-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            color: var(--text-secondary);
        }
        
        .toolbar-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .toolbar-btn.active {
            background: var(--accent-light);
            color: var(--accent-primary);
        }
        
        .toolbar-btn-primary {
            height: 36px;
            padding: 0 var(--space-lg);
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all var(--transition-base);
        }
        
        .toolbar-btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .zoom-display {
            min-width: 56px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        /* Right Panel - Properties */
        .right-panel {
            width: 280px;
            background: var(--bg-primary);
            border-left: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-slow);
            z-index: 50;
        }
        
        .right-panel.collapsed {
            transform: translateX(100%);
        }
        
        .panel-header {
            height: 48px;
            padding: 0 var(--space-lg);
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-primary);
            font-size: 13px;
            font-weight: 600;
        }
        
        .properties-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
        }
        
        .empty-state {
            text-align: center;
            padding: var(--space-xl) 0;
            color: var(--text-tertiary);
            font-size: 13px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .left-panel,
            .right-panel {
                position: absolute;
                height: calc(100vh - 48px);
                z-index: 100;
            }
            
            .floating-toolbar {
                bottom: 16px;
                padding: var(--space-xs);
            }
            
            .toolbar-btn {
                width: 32px;
                height: 32px;
            }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Top Toolbar - Minimalist -->
        <div class="top-toolbar">
            <div class="logo">
                <i data-lucide="layers" style="width: 18px; height: 18px;"></i>
                MuseFlow
            </div>
            
            <div class="project-info">Ï†ÑÏãú Í∏∞Ìöç ÏõåÌÅ¨ÌîåÎ°úÏö∞</div>
            
            <div class="save-status">
                <i data-lucide="check-circle" style="width: 14px; height: 14px; color: var(--success);"></i>
                ÏûêÎèô Ï†ÄÏû•Îê®
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel - Widget Palette -->
            <div class="left-panel" id="left-panel">
                <!-- Role Selector -->
                <div class="role-selector">
                    <select class="role-dropdown" id="role-selector">
                        <option value="curator">üé® ÌïôÏòàÏÇ¨ (Curator)</option>
                        <option value="educator">üìö ÏóêÎìÄÏºÄÏù¥ÌÑ∞ (Educator)</option>
                        <option value="admin">‚öôÔ∏è ÌñâÏ†ïÍ¥ÄÎ¶¨Ïûê (Admin)</option>
                    </select>
                </div>
                
                <!-- Widget Palette -->
                <div class="widget-palette" id="widget-palette">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Panel Toggle Button -->
            <button class="panel-toggle" id="panel-toggle">
                <i data-lucide="chevron-right" style="width: 16px; height: 16px;"></i>
            </button>
            
            <!-- Canvas Container -->
            <div class="canvas-container" id="canvas-container">
                <canvas id="canvas"></canvas>
                <div id="nodes-container"></div>
                
                <!-- Floating Toolbar -->
                <div class="floating-toolbar">
                    <button class="toolbar-btn active" title="ÏÑ†ÌÉù ÎèÑÍµ¨ (V)" data-tool="select">
                        <i data-lucide="mouse-pointer-2" style="width: 18px; height: 18px;"></i>
                    </button>
                    <button class="toolbar-btn" title="ÏÜê ÎèÑÍµ¨ (H)" data-tool="hand">
                        <i data-lucide="hand" style="width: 18px; height: 18px;"></i>
                    </button>
                    <button class="toolbar-btn" title="Ïó∞Í≤∞ ÎèÑÍµ¨ (C)" data-tool="connect">
                        <i data-lucide="move" style="width: 18px; height: 18px;"></i>
                    </button>
                    
                    <div class="toolbar-divider"></div>
                    
                    <button class="toolbar-btn" title="ÎÖ∏Îìú Ï∂îÍ∞Ä (A)">
                        <i data-lucide="plus" style="width: 18px; height: 18px;"></i>
                    </button>
                    
                    <div class="toolbar-divider"></div>
                    
                    <button class="toolbar-btn" title="Ï∂ïÏÜå (-)">
                        <i data-lucide="minus" style="width: 18px; height: 18px;"></i>
                    </button>
                    <div class="zoom-display">100%</div>
                    <button class="toolbar-btn" title="ÌôïÎåÄ (+)">
                        <i data-lucide="plus" style="width: 18px; height: 18px;"></i>
                    </button>
                    <button class="toolbar-btn" title="ÎßûÏ∂§ (0)">
                        <i data-lucide="maximize-2" style="width: 18px; height: 18px;"></i>
                    </button>
                    
                    <div class="toolbar-divider"></div>
                    
                    <button class="toolbar-btn-primary" title="ÏõåÌÅ¨ÌîåÎ°úÏö∞ Ïã§Ìñâ (Cmd+R)">
                        <i data-lucide="play" style="width: 16px; height: 16px;"></i>
                        Ïã§Ìñâ
                    </button>
                </div>
            </div>
            
            <!-- Right Panel - Properties -->
            <div class="right-panel" id="right-panel">
                <div class="panel-header">
                    <i data-lucide="sliders" style="width: 16px; height: 16px; margin-right: 8px;"></i>
                    ÏÜçÏÑ±
                </div>
                
                <div class="properties-content">
                    <div class="empty-state">
                        <i data-lucide="mouse-pointer-click" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.3;"></i>
                        <p>ÎÖ∏ÎìúÎ•º ÏÑ†ÌÉùÌïòÎ©¥<br>ÏÜçÏÑ±ÏùÑ Ìé∏ÏßëÌï† Ïàò ÏûàÏäµÎãàÎã§</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Role-based Widget Data
        const widgetData = {
            curator: [
                {
                    group: 'Ï†ÑÏãú Í∏∞Ìöç',
                    widgets: [
                        { id: 'ex-01', icon: 'lightbulb', title: 'Ï†ÑÏãú Ï£ºÏ†ú ÏÑ†Ï†ï', desc: 'Ï†ÑÏãú Í∏∞Ìöç' },
                        { id: 'ex-02', icon: 'image', title: 'ÏûëÌíà ÏÑ†Ï†ï', desc: 'ÌÅêÎ†àÏù¥ÌåÖ' },
                        { id: 'ex-03', icon: 'layout', title: 'Í≥µÍ∞Ñ Î∞∞Ïπò Í≥ÑÌöç', desc: 'Í≥µÍ∞Ñ ÏÑ§Í≥Ñ' },
                        { id: 'ex-04', icon: 'book-open', title: 'ÎèÑÎ°ù Ï†úÏûë', desc: 'Ï∂úÌåê' }
                    ]
                },
                {
                    group: 'ÏûëÌíà Í¥ÄÎ¶¨',
                    widgets: [
                        { id: 'col-01', icon: 'package', title: 'ÏûëÌíà Îì±Î°ù', desc: 'Ïª¨Î†âÏÖò' },
                        { id: 'col-02', icon: 'shield', title: 'Î≥¥Ï°¥ Ï≤òÎ¶¨', desc: 'Î≥¥Ï°¥' },
                        { id: 'col-03', icon: 'truck', title: 'ÎåÄÏó¨ Í¥ÄÎ¶¨', desc: 'Î¨ºÎ•ò' }
                    ]
                }
            ],
            educator: [
                {
                    group: 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®',
                    widgets: [
                        { id: 'edu-01', icon: 'graduation-cap', title: 'ÌîÑÎ°úÍ∑∏Îû® Í∏∞Ìöç', desc: 'ÍµêÏú°' },
                        { id: 'edu-02', icon: 'users', title: 'ÏõåÌÅ¨Ïàç ÏÑ§Í≥Ñ', desc: 'Ï∞∏Ïó¨Ìòï' },
                        { id: 'edu-03', icon: 'mic', title: 'ÎèÑÏä®Ìä∏ ÍµêÏú°', desc: 'Ìï¥ÏÑ§' },
                        { id: 'edu-04', icon: 'file-text', title: 'ÍµêÏú° ÏûêÎ£å Ï†úÏûë', desc: 'ÏΩòÌÖêÏ∏†' }
                    ]
                },
                {
                    group: 'Ï∞∏Ïó¨ ÌôúÎèô',
                    widgets: [
                        { id: 'eng-01', icon: 'heart', title: 'Î©§Î≤ÑÏã≠ Í¥ÄÎ¶¨', desc: 'ÌöåÏõê' },
                        { id: 'eng-02', icon: 'calendar', title: 'Ïù¥Î≤§Ìä∏ Í∏∞Ìöç', desc: 'ÌñâÏÇ¨' },
                        { id: 'eng-03', icon: 'share-2', title: 'SNS Ïö¥ÏòÅ', desc: 'ÏÜåÌÜµ' }
                    ]
                }
            ],
            admin: [
                {
                    group: 'Ïö¥ÏòÅ Í¥ÄÎ¶¨',
                    widgets: [
                        { id: 'adm-01', icon: 'dollar-sign', title: 'ÏòàÏÇ∞ ÏàòÎ¶Ω', desc: 'Ïû¨Î¨¥' },
                        { id: 'adm-02', icon: 'users', title: 'Ïù∏ÏÇ¨ Í¥ÄÎ¶¨', desc: 'HR' },
                        { id: 'adm-03', icon: 'building', title: 'ÏãúÏÑ§ Í¥ÄÎ¶¨', desc: 'Ïö¥ÏòÅ' },
                        { id: 'adm-04', icon: 'calendar-clock', title: 'ÏùºÏ†ï Í¥ÄÎ¶¨', desc: 'Ïä§ÏºÄÏ§Ñ' }
                    ]
                },
                {
                    group: 'Ïû¨Î¨¥',
                    widgets: [
                        { id: 'fin-01', icon: 'receipt', title: 'ÌöåÍ≥Ñ Ï≤òÎ¶¨', desc: 'ÌöåÍ≥Ñ' },
                        { id: 'fin-02', icon: 'file-signature', title: 'Í≥ÑÏïΩ Í¥ÄÎ¶¨', desc: 'Î≤ïÎ¨¥' },
                        { id: 'fin-03', icon: 'bar-chart', title: 'Î≥¥Í≥†ÏÑú ÏûëÏÑ±', desc: 'Î∂ÑÏÑù' }
                    ]
                }
            ]
        };
        
        // State
        const state = {
            currentRole: 'curator',
            nodes: [],
            selectedNode: null,
            zoom: 1,
            tool: 'select',
            leftPanelCollapsed: false,
            rightPanelCollapsed: false
        };
        
        // Load saved role
        const savedRole = localStorage.getItem('museflow_user_role');
        if (savedRole) {
            state.currentRole = savedRole;
            document.getElementById('role-selector').value = savedRole;
        }
        
        // Render Widget Palette
        function renderWidgetPalette() {
            const palette = document.getElementById('widget-palette');
            const data = widgetData[state.currentRole];
            
            palette.innerHTML = data.map(group => `
                <div class="widget-group">
                    <div class="group-header">${group.group}</div>
                    ${group.widgets.map(widget => `
                        <div class="widget-item" draggable="true" data-id="${widget.id}">
                            <i data-lucide="${widget.icon}" class="widget-icon"></i>
                            <div class="widget-info">
                                <div class="widget-title">${widget.title}</div>
                                <div class="widget-desc">${widget.desc}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            
            lucide.createIcons();
        }
        
        // Role Selector Change
        document.getElementById('role-selector').addEventListener('change', (e) => {
            state.currentRole = e.target.value;
            localStorage.setItem('museflow_user_role', e.target.value);
            renderWidgetPalette();
        });
        
        // Panel Toggle
        document.getElementById('panel-toggle').addEventListener('click', () => {
            const panel = document.getElementById('left-panel');
            const toggle = document.getElementById('panel-toggle');
            state.leftPanelCollapsed = !state.leftPanelCollapsed;
            
            if (state.leftPanelCollapsed) {
                panel.classList.add('collapsed');
                toggle.querySelector('i').setAttribute('data-lucide', 'chevron-right');
            } else {
                panel.classList.remove('collapsed');
                toggle.querySelector('i').setAttribute('data-lucide', 'chevron-left');
            }
            
            lucide.createIcons();
        });
        
        // Create Sample Workflow
        function createSampleWorkflow() {
            const hasSample = localStorage.getItem('museflow_canvas_sample_v2');
            if (hasSample) return;
            
            const sampleNodes = [
                { id: '1', type: 'ex-01', title: 'Ï†ÑÏãú Ï£ºÏ†ú ÏÑ†Ï†ï', x: 100, y: 100 },
                { id: '2', type: 'ex-02', title: 'ÏûëÌíà ÏÑ†Ï†ï', x: 350, y: 100 },
                { id: '3', type: 'ex-03', title: 'Í≥µÍ∞Ñ Î∞∞Ïπò Í≥ÑÌöç', x: 600, y: 100 },
                { id: '4', type: 'ex-04', title: 'ÎèÑÎ°ù Ï†úÏûë', x: 225, y: 280 },
                { id: '5', type: 'col-01', title: 'ÏûëÌíà Îì±Î°ù', x: 475, y: 280 }
            ];
            
            sampleNodes.forEach(node => createNode(node));
            localStorage.setItem('museflow_canvas_sample_v2', 'true');
        }
        
        // Create Node
        function createNode(data) {
            const node = document.createElement('div');
            node.className = 'canvas-node';
            node.id = `node-${data.id}`;
            node.style.left = data.x + 'px';
            node.style.top = data.y + 'px';
            
            node.innerHTML = `
                <div class="node-header">
                    <i data-lucide="circle" style="width: 16px; height: 16px; color: var(--accent-primary);"></i>
                    <span class="node-title">${data.title}</span>
                </div>
                <div class="node-body">
                    ${state.currentRole === 'curator' ? 'Ï†ÑÏãú Í∏∞Ìöç ÌîÑÎ°úÏÑ∏Ïä§' : 
                      state.currentRole === 'educator' ? 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Ïö¥ÏòÅ' : 
                      'ÌñâÏ†ï Í¥ÄÎ¶¨ ÏóÖÎ¨¥'}
                </div>
                <div class="node-handle top"></div>
                <div class="node-handle right"></div>
                <div class="node-handle bottom"></div>
                <div class="node-handle left"></div>
            `;
            
            document.getElementById('nodes-container').appendChild(node);
            lucide.createIcons();
            
            // Make draggable
            makeDraggable(node);
            
            state.nodes.push({ id: data.id, element: node, data });
        }
        
        // Make Node Draggable
        function makeDraggable(node) {
            let isDragging = false;
            let startX, startY, nodeX, nodeY;
            
            node.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('node-handle')) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                nodeX = parseInt(node.style.left);
                nodeY = parseInt(node.style.top);
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                node.style.left = (nodeX + dx) + 'px';
                node.style.top = (nodeY + dy) + 'px';
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Initializing Hybrid Canvas...');
            renderWidgetPalette();
            createSampleWorkflow();
        });
    </script>
</body>
</html>
