<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuseFlow - Canvas V4 Hybrid Layout</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Lucide Icons (Minimalism Design) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- MuseFlow Design System -->
    <link href="/static/css/museflow-design-system.css" rel="stylesheet">
    <link href="/static/css/unified-navbar.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--museflow-bg-secondary);
            color: var(--museflow-text-primary);
            overflow: hidden;
            padding-top: 64px; /* Space for Unified Navbar */
        }
        
        /* 3-Column + 2-Row Layout (Canvas V5) */
        .canvas-container {
            display: grid;
            grid-template-columns: 300px 1fr 280px;  /* Left | Center | Right (Ï∂ïÏÜå: 400‚Üí280) */
            grid-template-rows: 1fr 180px;            /* Canvas | Input */
            grid-template-areas:
                "left canvas right"
                "left input  right";
            height: calc(100vh - 64px - 48px);  /* Full height - navbar - footer */
            gap: 0;
            overflow: hidden;
        }
        
        /* Left Column - History & Projects */
        .left-column {
            grid-area: left;
            background: #FFFFFF;
            border-right: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .column-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #E5E7EB;
            background: #FAFBFC;
        }
        
        .column-title {
            font-size: 1rem;
            font-weight: 700;
            color: #111827;
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }
        
        .column-title i {
            font-size: 1.125rem;
            color: #8B5CF6;
        }
        
        /* Quick Actions Panel - Clean Design */
        .quick-actions-panel {
            padding: 1rem;
            border-bottom: 1px solid #E5E7EB;
            background: #FAFBFC;
        }
        
        .quick-actions-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #6B7280;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .quick-actions-header i {
            font-size: 0.875rem;
            color: #8B5CF6;
        }
        
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        /* Minimalist Quick Action Buttons */
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 0.5rem;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 0.6875rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .quick-action-btn i {
            font-size: 1.125rem;
            color: #6B7280;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .quick-action-btn span {
            line-height: 1.2;
        }
        
        .quick-action-btn:hover {
            background: #F9FAFB;
            border-color: #8B5CF6;
            color: #8B5CF6;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .quick-action-btn:hover i {
            color: #8B5CF6;
            transform: scale(1.05);
        }
        
        .quick-action-btn:active {
            transform: translateY(0);
        }
        
        /* History List - Clean Design */
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: white;
        }
        
        .history-item {
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 0.875rem 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .history-item:hover {
            background: #F9FAFB;
            border-color: #8B5CF6;
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .history-item.active {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        
        .history-title {
            font-weight: 600;
            font-size: 0.8125rem;
            margin-bottom: 0.375rem;
            line-height: 1.3;
        }
        
        .history-meta {
            font-size: 0.6875rem;
            opacity: 0.7;
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
        }
        
        /* Center Column - AI Conversation */
        /* Center Canvas Area - Infinite Canvas for Generated Results */
        .center-canvas {
            grid-area: canvas;
            position: relative;
            background: #FAFBFC;
            overflow: hidden;
            /* 20px Grid Background */
            background-image: 
                linear-gradient(rgba(139, 92, 246, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0;
        }
        
        /* Canvas Viewport - Transformable Container */
        .canvas-viewport {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.1s ease-out;
            cursor: grab;
        }
        
        .canvas-viewport.panning {
            cursor: grabbing;
        }
        
        /* Canvas Controls - Zoom Buttons */
        .canvas-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 8px 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .canvas-controls button {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #6B7280;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .canvas-controls button:hover {
            background: #F3F4F6;
            color: var(--museflow-primary);
        }
        
        .canvas-controls .zoom-level {
            min-width: 50px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }
        
        /* Center Input Area - AI Command Input (Bottom Fixed) */
        .center-input {
            grid-area: input;
            background: linear-gradient(135deg, #FFFFFF 0%, #F9FAFB 100%);
            border-top: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            padding: 16px;
            gap: 12px;
        }
        
        .conversation-header {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ai-status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #ECFDF5;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            color: #059669;
        }
        
        .ai-status-badge i {
            animation: pulse 2s infinite;
        }
        
        .conversation-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            display: flex;
            gap: 1rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .message.ai .message-avatar {
            background: linear-gradient(135deg, var(--museflow-primary) 0%, var(--museflow-primary-dark) 100%);
            color: white;
        }
        
        .message.user .message-avatar {
            background: #F3F4F6;
            color: #6B7280;
        }
        
        .message-content {
            max-width: 70%;
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            padding: 1rem;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, var(--museflow-primary) 0%, var(--museflow-primary-dark) 100%);
            color: white;
            border-color: transparent;
        }
        
        .message-text {
            font-size: 0.9375rem;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }
        
        .message-timestamp {
            font-size: 0.75rem;
            opacity: 0.6;
        }
        
        /* AI Message Action Buttons */
        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #E5E7EB;
        }
        
        .message-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.75rem;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message-action-btn i {
            font-size: 0.875rem;
            color: #6B7280;
            transition: color 0.2s;
        }
        
        .message-action-btn:hover {
            background: #F9FAFB;
            border-color: #8B5CF6;
            color: #8B5CF6;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .message-action-btn:hover i {
            color: #8B5CF6;
        }
        
        .message-action-btn.success {
            background: #ECFDF5;
            border-color: #10B981;
            color: #059669;
        }
        
        .message-action-btn.success i {
            color: #10B981;
        }
        
        .phase-progress {
            background: #FEF3C7;
            border: 1px solid #FCD34D;
            border-radius: 12px;
            padding: 1rem;
            margin-top: 0.5rem;
        }
        
        .phase-title {
            font-weight: 600;
            color: #92400E;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .phase-bar {
            background: #FDE68A;
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
        }
        
        .phase-bar-fill {
            background: #F59E0B;
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .input-area {
            padding: 1.5rem;
            border-top: 1px solid #E5E7EB;
            background: #FFFFFF;
        }
        
        /* AI Î™®Îç∏ ÏÑ†ÌÉù & ÏÑ§Ï†ï Î∞î */
        .ai-settings-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
            border-radius: 10px;
            border: 1px solid #D1D5DB;
        }
        
        .ai-model-selector {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .ai-model-selector label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }
        
        .model-select {
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 2px solid #D1D5DB;
            border-radius: 8px;
            background: #FFFFFF;
            font-size: 0.875rem;
            font-weight: 500;
            color: #1F2937;
            cursor: pointer;
            transition: all 0.2s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }
        
        .model-select:hover {
            border-color: var(--museflow-primary);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.15);
        }
        
        .model-select:focus {
            outline: none;
            border-color: var(--museflow-primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.online {
            background: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        
        .status-indicator.offline {
            background: #EF4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        
        .status-text {
            color: #6B7280;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .input-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        
        .voice-input-button {
            width: 50px;
            height: 50px;
            border: 2px solid #E5E7EB;
            border-radius: var(--radius-md);
            background: #FFFFFF;
            color: #6B7280;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
            position: relative;
        }
        
        .voice-input-button:hover {
            border-color: var(--museflow-primary);
            color: var(--museflow-primary);
            background: #F9FAFB;
            transform: scale(1.05);
        }
        
        .voice-input-button.recording {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            border-color: #DC2626;
            animation: recording-pulse 1.5s infinite;
        }
        
        @keyframes recording-pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }
        
        .voice-input-button.recording::after {
            content: 'üé§';
            position: absolute;
            top: -25px;
            right: -10px;
            font-size: 1.5rem;
            animation: float 2s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .voice-input-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .input-box {
            flex: 1;
            background: #F9FAFB;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 1rem;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            resize: none;
            min-height: 60px;
            max-height: 150px;
            transition: all 0.3s ease;
        }
        
        .input-box:focus {
            outline: none;
            border-color: #667eea;
            background: #FFFFFF;
        }
        
        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--museflow-primary) 0%, var(--museflow-primary-dark) 100%);
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: var(--transition-base);
            flex-shrink: 0;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Right Column - Live Canvas/Dashboard Preview */
        .right-column {
            grid-area: right;
            background: #F9FAFB;
            border-left: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* ========== Canvas Card Styles ========== */
        .canvas-card {
            position: absolute;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            min-width: 280px;
            max-width: 600px;
            transition: box-shadow 0.2s, transform 0.2s;
            overflow: hidden;
        }
        
        .canvas-card:hover {
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.15);
            transform: translateY(-2px);
            z-index: 10;
        }
        
        .canvas-card.dragging {
            opacity: 0.8;
            cursor: grabbing;
            z-index: 999;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
            border-bottom: 1px solid #E5E7EB;
            cursor: grab;
        }
        
        .card-header:active {
            cursor: grabbing;
        }
        
        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: var(--museflow-primary);
            font-size: 16px;
        }
        
        .card-actions {
            display: flex;
            gap: 4px;
        }
        
        .card-actions button {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: #9CA3AF;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .card-actions button:hover {
            background: rgba(139, 92, 246, 0.1);
            color: var(--museflow-primary);
        }
        
        .card-content {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .card-content img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .card-content p {
            margin: 0;
            line-height: 1.6;
            color: #374151;
            font-size: 14px;
        }
        
        .card-content pre {
            background: #F3F4F6;
            border-radius: 8px;
            padding: 12px;
            overflow-x: auto;
            font-size: 13px;
        }
        
        .card-timestamp {
            padding: 8px 16px;
            font-size: 11px;
            color: #9CA3AF;
            border-top: 1px solid #F3F4F6;
            text-align: right;
        }
        
        .preview-tabs {
            display: flex;
            border-bottom: 1px solid #E5E7EB;
            background: #FFFFFF;
        }
        
        .preview-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: #6B7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
        }
        
        .preview-tab:hover {
            background: #F9FAFB;
            color: #111827;
        }
        
        .preview-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #FFFFFF;
        }
        
        .preview-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .preview-panel {
            display: none;
        }
        
        .preview-panel.active {
            display: block;
        }
        
        /* Live Stats Cards */
        .live-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding: 1rem;
        }
        
        .stat-card-mini {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: white;
            border: 1px solid var(--museflow-border-light);
            border-radius: var(--radius-md);
            transition: var(--transition-base);
        }
        
        .stat-card-mini:hover {
            border-color: var(--museflow-primary);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.1);
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            flex-shrink: 0;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--museflow-text-secondary);
            margin-bottom: 0.125rem;
        }
        
        .stat-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--museflow-text-primary);
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--museflow-bg-tertiary);
            border-bottom: 1px solid var(--museflow-border-light);
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--museflow-text-secondary);
        }
        
        .section-header i {
            color: var(--museflow-primary);
        }
        
        /* Active Tasks */
        .active-tasks-section {
            margin-top: 1rem;
            background: white;
            border: 1px solid var(--museflow-border-light);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .active-tasks-list {
            padding: 1rem;
        }
        
        .no-tasks {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--museflow-text-tertiary);
        }
        
        .no-tasks i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            opacity: 0.3;
        }
        
        .no-tasks p {
            font-size: 0.875rem;
        }
        
        /* Recent Items */
        .recent-items-section {
            margin-top: 1rem;
            background: white;
            border: 1px solid var(--museflow-border-light);
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .recent-items-list {
            padding: 0.5rem;
        }
        
        .recent-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            transition: var(--transition-base);
            cursor: pointer;
        }
        
        .recent-item:hover {
            background: var(--museflow-bg-tertiary);
        }
        
        .recent-icon {
            font-size: 1.5rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--museflow-bg-secondary);
            border-radius: var(--radius-sm);
            flex-shrink: 0;
        }
        
        .recent-info {
            flex: 1;
        }
        
        .recent-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--museflow-text-primary);
            margin-bottom: 0.125rem;
        }
        
        .recent-time {
            font-size: 0.75rem;
            color: var(--museflow-text-tertiary);
        }
        
        /* Widgets Grid */
        .widgets-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 1rem;
        }
        
        .widget-card {
            background: white;
            border: 1px solid var(--museflow-border-light);
            border-radius: var(--radius-md);
            padding: 1rem;
            transition: var(--transition-base);
        }
        
        .widget-card:hover {
            border-color: var(--museflow-primary);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
        }
        
        /* ‚≠ê Drag & Drop Styles */
        .widget-card[draggable="true"] {
            user-select: none;
            -webkit-user-select: none;
        }
        
        .widget-card[draggable="true"]:active {
            cursor: grabbing !important;
        }
        
        .widget-card.dragging {
            opacity: 0.5;
            transform: rotate(3deg);
        }
        
        .preview-panel.drop-zone-active {
            background: rgba(139, 92, 246, 0.05);
            border: 2px dashed var(--museflow-primary);
            animation: dropZonePulse 1.5s infinite;
        }
        
        @keyframes dropZonePulse {
            0%, 100% {
                background: rgba(139, 92, 246, 0.05);
            }
            50% {
                background: rgba(139, 92, 246, 0.1);
            }
        }
        
        .widget-header-small {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--museflow-text-secondary);
            margin-bottom: 0.75rem;
        }
        
        .widget-header-small i {
            color: var(--museflow-primary);
        }
        
        .widget-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--museflow-text-primary);
            margin-bottom: 0.5rem;
        }
        
        .widget-progress {
            height: 6px;
            background: var(--museflow-bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .widget-progress-bar {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .widget-footer {
            font-size: 0.75rem;
            color: var(--museflow-text-tertiary);
        }
        
        .widget-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .widget-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--museflow-bg-secondary);
            border-radius: var(--radius-sm);
            font-size: 0.8125rem;
        }
        
        .widget-chart-mini {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
            height: 80px;
            margin-bottom: 0.5rem;
        }
        
        .chart-bar {
            flex: 1;
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }
        
        /* Results Section */
        .results-section {
            padding: 1rem;
        }
        
        /* Canvas Preview */
        .canvas-preview {
            background: #FFFFFF;
            border: 2px dashed #E5E7EB;
            border-radius: 16px;
            min-height: 400px;
            padding: 2rem;
            position: relative;
        }
        
        .canvas-node {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            animation: nodeAppear 0.5s ease;
            position: absolute; /* Changed from relative to absolute for drag & drop */
            overflow: hidden;
            cursor: move;
            user-select: none;
            min-width: 280px;
            max-width: 400px;
            transition: box-shadow 0.2s ease;
        }
        
        .canvas-node:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.35);
        }
        
        .canvas-node.dragging {
            opacity: 0.8;
            cursor: grabbing;
            z-index: 1000;
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.5);
        }
        
        /* Node type colors */
        .canvas-node[data-type="budget"] {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .canvas-node[data-type="chart"] {
            background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .canvas-node[data-type="concept"] {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .canvas-node[data-type="education"] {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .canvas-node[data-type="artwork"] {
            background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
        }
        
        .canvas-node[data-type="document"] {
            background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        /* Node connection indicator */
        .canvas-node::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.5) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        @keyframes nodeAppear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .canvas-node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .canvas-node-title {
            font-weight: 700;
            font-size: 1rem;
        }
        
        .canvas-node-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .canvas-node-content {
            font-size: 0.875rem;
            line-height: 1.6;
            opacity: 0.95;
        }
        
        /* Dashboard Preview */
        .dashboard-preview {
            display: grid;
            gap: 1rem;
        }
        
        .widget-preview {
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 1.5rem;
            animation: widgetAppear 0.5s ease;
        }
        
        @keyframes widgetAppear {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .widget-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .widget-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .widget-title {
            font-weight: 700;
            font-size: 1rem;
            color: #111827;
        }
        
        .widget-content {
            font-size: 0.875rem;
            color: #6B7280;
            line-height: 1.6;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #9CA3AF;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .empty-state-text {
            font-size: 0.875rem;
        }
        
        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #F3F4F6;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .canvas-container {
                grid-template-columns: 250px 1fr 350px;
            }
        }
        
        /* Mobile Optimizations - Enhanced */
        @media (max-width: 768px) {
            body {
                padding-top: 120px; /* Navbar + Mobile Tabs */
                -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
            }
            
            .canvas-container {
                grid-template-columns: 1fr;
                height: calc(100vh - 120px);
                position: relative;
            }
            
            /* Mobile Tab Navigation - Enhanced */
            .mobile-tabs {
                display: flex;
                position: fixed;
                top: 64px;
                left: 0;
                right: 0;
                background: white;
                border-bottom: 2px solid var(--museflow-border-light);
                z-index: 100;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none; /* Firefox */
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
            
            .mobile-tabs::-webkit-scrollbar {
                display: none; /* Chrome, Safari */
            }
            
            .mobile-tab {
                flex: 1;
                min-width: 90px;
                padding: 1rem 0.75rem;
                text-align: center;
                font-size: 0.8rem;
                font-weight: 600;
                color: var(--museflow-text-secondary);
                border-bottom: 3px solid transparent;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                cursor: pointer;
                white-space: nowrap;
                -webkit-tap-highlight-color: transparent;
                user-select: none;
            }
            
            .mobile-tab:active {
                transform: scale(0.95);
                background: var(--museflow-bg-secondary);
            }
            
            .mobile-tab i {
                display: block;
                font-size: 1.5rem;
                margin-bottom: 0.375rem;
                transition: transform 0.3s ease;
            }
            
            .mobile-tab.active {
                color: var(--museflow-primary);
                border-bottom-color: var(--museflow-primary);
                background: linear-gradient(to bottom, var(--museflow-primary-light) 0%, white 100%);
            }
            
            .mobile-tab.active i {
                transform: scale(1.1);
            }
            
            /* Mobile Columns - Enhanced */
            .left-column,
            .center-column,
            .right-column {
                display: none;
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--museflow-bg-secondary);
                overflow-y: auto;
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
                will-change: transform, opacity;
            }
            
            .left-column.mobile-active,
            .center-column.mobile-active,
            .right-column.mobile-active {
                display: flex;
                animation: slideInMobile 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            @keyframes slideInMobile {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            /* Mobile Input Area - Enhanced */
            .input-area {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid var(--museflow-border-light);
                padding: 0.875rem;
                z-index: 99;
                box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
                safe-area-inset-bottom: env(safe-area-inset-bottom);
                padding-bottom: calc(0.875rem + env(safe-area-inset-bottom));
            }
            
            .message-input-container {
                gap: 0.625rem;
            }
            
            .message-input {
                font-size: 16px !important; /* Prevent iOS zoom */
                padding: 0.875rem !important;
                border-radius: 12px !important;
                min-height: 48px;
                resize: none;
                max-height: 120px;
            }
            
            .send-button {
                width: 48px;
                height: 48px;
                min-width: 48px;
                border-radius: 12px;
                font-size: 1.25rem;
                transition: all 0.2s ease;
            }
            
            .send-button:active {
                transform: scale(0.9);
            }
            
            /* Conversation Area Mobile - Enhanced */
            .conversation-area {
                padding-bottom: 100px; /* Space for fixed input */
                padding-top: 1rem;
            }
            
            .message-wrapper {
                margin-bottom: 1rem;
            }
            
            .message-bubble {
                max-width: 85%;
                padding: 0.875rem 1rem;
                font-size: 0.95rem;
                line-height: 1.5;
            }
            
            /* Preview Tabs Mobile - Enhanced */
            .preview-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 0.5rem;
                padding: 0 0.5rem;
            }
            
            .preview-tabs::-webkit-scrollbar {
                display: none;
            }
            
            .preview-tab {
                font-size: 0.85rem;
                padding: 0.75rem 1.25rem;
                min-width: auto;
                white-space: nowrap;
                border-radius: 8px;
            }
            
            /* History Items - Touch-friendly */
            .history-item {
                padding: 1.125rem;
                margin-bottom: 0.75rem;
                border-radius: 12px;
                transition: all 0.2s ease;
                min-height: 64px;
            }
            
            .history-item:active {
                transform: scale(0.98);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }
            
            .history-title {
                font-size: 0.95rem;
                line-height: 1.4;
            }
            
            .history-time {
                font-size: 0.75rem;
                margin-top: 0.375rem;
            }
            
            /* Quick Actions Mobile - Enhanced */
            .quick-actions-panel {
                padding: 1rem;
            }
            
            .quick-actions-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            
            .quick-action-btn {
                padding: 1rem 0.5rem;
                font-size: 0.7rem;
                min-height: 80px;
                border-radius: 12px;
                transition: all 0.2s ease;
                -webkit-tap-highlight-color: transparent;
            }
            
            .quick-action-btn:active {
                transform: scale(0.95);
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
            }
            
            .quick-action-btn i {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .quick-action-btn span {
                font-size: 0.7rem;
                line-height: 1.3;
                display: block;
            }
            
            /* Live Stats Mobile - Enhanced */
            .live-stats {
                padding: 1rem;
                gap: 0.75rem;
            }
            
            .stat-card-mini {
                padding: 1rem;
                border-radius: 12px;
                min-height: 72px;
            }
            
            .stat-icon {
                width: 40px;
                height: 40px;
                font-size: 1.125rem;
            }
            
            .stat-value {
                font-size: 1.25rem;
                font-weight: 700;
            }
            
            .stat-label {
                font-size: 0.75rem;
            }
            
            /* Widgets Mobile - Enhanced */
            .widgets-container {
                padding: 1rem;
                gap: 0.875rem;
            }
            
            .widget-card {
                padding: 1rem;
                border-radius: 12px;
                transition: all 0.2s ease;
            }
            
            .widget-card:active {
                transform: scale(0.98);
            }
            
            .widget-title {
                font-size: 0.85rem;
                margin-bottom: 0.75rem;
            }
            
            .widget-value {
                font-size: 1.5rem;
                font-weight: 700;
            }
            
            /* Column Headers Mobile */
            .column-header {
                padding: 1rem;
                position: sticky;
                top: 0;
                background: white;
                z-index: 10;
                border-bottom: 1px solid var(--museflow-border-light);
            }
            
            .column-title {
                font-size: 1rem;
            }
            
            /* Scrollbar Hide Mobile */
            .left-column::-webkit-scrollbar,
            .center-column::-webkit-scrollbar,
            .right-column::-webkit-scrollbar {
                display: none;
            }
            
            .left-column,
            .center-column,
            .right-column {
                scrollbar-width: none;
            }
            
            /* Safe Area Support */
            @supports (padding: max(0px)) {
                body {
                    padding-top: max(120px, env(safe-area-inset-top) + 120px);
                }
                
                .mobile-tabs {
                    top: max(64px, env(safe-area-inset-top) + 64px);
                }
            }
        }
        
        /* Small Mobile Devices (iPhone SE, etc.) */
        @media (max-width: 375px) {
            .mobile-tab {
                min-width: 75px;
                padding: 0.875rem 0.5rem;
                font-size: 0.7rem;
            }
            
            .mobile-tab i {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }
            
            .quick-actions-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .quick-action-btn {
                min-height: 72px;
                padding: 0.75rem 0.375rem;
            }
            
            .quick-action-btn i {
                font-size: 1.25rem;
            }
            
            .quick-action-btn span {
                font-size: 0.65rem;
            }
            
            .message-bubble {
                max-width: 90%;
                padding: 0.75rem 0.875rem;
                font-size: 0.9rem;
            }
            
            .stat-card-mini {
                padding: 0.875rem;
            }
            
            .stat-icon {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .stat-value {
                font-size: 1.125rem;
            }
            
            /* Mobile: AI Settings Bar */
            .ai-settings-bar {
                flex-direction: column;
                gap: 0.75rem;
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }
            
            .ai-model-selector {
                width: 100%;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .ai-model-selector label {
                font-size: 0.75rem;
            }
            
            .model-select {
                width: 100%;
                font-size: 0.8125rem;
                padding: 0.625rem 2.5rem 0.625rem 0.875rem;
            }
            
            .ai-status {
                width: 100%;
                justify-content: center;
                padding: 0.625rem;
                font-size: 0.75rem;
            }
            
            /* Mobile: Input Actions */
            .input-actions {
                gap: 0.5rem;
            }
            
            .voice-input-button,
            .send-button {
                width: 44px;
                height: 44px;
                font-size: 1.125rem;
            }
            
            .input-box {
                font-size: 16px; /* Prevent iOS zoom */
                min-height: 50px;
            }
            
            .input-area {
                padding: 1rem;
            }
        }
        
        /* Tablet Portrait */
        @media (min-width: 769px) and (max-width: 1024px) {
            .canvas-container {
                grid-template-columns: 280px 1fr 380px;
            }
            
            .quick-actions-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Tablet Landscape */
        @media (min-width: 1025px) and (max-width: 1200px) {
            .canvas-container {
                grid-template-columns: 280px 1fr 400px;
            }
        }
        
        /* Hide mobile tabs on desktop */
        .mobile-tabs {
            display: none;
        }
        
        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* Larger tap targets for touch devices */
            button,
            .history-item,
            .quick-action-btn,
            .preview-tab,
            .mobile-tab {
                min-height: 44px; /* iOS minimum */
            }
            
            /* Disable hover effects on touch devices */
            .history-item:hover,
            .quick-action-btn:hover,
            .preview-tab:hover {
                transform: none;
            }
            
            /* Better scroll momentum */
            * {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* High DPI Screens */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            /* Sharper text rendering */
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
        
        /* Landscape Mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            body {
                padding-top: 100px; /* Reduced for landscape */
            }
            
            .mobile-tabs {
                padding: 0.5rem 0;
            }
            
            .mobile-tab {
                padding: 0.625rem 0.5rem;
            }
            
            .mobile-tab i {
                font-size: 1.125rem;
                margin-bottom: 0.125rem;
            }
            
            .canvas-container {
                height: calc(100vh - 100px);
            }
            
            .input-area {
                padding: 0.625rem;
            }
            
            .conversation-area {
                padding-bottom: 75px;
            }
        }
    </style>

    <style>
        /* MuseFlow Footer Styles */
        .museflow-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e5e5e5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 999999;
            font-size: 0.75rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .museflow-footer-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .museflow-footer-logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            color: #8B5CF6;
        }

        .museflow-footer-divider {
            width: 1px;
            height: 16px;
            background: rgba(255, 255, 255, 0.2);
        }

        .museflow-footer-text {
            color: #e5e5e5;
        }

        .museflow-footer-version {
            font-weight: 600;
            color: #60A5FA;
        }

        /* Adjust body padding to prevent content overlap */
        body {
            padding-bottom: 40px !important;
        }
    </style>

</head>
<body>
    <!-- MuseFlow Unified Navigation Bar Component - Identical to Dashboard -->
    <nav class="unified-navbar">
        <div class="unified-nav-container">
            <!-- Logo -->
            <a href="/landing.html" class="unified-nav-logo">
                <img src="/static/images/logo-neon-m.png" alt="MuseFlow" loading="lazy">
                <span>MuseFlow</span>
            </a>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Î©îÎâ¥ Ïó¥Í∏∞/Îã´Í∏∞">
                <i data-lucide="menu" stroke-width="2"></i>
            </button>
            
            <!-- Main Navigation - Icon Only -->
            <ul class="unified-nav-links" id="unifiedNavLinks">
                <li><a href="/landing.html" data-page="home" data-tooltip="Home">
                    <i data-lucide="home" stroke-width="2"></i>
                </a></li>
                <li><a href="/dashboard.html" data-page="dashboard" data-tooltip="Dashboard">
                    <i data-lucide="layout-dashboard" stroke-width="2"></i>
                </a></li>
                <li><a href="/canvas-v4-hybrid.html" data-page="canvas" data-tooltip="Canvas" class="active">
                    <i data-lucide="workflow" stroke-width="2"></i>
                </a></li>
                <li><a href="/workflow-tools.html" data-page="workflow" data-tooltip="Tools">
                    <i data-lucide="wrench" stroke-width="2"></i>
                </a></li>
                <li><a href="/budget.html" data-page="budget" data-tooltip="Budget">
                    <i data-lucide="circle-dollar-sign" stroke-width="2"></i>
                </a></li>
                <li><a href="/analytics-dashboard.html" data-page="analytics" data-tooltip="Analytics">
                    <i data-lucide="bar-chart-3" stroke-width="2"></i>
                </a></li>
                <li><a href="/google-mcp.html" data-page="google-mcp" data-tooltip="Google AI">
                    <i data-lucide="brain" stroke-width="2"></i>
                </a></li>
            </ul>
            
            <!-- Actions - Icon Only -->
            <div class="unified-nav-actions">
                <!-- AI Recommendations -->
                <button class="unified-nav-btn primary" onclick="showAIRecommendations()" data-tooltip="AI Ï∂îÏ≤ú">
                    <i data-lucide="sparkles" stroke-width="2"></i>
                </button>
                
                <!-- Favorites -->
                <button class="unified-nav-btn" onclick="filterFavorites()" data-tooltip="Ï¶êÍ≤®Ï∞æÍ∏∞">
                    <i data-lucide="star" stroke-width="2"></i>
                </button>
                
                <!-- Notifications -->
                <button class="unified-nav-btn" onclick="toggleNotifications()" data-tooltip="ÏïåÎ¶º">
                    <i data-lucide="bell" stroke-width="2"></i>
                </button>
                
                <!-- Help -->
                <a href="/help-center.html" class="unified-nav-btn" data-tooltip="ÎèÑÏõÄÎßê">
                    <i data-lucide="help-circle" stroke-width="2"></i>
                </a>
                
                <!-- Settings -->
                <a href="/account.html" class="unified-nav-btn" data-tooltip="ÏÑ§Ï†ï">
                    <i data-lucide="settings" stroke-width="2"></i>
                </a>
                
                <!-- Account -->
                <a href="/account.html" class="unified-nav-btn" data-tooltip="ÎÇ¥ Í≥ÑÏ†ï">
                    <i data-lucide="user" stroke-width="2"></i>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Mobile Tab Navigation (visible only on mobile) -->
    <div class="mobile-tabs">
        <div class="mobile-tab active" data-mobile-tab="history">
            <i data-lucide="clock" stroke-width="2"></i>
            <span>History</span>
        </div>
        <div class="mobile-tab" data-mobile-tab="conversation">
            <i data-lucide="message-circle" stroke-width="2"></i>
            <span>AI Chat</span>
        </div>
        <div class="mobile-tab" data-mobile-tab="preview">
            <i data-lucide="eye" stroke-width="2"></i>
            <span>Preview</span>
        </div>
    </div>
    
    <div class="canvas-container">
        <!-- Left Column: History & Projects -->
        <div class="left-column">
            <div class="column-header">
                <h2 class="column-title">
                    <i data-lucide="clock" stroke-width="2"></i>
                    History & Projects
                </h2>
            </div>
            
            <!-- Quick Actions Panel -->
            <div class="quick-actions-panel">
                <div class="quick-actions-header">
                    <i data-lucide="zap" stroke-width="2"></i>
                    <span>Îπ†Î•∏ ÏûëÏóÖ</span>
                </div>
                <div class="quick-actions-grid">
                    <button class="quick-action-btn" data-action="exhibition-label">
                        <i data-lucide="tag" stroke-width="2"></i>
                        <span>Ï†ÑÏãú ÎùºÎ≤®</span>
                    </button>
                    <button class="quick-action-btn" data-action="budget-approval">
                        <i data-lucide="coins" stroke-width="2"></i>
                        <span>ÏòàÏÇ∞ ÏäπÏù∏</span>
                    </button>
                    <button class="quick-action-btn" data-action="artwork-selection">
                        <i data-lucide="palette" stroke-width="2"></i>
                        <span>ÏÜåÏû•Ìíà ÏÑ†Ï†ï</span>
                    </button>
                    <button class="quick-action-btn" data-action="promotion-plan">
                        <i data-lucide="megaphone" stroke-width="2"></i>
                        <span>ÌôçÎ≥¥ Í≥ÑÌöç</span>
                    </button>
                    <button class="quick-action-btn" data-action="report-writing">
                        <i data-lucide="file-text" stroke-width="2"></i>
                        <span>Î≥¥Í≥†ÏÑú</span>
                    </button>
                    <button class="quick-action-btn" data-action="schedule-management">
                        <i data-lucide="calendar" stroke-width="2"></i>
                        <span>ÏùºÏ†ï Í¥ÄÎ¶¨</span>
                    </button>
                    <button class="quick-action-btn" data-action="education-program">
                        <i data-lucide="graduation-cap" stroke-width="2"></i>
                        <span>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</span>
                    </button>
                    <button class="quick-action-btn" data-action="research">
                        <i data-lucide="search" stroke-width="2"></i>
                        <span>ÏûêÎ£å Ï°∞ÏÇ¨</span>
                    </button>
                    <button class="quick-action-btn" data-action="visitor-guide">
                        <i data-lucide="message-circle" stroke-width="2"></i>
                        <span>Î∞©Î¨∏Í∞ù ÏïàÎÇ¥</span>
                    </button>
                    <button class="quick-action-btn" data-action="space-optimization">
                        <i data-lucide="layout" stroke-width="2"></i>
                        <span>Í≥µÍ∞Ñ ÏµúÏ†ÅÌôî</span>
                    </button>
                </div>
            </div>
            
            <div class="history-list" id="historyList">
                <div class="history-item active">
                    <div class="history-title">Ïù∏ÏÉÅÏ£ºÏùò ÌäπÎ≥ÑÏ†Ñ Í∏∞Ìöç</div>
                    <div class="history-meta">
                        <span>Ï†ÑÏãú Í∏∞Ìöç</span>
                        <span>Î∞©Í∏à Ï†Ñ</span>
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-title">2024ÎÖÑ 1Î∂ÑÍ∏∞ ÏòàÏÇ∞ ÏäπÏù∏</div>
                    <div class="history-meta">
                        <span>ÏòàÏÇ∞ ÏäπÏù∏</span>
                        <span>2ÏãúÍ∞Ñ Ï†Ñ</span>
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-title">Ïñ¥Î¶∞Ïù¥ ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</div>
                    <div class="history-meta">
                        <span>ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</span>
                        <span>Ïñ¥Ï†ú</span>
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-title">ÌòÑÎåÄÎØ∏Ïà† ÏÜåÏû•Ìíà ÏÑ†Ï†ï</div>
                    <div class="history-meta">
                        <span>ÏÜåÏû•Ìíà ÏÑ†Ï†ï</span>
                        <span>3Ïùº Ï†Ñ</span>
                    </div>
                </div>
                
                <div class="history-item">
                    <div class="history-title">SNS ÌôçÎ≥¥ Ï∫†ÌéòÏù∏</div>
                    <div class="history-meta">
                        <span>ÌôçÎ≥¥ Í≥ÑÌöç</span>
                        <span>1Ï£ºÏùº Ï†Ñ</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Center Column: AI Conversation -->
        <!-- Center Canvas: Infinite Canvas for Generated Results -->
        <div class="center-canvas" id="infiniteCanvas">
            <!-- Canvas Viewport (Transformable) -->
            <div class="canvas-viewport" id="canvasViewport">
                <!-- Canvas cards will be generated here by AI -->
                <!-- Example: AI Î™ÖÎ†πÏñ¥ ‚Üí ÏûêÎèôÏúºÎ°ú Ïπ¥Îìú ÏÉùÏÑ± -->
            </div>
            
            <!-- Canvas Controls (Zoom, Fit) -->
            <div class="canvas-controls">
                <button class="canvas-zoom-out" id="zoomOut" title="Ï∂ïÏÜå">
                    <i class="fas fa-minus"></i>
                </button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="canvas-zoom-in" id="zoomIn" title="ÌôïÎåÄ">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="canvas-fit" id="fitCanvas" title="Ï†ÑÏ≤¥ Î≥¥Í∏∞">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        
        <!-- Center Input: AI Command Input (Bottom Fixed) -->
        <div class="center-input">
            <div class="input-area">
                <!-- AI Î™®Îç∏ ÏÑ†ÌÉù & ÏÑ§Ï†ï Î∞î -->
                <div class="ai-settings-bar">
                    <div class="ai-model-selector">
                        <label for="aiModelSelect">
                            <i data-lucide="sparkles" stroke-width="2"></i>
                            AI Î™®Îç∏
                        </label>
                        <select id="aiModelSelect" class="model-select">
                            <option value="gpt-4" selected>GPT-4 (Í∞ÄÏû• Í∞ïÎ†•)</option>
                            <option value="gpt-3.5">GPT-3.5 Turbo (Îπ†Î¶Ñ)</option>
                            <option value="claude-3">Claude 3 Opus</option>
                            <option value="gemini-pro">Gemini Pro</option>
                        </select>
                    </div>
                    <div class="ai-status">
                        <span class="status-indicator online"></span>
                        <span class="status-text">Ïò®ÎùºÏù∏</span>
                    </div>
                </div>
                
                <div class="input-container">
                    <textarea 
                        id="messageInput" 
                        class="input-box" 
                        placeholder="AIÏóêÍ≤å Î™ÖÎ†πÌïòÏÑ∏Ïöî... (Ïòà: Ïù∏ÏÉÅÏ£ºÏùò ÌäπÎ≥ÑÏ†ÑÏùÑ 3000ÎßåÏõê ÏòàÏÇ∞ÏúºÎ°ú Í∏∞ÌöçÌï¥Ï§ò)"
                        rows="2"
                    ></textarea>
                    <div class="input-actions">
                        <button class="voice-input-button" id="voiceButton" title="ÏùåÏÑ± ÏûÖÎ†•">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="send-button" id="sendButton" title="Ï†ÑÏÜ°">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of center-input -->
        
        <!-- Right Column: Real-time Status (Simplified) -->
        <div class="right-column">
            <!-- Header -->
            <div class="column-header" style="border-bottom: 1px solid #E5E7EB;">
                <h2 class="column-title">
                    <i class="fas fa-chart-line"></i>
                    Ïã§ÏãúÍ∞Ñ ÌòÑÌô©
                </h2>
            </div>
            
            <div class="preview-content" style="padding: 1rem;">
                <!-- Overview Panel - Ïã§ÏãúÍ∞Ñ ÌòÑÌô© -->
                <div id="overviewPanel">
                    <div class="live-stats">
                        <div class="stat-card-mini">
                            <div class="stat-icon" style="background: var(--museflow-primary-light); color: var(--museflow-primary);">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Ïò§ÎäòÏùò ÏûëÏóÖ</div>
                                <div class="stat-value">5Í∞ú</div>
                            </div>
                        </div>
                        
                        <div class="stat-card-mini">
                            <div class="stat-icon" style="background: var(--status-success-bg); color: var(--status-success);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">ÏôÑÎ£å</div>
                                <div class="stat-value">3Í∞ú</div>
                            </div>
                        </div>
                        
                        <div class="stat-card-mini">
                            <div class="stat-icon" style="background: var(--status-warning-bg); color: var(--status-warning);">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">ÏßÑÌñâ Ï§ë</div>
                                <div class="stat-value" id="activeTasksCount">0Í∞ú</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI ÏûëÏóÖ ÏßÑÌñâ ÏÉÅÌô© -->
                    <div class="active-tasks-section">
                        <div class="section-header">
                            <i class="fas fa-robot"></i>
                            <span>AI ÏûëÏóÖ ÏßÑÌñâ Ï§ë</span>
                        </div>
                        <div id="activeTasksList" class="active-tasks-list">
                            <div class="no-tasks">
                                <i class="fas fa-coffee"></i>
                                <p>ÌòÑÏû¨ ÏßÑÌñâ Ï§ëÏù∏ ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÏµúÍ∑º ÏÉùÏÑ± Ìï≠Î™© -->
                    <div class="recent-items-section">
                        <div class="section-header">
                            <i class="fas fa-history"></i>
                            <span>ÏµúÍ∑º ÏÉùÏÑ± Ìï≠Î™©</span>
                        </div>
                        <div id="recentItemsList" class="recent-items-list">
                            <div class="recent-item">
                                <div class="recent-icon">üìù</div>
                                <div class="recent-info">
                                    <div class="recent-title">Ï†ÑÏãú ÎùºÎ≤® Î¨∏ÏÑú</div>
                                    <div class="recent-time">5Î∂Ñ Ï†Ñ</div>
                                </div>
                            </div>
                            <div class="recent-item">
                                <div class="recent-icon">üí∞</div>
                                <div class="recent-info">
                                    <div class="recent-title">ÏòàÏÇ∞ ÏäπÏù∏ ÏöîÏ≤≠ÏÑú</div>
                                    <div class="recent-time">1ÏãúÍ∞Ñ Ï†Ñ</div>
                                </div>
                            </div>
                            <div class="recent-item">
                                <div class="recent-icon">üé®</div>
                                <div class="recent-info">
                                    <div class="recent-title">ÏÜåÏû•Ìíà ÏÑ†Ï†ï Î≥¥Í≥†ÏÑú</div>
                                    <div class="recent-time">Ïñ¥Ï†ú</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Right Column -->
    </div>
    
    <script>
        // ==========================================
        // üé® Canvas V5 - Infinite Canvas State
        // ==========================================
        const canvas = {
            x: 0,
            y: 0,
            scale: 1,
            minScale: 0.25,
            maxScale: 3.0,
            cards: [],
            cardIdCounter: 0
        };
        
        let isPanning = false;
        let startPanX = 0;
        let startPanY = 0;
        
        // Canvas Elements
        const infiniteCanvas = document.getElementById('infiniteCanvas');
        const canvasViewport = document.getElementById('canvasViewport');
        const zoomLevel = document.getElementById('zoomLevel');
        
        // ==========================================
        // üñ±Ô∏è Infinite Canvas - Panning (ÎìúÎûòÍ∑∏ Ïù¥Îèô)
        // ==========================================
        canvasViewport.addEventListener('mousedown', (e) => {
            if (e.target === canvasViewport || e.target.closest('.canvas-card') === null) {
                isPanning = true;
                startPanX = e.clientX - canvas.x;
                startPanY = e.clientY - canvas.y;
                canvasViewport.classList.add('panning');
                e.preventDefault();
            }
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isPanning) {
                canvas.x = e.clientX - startPanX;
                canvas.y = e.clientY - startPanY;
                updateCanvasTransform();
            }
        });
        
        document.addEventListener('mouseup', () => {
            if (isPanning) {
                isPanning = false;
                canvasViewport.classList.remove('panning');
            }
        });
        
        // ==========================================
        // üîç Infinite Canvas - Zooming (ÎßàÏö∞Ïä§ Ìú†)
        // ==========================================
        infiniteCanvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = Math.max(canvas.minScale, Math.min(canvas.maxScale, canvas.scale * delta));
            
            // Zoom at mouse position
            const rect = infiniteCanvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            canvas.x = mouseX - (mouseX - canvas.x) * (newScale / canvas.scale);
            canvas.y = mouseY - (mouseY - canvas.y) * (newScale / canvas.scale);
            canvas.scale = newScale;
            
            updateCanvasTransform();
        }, { passive: false });
        
        // ==========================================
        // üéõÔ∏è Canvas Controls - Zoom Buttons
        // ==========================================
        document.getElementById('zoomIn').addEventListener('click', () => {
            canvas.scale = Math.min(canvas.maxScale, canvas.scale * 1.2);
            updateCanvasTransform();
        });
        
        document.getElementById('zoomOut').addEventListener('click', () => {
            canvas.scale = Math.max(canvas.minScale, canvas.scale / 1.2);
            updateCanvasTransform();
        });
        
        document.getElementById('fitCanvas').addEventListener('click', () => {
            canvas.x = 0;
            canvas.y = 0;
            canvas.scale = 1;
            updateCanvasTransform();
        });
        
        // Update Canvas Transform
        function updateCanvasTransform() {
            canvasViewport.style.transform = `translate(${canvas.x}px, ${canvas.y}px) scale(${canvas.scale})`;
            zoomLevel.textContent = `${Math.round(canvas.scale * 100)}%`;
        }
        
        // ==========================================
        // üì¶ Canvas Card Management
        // ==========================================
        function createCanvasCard({ type = 'text', content, title = 'AI ÏÉùÏÑ± Í≤∞Í≥º', position = null }) {
            const cardId = `card-${canvas.cardIdCounter++}`;
            
            // Auto position if not specified
            if (!position) {
                position = getNextCardPosition();
            }
            
            const card = document.createElement('div');
            card.className = 'canvas-card';
            card.dataset.cardId = cardId;
            card.style.left = position.x + 'px';
            card.style.top = position.y + 'px';
            card.style.width = '320px';
            
            // Card type icon mapping
            const typeIcons = {
                // Text & Documents
                'text': 'file-text',
                'markdown': 'file-code',
                'pdf': 'file-pdf',
                
                // Media
                'image': 'image',
                'video': 'video',
                'audio': 'music',
                
                // Data Visualization
                'chart': 'bar-chart-2',
                'budget': 'dollar-sign',
                'timeline': 'calendar',
                
                // Presentations
                'slides': 'presentation',
                'spreadsheet': 'table',
                
                // External
                'figma': 'figma',
                'notion': 'book-open',
                'widget': 'box'
            };
            
            const icon = typeIcons[type] || 'file';
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-${icon}"></i>
                        ${title}
                    </div>
                    <div class="card-actions">
                        <button onclick="copyCardContent('${cardId}')" title="Î≥µÏÇ¨">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button onclick="exportToFigma('${cardId}')" title="Figma ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                            <i class="fab fa-figma"></i>
                        </button>
                        <button onclick="exportToNotion('${cardId}')" title="Notion ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                            <span style="font-weight: bold;">N</span>
                        </button>
                        <button onclick="deleteCard('${cardId}')" title="ÏÇ≠Ï†ú">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    ${formatCardContent(type, content)}
                </div>
                <div class="card-timestamp">
                    ${new Date().toLocaleString('ko-KR')}
                </div>
            `;
            
            // Make card draggable
            makeCardDraggable(card);
            
            // Add to viewport
            canvasViewport.appendChild(card);
            canvas.cards.push({ id: cardId, element: card, type, content });
            
            console.log(`‚úÖ Canvas Card ÏÉùÏÑ±: ${cardId} (${type})`);
            return card;
        }
        
        // Format card content based on type
        function formatCardContent(type, content) {
            switch (type) {
                // ========== Images ==========
                case 'image':
                    return `
                        <div class="image-card-content">
                            <img src="${content.url || content}" alt="${content.alt || 'Generated Image'}" 
                                 style="width: 100%; height: auto; border-radius: 8px;">
                            ${content.caption ? `<div class="image-caption" style="margin-top: 8px; font-size: 13px; color: #6B7280;">${content.caption}</div>` : ''}
                        </div>`;
                
                // ========== Videos ==========
                case 'video':
                    return `
                        <div class="video-card-content">
                            <video controls style="width: 100%; border-radius: 8px;" ${content.autoplay ? 'autoplay' : ''}>
                                <source src="${content.url || content}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            ${content.caption ? `<div class="video-caption" style="margin-top: 8px; font-size: 13px; color: #6B7280;">${content.caption}</div>` : ''}
                        </div>`;
                
                // ========== Audio ==========
                case 'audio':
                    return `
                        <div class="audio-card-content">
                            <audio controls style="width: 100%;">
                                <source src="${content.url || content}" type="audio/mpeg">
                                Your browser does not support the audio tag.
                            </audio>
                            <div class="audio-info" style="margin-top: 12px; display: flex; justify-content: space-between; font-size: 13px; color: #6B7280;">
                                <span>üéµ ${content.title || 'Ïò§ÎîîÏò§ ÌååÏùº'}</span>
                                ${content.duration ? `<span>${content.duration}</span>` : ''}
                            </div>
                        </div>`;
                
                // ========== Budget Chart ==========
                case 'budget':
                case 'chart':
                    const chartId = `chart-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    setTimeout(() => {
                        renderBudgetChart(chartId, content);
                    }, 100);
                    return `
                        <div class="budget-card-content">
                            <canvas id="${chartId}" width="280" height="180"></canvas>
                            ${content.summary ? `
                                <div class="budget-summary" style="margin-top: 12px; padding: 12px; background: #F9FAFB; border-radius: 8px; font-size: 13px;">
                                    ${content.summary}
                                </div>
                            ` : ''}
                        </div>`;
                
                // ========== PDF ==========
                case 'pdf':
                    return `
                        <div class="pdf-card-content">
                            <div class="pdf-preview" style="background: #F3F4F6; padding: 20px; text-align: center; border-radius: 8px;">
                                <i class="fas fa-file-pdf" style="font-size: 48px; color: #EF4444;"></i>
                                <div style="margin-top: 12px; font-size: 14px; color: #374151;">${content.filename || 'document.pdf'}</div>
                                <a href="${content.url || content}" target="_blank" style="display: inline-block; margin-top: 12px; padding: 8px 16px; background: #EF4444; color: white; border-radius: 6px; text-decoration: none; font-size: 13px;">
                                    <i class="fas fa-external-link-alt"></i> Ïó¥Í∏∞
                                </a>
                            </div>
                        </div>`;
                
                // ========== Slides ==========
                case 'slides':
                    return `
                        <div class="slides-card-content">
                            <div class="slide-preview" style="position: relative;">
                                <img src="${content.slides ? content.slides[content.currentSlide || 0] : content}" 
                                     style="width: 100%; border-radius: 8px;" alt="Slide">
                                <div class="slide-nav" style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                                    <button onclick="prevSlide('${content.id}')" style="padding: 8px 12px; background: #F3F4F6; border: none; border-radius: 6px; cursor: pointer;">‚óÄ</button>
                                    <span style="font-size: 13px; color: #6B7280;">${(content.currentSlide || 0) + 1} / ${content.slides ? content.slides.length : 1}</span>
                                    <button onclick="nextSlide('${content.id}')" style="padding: 8px 12px; background: #F3F4F6; border: none; border-radius: 6px; cursor: pointer;">‚ñ∂</button>
                                </div>
                            </div>
                        </div>`;
                
                // ========== Figma Embed ==========
                case 'figma':
                    return `
                        <div class="figma-card-content">
                            <iframe src="${content.embedUrl || content}" 
                                    style="width: 100%; height: 400px; border: none; border-radius: 8px;" 
                                    allowfullscreen>
                            </iframe>
                        </div>`;
                
                // ========== Notion Embed ==========
                case 'notion':
                    return `
                        <div class="notion-card-content">
                            <div style="background: #F3F4F6; padding: 20px; text-align: center; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 8px;">üìù</div>
                                <div style="font-size: 14px; color: #374151; margin-bottom: 12px;">${content.title || 'Notion Page'}</div>
                                <a href="${content.url || content}" target="_blank" style="display: inline-block; padding: 8px 16px; background: #000; color: white; border-radius: 6px; text-decoration: none; font-size: 13px;">
                                    <i class="fas fa-external-link-alt"></i> NotionÏóêÏÑú Ïó¥Í∏∞
                                </a>
                            </div>
                        </div>`;
                
                // ========== Markdown ==========
                case 'markdown':
                    // Simple markdown rendering (basic support)
                    let md = content.replace(/\n/g, '<br>');
                    md = md.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    md = md.replace(/\*(.*?)\*/g, '<em>$1</em>');
                    md = md.replace(/`(.*?)`/g, '<code style="background: #F3F4F6; padding: 2px 6px; border-radius: 4px; font-size: 13px;">$1</code>');
                    return `<div class="markdown-content" style="line-height: 1.6;">${md}</div>`;
                
                // ========== Text (Default) ==========
                case 'text':
                default:
                    return `<p style="line-height: 1.6; margin: 0;">${content.replace ? content.replace(/\n/g, '<br>') : content}</p>`;
            }
        }
        
        // ========== Budget Chart Renderer ==========
        function renderBudgetChart(chartId, data) {
            const canvas = document.getElementById(chartId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Simple budget chart rendering (without Chart.js for now)
            if (data.type === 'pie' || !data.type) {
                // Draw simple pie chart
                const total = data.values ? data.values.reduce((a, b) => a + b, 0) : 100;
                const colors = ['#8B5CF6', '#3B82F6', '#10B981', '#F59E0B', '#EF4444'];
                
                let startAngle = -Math.PI / 2;
                (data.values || [60, 40]).forEach((value, index) => {
                    const sliceAngle = (value / total) * 2 * Math.PI;
                    
                    ctx.fillStyle = colors[index % colors.length];
                    ctx.beginPath();
                    ctx.moveTo(140, 90);
                    ctx.arc(140, 90, 70, startAngle, startAngle + sliceAngle);
                    ctx.closePath();
                    ctx.fill();
                    
                    startAngle += sliceAngle;
                });
                
                // Draw legend
                (data.labels || ['ÏÇ¨Ïö©', 'ÏûîÏï°']).forEach((label, index) => {
                    ctx.fillStyle = colors[index % colors.length];
                    ctx.fillRect(10, 10 + index * 20, 12, 12);
                    
                    ctx.fillStyle = '#374151';
                    ctx.font = '12px Inter, sans-serif';
                    ctx.fillText(label, 28, 20 + index * 20);
                });
            }
        }
        
        // Get next card position (auto-layout)
        function getNextCardPosition() {
            const cols = 3;
            const cardWidth = 340;  // 320 + 20 gap
            const cardHeight = 260; // 240 + 20 gap
            const index = canvas.cards.length;
            
            return {
                x: (index % cols) * cardWidth + 50,
                y: Math.floor(index / cols) * cardHeight + 50
            };
        }
        
        // Make card draggable
        function makeCardDraggable(card) {
            let isDragging = false;
            let dragOffsetX, dragOffsetY;
            
            const header = card.querySelector('.card-header');
            
            header.addEventListener('mousedown', (e) => {
                if (e.target.closest('.card-actions')) return; // Ignore button clicks
                
                isDragging = true;
                card.classList.add('dragging');
                
                const rect = card.getBoundingClientRect();
                const viewportRect = canvasViewport.getBoundingClientRect();
                
                dragOffsetX = (e.clientX - rect.left) / canvas.scale;
                dragOffsetY = (e.clientY - rect.top) / canvas.scale;
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const viewportRect = canvasViewport.getBoundingClientRect();
                    const newX = (e.clientX - viewportRect.left - canvas.x) / canvas.scale - dragOffsetX;
                    const newY = (e.clientY - viewportRect.top - canvas.y) / canvas.scale - dragOffsetY;
                    
                    card.style.left = newX + 'px';
                    card.style.top = newY + 'px';
                }
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    card.classList.remove('dragging');
                }
            });
        }
        
        // Card Actions
        function copyCardContent(cardId) {
            const cardData = canvas.cards.find(c => c.id === cardId);
            if (cardData) {
                navigator.clipboard.writeText(cardData.content);
                showToast('üìã Ïπ¥Îìú ÎÇ¥Ïö©Ïù¥ Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
            }
        }
        
        function exportToFigma(cardId) {
            showToast('üé® Figma ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï§ÄÎπÑ Ï§ë...');
            // TODO: Implement Figma export
        }
        
        function exportToNotion(cardId) {
            showToast('üìù Notion ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ï§ÄÎπÑ Ï§ë...');
            // TODO: Implement Notion export
        }
        
        function deleteCard(cardId) {
            const cardIndex = canvas.cards.findIndex(c => c.id === cardId);
            if (cardIndex !== -1) {
                const card = canvas.cards[cardIndex];
                card.element.remove();
                canvas.cards.splice(cardIndex, 1);
                showToast('üóëÔ∏è Ïπ¥ÎìúÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            }
        }
        
        // ==========================================
        // üß™ Test: Create sample cards on load
        // ==========================================
        window.addEventListener('load', () => {
            // Sample 1: Text Card
            createCanvasCard({
                type: 'text',
                title: 'üìù Ï†ÑÏãú ÎùºÎ≤® Ï¥àÏïà',
                content: 'ÏûëÌíàÎ™Ö: Î≥ÑÏù¥ ÎπõÎÇòÎäî Î∞§\nÏûëÍ∞Ä: ÎπàÏÑºÌä∏ Î∞ò Í≥†Ìùê\nÏ†úÏûëÏó∞ÎèÑ: 1889ÎÖÑ\nÏû¨Î£å: Ï∫îÎ≤ÑÏä§Ïóê Ïú†Ï±Ñ\n\nÏù¥ ÏûëÌíàÏùÄ Í≥†ÌùêÍ∞Ä ÏÉùÎ†àÎØ∏Ïùò Ï†ïÏã†Î≥ëÏõêÏóê Î®∏Î¨ºÎçò ÏãúÍ∏∞Ïóê Í∑∏Î¶∞ Í≤ÉÏúºÎ°ú...'
            });
            
            // Sample 2: Budget Chart Card
            createCanvasCard({
                type: 'budget',
                title: 'üí∞ ÏòàÏÇ∞ ÌòÑÌô©',
                content: {
                    values: [18500000, 11500000],
                    labels: ['ÏÇ¨Ïö© (62%)', 'ÏûîÏï° (38%)'],
                    type: 'pie',
                    summary: '<strong>Ï¥ù ÏòàÏÇ∞:</strong> 30,000,000Ïõê<br><strong>ÏÇ¨Ïö©:</strong> 18,500,000Ïõê (62%)<br><strong>ÏûîÏï°:</strong> 11,500,000Ïõê (38%)'
                }
            });
            
            // Sample 3: Image Card
            createCanvasCard({
                type: 'image',
                title: 'üñºÔ∏è Ï†ÑÏãú Ìè¨Ïä§ÌÑ∞',
                content: {
                    url: 'https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=400',
                    alt: 'Ï†ÑÏãú Ìè¨Ïä§ÌÑ∞',
                    caption: 'Ïù∏ÏÉÅÏ£ºÏùò Í±∏ÏûëÏ†Ñ - 2025.03 ~ 2025.05'
                }
            });
            
            // Sample 4: Video Card
            createCanvasCard({
                type: 'video',
                title: 'üé¨ ÌôçÎ≥¥ ÏòÅÏÉÅ',
                content: {
                    url: 'https://www.w3schools.com/html/mov_bbb.mp4',
                    caption: 'ÎÆ§ÏßÄÏóÑ ÌôçÎ≥¥ ÏòÅÏÉÅ (30Ï¥à)'
                }
            });
            
            // Sample 5: Audio Card
            createCanvasCard({
                type: 'audio',
                title: 'üé§ Ïò§ÎîîÏò§ Í∞ÄÏù¥Îìú',
                content: {
                    url: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                    title: 'Ï†ÑÏãú Ïò§ÎîîÏò§ Í∞ÄÏù¥Îìú',
                    duration: '03:24'
                }
            });
            
            // Sample 6: PDF Card
            createCanvasCard({
                type: 'pdf',
                title: 'üìÑ Ï†úÏïàÏÑú',
                content: {
                    url: 'https://example.com/proposal.pdf',
                    filename: 'Ïù∏ÏÉÅÏ£ºÏùò_ÌäπÎ≥ÑÏ†Ñ_Ï†úÏïàÏÑú.pdf'
                }
            });
            
            // Sample 7: Markdown Card
            createCanvasCard({
                type: 'markdown',
                title: 'üìã Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏',
                content: '## Ï§ÄÎπÑÏÇ¨Ìï≠\n\n- [x] ÏòàÏÇ∞ ÏäπÏù∏\n- [x] ÏûëÌíà ÎåÄÏó¨ Í≥ÑÏïΩ\n- [ ] Ï†ÑÏãú Í≥µÍ∞Ñ ÏÑ§Í≥Ñ\n- [ ] ÌôçÎ≥¥ ÏûêÎ£å Ï†úÏûë\n\n**Ï§ëÏöî**: *3Ïõî 1ÏùºÍπåÏßÄ* Î™®Îì† Ï§ÄÎπÑ ÏôÑÎ£å'
            });
            
            // Sample 8: Notion Card
            createCanvasCard({
                type: 'notion',
                title: 'üìù Notion Î¨∏ÏÑú',
                content: {
                    url: 'https://notion.so/example',
                    title: 'ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ Î¨∏ÏÑú'
                }
            });
        });
        
        // ==========================================
        // Original State
        // ==========================================
        let eventSource = null;
        let sessionId = null;
        
        // ‚≠ê Conversation History
        let conversationHistory = [];
        let currentConversationId = null;
        
        // Tab Switching - Updated for new panels
        document.querySelectorAll('.preview-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                
                // Update active tab
                document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update active panel
                document.querySelectorAll('.preview-panel').forEach(p => p.classList.remove('active'));
                
                // Show corresponding panel
                const panelMap = {
                    'overview': 'overviewPanel',
                    'widgets': 'widgetsPanel',
                    'results': 'resultsPanel'
                };
                
                const panelId = panelMap[tabName];
                if (panelId) {
                    document.getElementById(panelId).classList.add('active');
                }
            });
        });
        
        // History Item Click
        document.querySelectorAll('.history-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.history-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // ==========================================
        // üéØ AI Î™®Îç∏ ÏÑ†ÌÉù Î∞è ÏùåÏÑ± ÏûÖÎ†• Í∏∞Îä•
        // ==========================================
        
        // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú AI Î™®Îç∏
        let currentAIModel = 'gpt-4';
        
        // AI Î™®Îç∏ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
        const aiModelSelect = document.getElementById('aiModelSelect');
        if (aiModelSelect) {
            aiModelSelect.addEventListener('change', function(e) {
                currentAIModel = e.target.value;
                console.log('‚úÖ AI Î™®Îç∏ Î≥ÄÍ≤Ω:', currentAIModel);
                
                // UI ÌîºÎìúÎ∞±
                showToast(`AI Î™®Îç∏Ïù¥ ${e.target.options[e.target.selectedIndex].text}Î°ú Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.`);
            });
        }
        
        // ÏùåÏÑ± Ïù∏Ïãù Ï¥àÍ∏∞Ìôî (Web Speech API)
        let recognition = null;
        let isRecording = false;
        
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.maxAlternatives = 1;
            
            recognition.onstart = function() {
                console.log('üé§ ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë');
                isRecording = true;
                const voiceButton = document.getElementById('voiceButton');
                if (voiceButton) {
                    voiceButton.classList.add('recording');
                }
            };
            
            recognition.onresult = function(event) {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                const messageInput = document.getElementById('messageInput');
                if (finalTranscript) {
                    // ÏµúÏ¢Ö Í≤∞Í≥ºÎ•º ÏûÖÎ†•Ï∞ΩÏóê Ï∂îÍ∞Ä
                    messageInput.value += (messageInput.value ? ' ' : '') + finalTranscript;
                    console.log('‚úÖ ÏùåÏÑ± Ïù∏Ïãù ÏôÑÎ£å:', finalTranscript);
                } else if (interimTranscript) {
                    // Ï§ëÍ∞Ñ Í≤∞Í≥ºÎ•º ÎØ∏Î¶¨ Î≥¥Í∏∞
                    console.log('üé§ Ïù∏Ïãù Ï§ë:', interimTranscript);
                }
            };
            
            recognition.onerror = function(event) {
                console.error('‚ùå ÏùåÏÑ± Ïù∏Ïãù Ïò§Î•ò:', event.error);
                isRecording = false;
                const voiceButton = document.getElementById('voiceButton');
                if (voiceButton) {
                    voiceButton.classList.remove('recording');
                }
                
                // ÏÇ¨Ïö©Ïûê ÏπúÌôîÏ†Å Ïò§Î•ò Î©îÏãúÏßÄ
                let errorMessage = 'ÏùåÏÑ± Ïù∏Ïãù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                switch(event.error) {
                    case 'no-speech':
                        errorMessage = 'ÏùåÏÑ±Ïù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.';
                        break;
                    case 'audio-capture':
                        errorMessage = 'ÎßàÏù¥ÌÅ¨Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§. ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                        break;
                    case 'not-allowed':
                        errorMessage = 'ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
                        break;
                    case 'network':
                        errorMessage = 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
                        break;
                }
                showToast(errorMessage, 'error');
            };
            
            recognition.onend = function() {
                console.log('üé§ ÏùåÏÑ± Ïù∏Ïãù Ï¢ÖÎ£å');
                isRecording = false;
                const voiceButton = document.getElementById('voiceButton');
                if (voiceButton) {
                    voiceButton.classList.remove('recording');
                }
            };
        }
        
        // ÏùåÏÑ± ÏûÖÎ†• Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        const voiceButton = document.getElementById('voiceButton');
        if (voiceButton) {
            voiceButton.addEventListener('click', function() {
                if (!recognition) {
                    showToast('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§. Chrome, Edge, SafariÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                    return;
                }
                
                if (isRecording) {
                    // ÎÖπÏùå Ï§ëÏßÄ
                    recognition.stop();
                    console.log('‚èπÔ∏è ÏùåÏÑ± Ïù∏Ïãù Ï§ëÏßÄ');
                } else {
                    // ÎÖπÏùå ÏãúÏûë
                    try {
                        recognition.start();
                        showToast('üé§ ÏùåÏÑ± ÏûÖÎ†•ÏùÑ ÏãúÏûëÌï©ÎãàÎã§. ÎßêÏîÄÌï¥Ï£ºÏÑ∏Ïöî.');
                    } catch (error) {
                        console.error('ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë Ïã§Ìå®:', error);
                        showToast('ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏãúÏûëÌï† Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                    }
                }
            });
        }
        
        // Toast ÏïåÎ¶º Ìï®Ïàò
        function showToast(message, type = 'info') {
            // Í∏∞Ï°¥ toast Ï†úÍ±∞
            const existingToast = document.querySelector('.custom-toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `custom-toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#EF4444' : '#10B981'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                font-weight: 500;
                max-width: 350px;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Toast Ïï†ÎãàÎ©îÏù¥ÏÖò CSS Ï∂îÍ∞Ä
        if (!document.getElementById('toast-animations')) {
            const style = document.createElement('style');
            style.id = 'toast-animations';
            style.textContent = `
                @keyframes slideInRight {
                    from {
                        transform: translateX(400px);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                @keyframes slideOutRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(400px);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Send Message
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to conversation
            addMessage('user', message);
            
            // Clear input
            input.value = '';
            
            // Disable send button
            document.getElementById('sendButton').disabled = true;
            
            // Send to AI
            await executeAICommand(message);
        }
        
        function addMessage(type, text, showActions = false) {
            const conversationArea = document.getElementById('conversationArea');
            const timestamp = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            const messageId = `msg_${Date.now()}`;
            
            const actionsHtml = showActions && type === 'ai' ? `
                <div class="message-actions">
                    <button class="message-action-btn" onclick="copyMessage('${messageId}')">
                        <i data-lucide="copy" stroke-width="2"></i>
                        <span>Î≥µÏÇ¨</span>
                    </button>
                    <button class="message-action-btn" onclick="saveToNotion('${messageId}')">
                        <i data-lucide="book-open" stroke-width="2"></i>
                        <span>Notion</span>
                    </button>
                    <button class="message-action-btn" onclick="saveToFigma('${messageId}')">
                        <i data-lucide="figma" stroke-width="2"></i>
                        <span>Figma</span>
                    </button>
                </div>
            ` : '';
            
            const messageHtml = `
                <div class="message ${type}" id="${messageId}">
                    ${type === 'ai' ? `
                    <div class="message-avatar">
                        <i data-lucide="sparkles" stroke-width="2"></i>
                    </div>
                    ` : ''}
                    <div class="message-content">
                        <div class="message-text">${text}</div>
                        <div class="message-timestamp">${timestamp}</div>
                        ${actionsHtml}
                    </div>
                    ${type === 'user' ? `
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    ` : ''}
                </div>
            `;
            
            conversationArea.insertAdjacentHTML('beforeend', messageHtml);
            conversationArea.scrollTop = conversationArea.scrollHeight;
            
            // ‚≠ê Save to conversation history
            conversationHistory.push({
                id: messageId,
                type: type,
                text: text,
                timestamp: timestamp,
                showActions: showActions
            });
            
            // Auto-save conversation to localStorage
            saveConversation();
            
            return messageId;
        }
        
        /**
         * ‚≠ê Save conversation to localStorage
         */
        function saveConversation() {
            if (!currentConversationId) {
                currentConversationId = `conv_${Date.now()}`;
            }
            
            const conversation = {
                id: currentConversationId,
                title: getConversationTitle(),
                messages: conversationHistory,
                timestamp: new Date().toISOString(),
                aiModel: currentAIModel || 'gpt-4'
            };
            
            // Get existing conversations
            const saved = JSON.parse(localStorage.getItem('museflow_conversations') || '[]');
            
            // Update or add current conversation
            const index = saved.findIndex(c => c.id === currentConversationId);
            if (index >= 0) {
                saved[index] = conversation;
            } else {
                saved.unshift(conversation);
            }
            
            // Keep only last 50 conversations
            const limited = saved.slice(0, 50);
            localStorage.setItem('museflow_conversations', JSON.stringify(limited));
            
            console.log('üíæ Conversation saved:', currentConversationId);
        }
        
        /**
         * ‚≠ê Get conversation title (from first user message)
         */
        function getConversationTitle() {
            const firstUserMessage = conversationHistory.find(m => m.type === 'user');
            if (firstUserMessage) {
                const title = firstUserMessage.text.substring(0, 50);
                return title + (firstUserMessage.text.length > 50 ? '...' : '');
            }
            return 'ÏÉà ÎåÄÌôî';
        }
        
        /**
         * ‚≠ê Load conversation from localStorage
         */
        function loadConversation(conversationId) {
            const saved = JSON.parse(localStorage.getItem('museflow_conversations') || '[]');
            const conversation = saved.find(c => c.id === conversationId);
            
            if (conversation) {
                currentConversationId = conversation.id;
                conversationHistory = conversation.messages;
                
                // Clear conversation area
                const conversationArea = document.getElementById('conversationArea');
                conversationArea.innerHTML = '';
                
                // Render all messages
                conversation.messages.forEach(msg => {
                    addMessage(msg.type, msg.text, msg.showActions);
                });
                
                console.log('üìÇ Conversation loaded:', conversationId);
                showToast('ÎåÄÌôîÎ•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
            }
        }
        
        /**
         * ‚≠ê Start new conversation
         */
        function startNewConversation() {
            currentConversationId = null;
            conversationHistory = [];
            
            const conversationArea = document.getElementById('conversationArea');
            conversationArea.innerHTML = `
                <div class="message ai" id="welcome-msg">
                    <div class="message-avatar">
                        <i data-lucide="sparkles" stroke-width="2"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            ÏïàÎÖïÌïòÏÑ∏Ïöî! üëã MuseFlow AIÏûÖÎãàÎã§.<br>
                            Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî? Ï†ÑÏãú Í∏∞Ìöç, ÏòàÏÇ∞ Í¥ÄÎ¶¨, ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Îì± Î™®Îì† ÏóÖÎ¨¥Î•º ÏûêÎèôÌôîÌï¥ÎìúÎ¶ΩÎãàÎã§.
                        </div>
                        <div class="message-timestamp">Î∞©Í∏à Ï†Ñ</div>
                    </div>
                </div>
            `;
            
            lucide.createIcons();
            console.log('üÜï New conversation started');
            showToast('ÏÉà ÎåÄÌôîÎ•º ÏãúÏûëÌñàÏäµÎãàÎã§.');
        }
        
        /**
         * ‚≠ê Get all saved conversations
         */
        function getSavedConversations() {
            return JSON.parse(localStorage.getItem('museflow_conversations') || '[]');
        }
        
        async function executeAICommand(command) {
            try {
                // AI Î™®Îç∏ Ï†ïÎ≥¥ ÌëúÏãú
                const modelName = document.getElementById('aiModelSelect')?.options[document.getElementById('aiModelSelect').selectedIndex]?.text || 'GPT-4';
                addMessage('ai', `ü§î ${modelName}Ïù¥(Í∞Ä) Î™ÖÎ†πÏùÑ Î∂ÑÏÑùÌïòÍ≥† ÏûàÏäµÎãàÎã§...`, true);
                
                // Add to active tasks in overview panel
                addActiveTask(command.substring(0, 30) + '...');
                
                // Call API (Î∞±ÏóîÎìú Ïä§ÌÇ§ÎßàÏóê ÎßûÏ∂§)
                const response = await fetch('/api/orchestrator/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: command,
                        mode: 'conversational',
                        aiModel: currentAIModel, // ‚≠ê AI Î™®Îç∏ Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                        projectContext: {
                            projectId: 'canvas-demo',
                            projectName: 'Canvas V4 ÏûëÏóÖ',
                            source: 'canvas-v4-hybrid'
                        },
                        options: {
                            autoApprove: false
                        }
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'API Ìò∏Ï∂ú Ïã§Ìå®');
                }
                
                sessionId = data.sessionId;
                
                addMessage('ai', `‚úÖ AI ÏÑ∏ÏÖòÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§. (Session ID: ${sessionId.substring(0, 8)}...)`, true);
                
                // Connect to SSE
                connectToEventStream(sessionId);
                
            } catch (error) {
                console.error('AI Ïã§Ìñâ Ïò§Î•ò:', error);
                addMessage('ai', `‚ùå Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`, true);
                document.getElementById('sendButton').disabled = false;
                removeActiveTask();
            }
        }
        
        function connectToEventStream(sessionId) {
            if (eventSource) {
                eventSource.close();
            }
            
            eventSource = new EventSource(`/api/orchestrator/stream/${sessionId}`);
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleStreamEvent(data);
            };
            
            eventSource.onerror = function(error) {
                console.error('SSE Ïò§Î•ò:', error);
                eventSource.close();
                document.getElementById('sendButton').disabled = false;
            };
        }
        
        function handleStreamEvent(data) {
            const { type, message, data: payload } = data;
            
            console.log('[SSE Event]', type, message);
            
            switch (type) {
                case 'connection-established':
                    console.log('[SSE] Ïó∞Í≤∞ ÏÑ±Í≥µ:', message);
                    break;
                
                case 'session-started':
                    addMessage('ai', `üöÄ ${message}`, true);
                    if (payload?.workflow) {
                        addMessage('ai', `üìã ÏõåÌÅ¨ÌîåÎ°úÏö∞: ${payload.workflow.phases?.length || 0}Í∞ú Îã®Í≥Ñ`, true);
                    }
                    break;
                
                case 'phase-started':
                    const phaseName = payload?.phaseName || message;
                    addPhaseProgress(phaseName, 0);
                    break;
                
                case 'agent-action':
                    updatePhaseProgress(message || payload?.action || 'ÏûëÏóÖ Ï§ë...');
                    break;
                
                case 'phase-completed':
                    updatePhaseProgress('ÏôÑÎ£å', 100);
                    
                    // ‚≠ê Canvas V5: Create Canvas Card from AI Result
                    if (payload?.result) {
                        const result = payload.result;
                        
                        // Determine card type and content
                        let cardType = 'text';
                        let cardContent = '';
                        let cardTitle = payload.phaseName || 'AI ÏÉùÏÑ± Í≤∞Í≥º';
                        
                        if (result.output) {
                            cardContent = result.output;
                        } else if (result.result) {
                            cardContent = result.result;
                        } else if (result.canvasNodes) {
                            cardType = 'widget';
                            cardContent = `Canvas ÎÖ∏Îìú ${result.canvasNodes.length}Í∞ú ÏÉùÏÑ±Îê®`;
                        } else if (result.widgets) {
                            cardType = 'chart';
                            cardContent = `ÎåÄÏãúÎ≥¥Îìú ÏúÑÏ†Ø ${result.widgets.length}Í∞ú ÏÉùÏÑ±Îê®`;
                        } else {
                            cardContent = JSON.stringify(result, null, 2);
                        }
                        
                        // Create Canvas Card
                        createCanvasCard({
                            type: cardType,
                            title: cardTitle,
                            content: cardContent
                        });
                        
                        showToast(`‚ú® CanvasÏóê ÏÉà Ïπ¥ÎìúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!`);
                    }
                    
                    // Add results to preview (legacy support)
                    if (payload?.result?.canvasNodes) {
                        addCanvasNodes(payload.result.canvasNodes);
                    }
                    if (payload?.result?.widgets) {
                        addDashboardWidgets(payload.result.widgets);
                    }
                    
                    // ÏÉùÏÑ± Í≤∞Í≥º ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
                    if (payload?.result?.canvasNodes || payload?.result?.widgets) {
                        switchToResultsTab();
                    }
                    break;
                
                case 'phase-failed':
                    addMessage('ai', `‚ö†Ô∏è Îã®Í≥Ñ Ïã§Ìå®: ${message}`, true);
                    break;
                
                case 'session-completed':
                    // ÏôÑÎ£å Î©îÏãúÏßÄÏóê Ïï°ÏÖò Î≤ÑÌäº ÌëúÏãú
                    addMessage('ai', '‚úÖ Î™®Îì† ÏûëÏóÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! Ïö∞Ï∏° "ÏÉùÏÑ± Í≤∞Í≥º" ÌÉ≠ÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.', true);
                    document.getElementById('sendButton').disabled = false;
                    removeActiveTask();
                    eventSource.close();
                    
                    // ÏôÑÎ£åÎêú ÏûëÏóÖ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
                    updateCompletedTasksCount();
                    break;
                
                case 'session-failed':
                    addMessage('ai', `‚ùå Ïã§Ìñâ Ïã§Ìå®: ${message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`, true);
                    document.getElementById('sendButton').disabled = false;
                    removeActiveTask();
                    eventSource.close();
                    break;
                
                default:
                    console.log('[SSE] Unknown event type:', type);
            }
        }
        
        function addPhaseProgress(phaseName, progress) {
            const conversationArea = document.getElementById('conversationArea');
            const timestamp = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            const progressHtml = `
                <div class="message ai">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>${phaseName}</strong> Îã®Í≥ÑÎ•º Ïã§ÌñâÌïòÍ≥† ÏûàÏäµÎãàÎã§...
                        </div>
                        <div class="phase-progress" data-phase="${phaseName}">
                            <div class="phase-title">ÏßÑÌñâ Ï§ë...</div>
                            <div class="phase-bar">
                                <div class="phase-bar-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="message-timestamp">${timestamp}</div>
                    </div>
                </div>
            `;
            
            conversationArea.insertAdjacentHTML('beforeend', progressHtml);
            conversationArea.scrollTop = conversationArea.scrollHeight;
        }
        
        function switchToResultsTab() {
            // Ïö∞Ï∏° Ìå®ÎÑêÏùò "ÏÉùÏÑ± Í≤∞Í≥º" ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
            const previewTabs = document.querySelectorAll('.preview-tab');
            const previewPanels = document.querySelectorAll('.preview-panel');
            
            previewTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === 'results') {
                    tab.classList.add('active');
                }
            });
            
            previewPanels.forEach(panel => {
                panel.classList.remove('active');
                if (panel.id === 'resultsPanel') {
                    panel.classList.add('active');
                }
            });
            
            // Î™®Î∞îÏùº: Preview ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
            if (window.innerWidth <= 768) {
                const mobileTabs = document.querySelectorAll('.mobile-tab');
                mobileTabs.forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-mobile-tab') === 'preview') {
                        tab.classList.add('active');
                    }
                });
                
                document.querySelector('.left-column').classList.remove('mobile-active');
                document.querySelector('.center-column').classList.remove('mobile-active');
                document.querySelector('.right-column').classList.add('mobile-active');
            }
        }
        
        function updateCompletedTasksCount() {
            const completedCount = document.getElementById('completedTasksCount');
            if (completedCount) {
                const currentValue = parseInt(completedCount.textContent) || 0;
                completedCount.textContent = `${currentValue + 1}Í∞ú`;
            }
        }
        
        function updatePhaseProgress(status, progress = null) {
            const phaseProgress = document.querySelector('.phase-progress:last-of-type');
            if (!phaseProgress) return;
            
            const title = phaseProgress.querySelector('.phase-title');
            const fill = phaseProgress.querySelector('.phase-bar-fill');
            
            title.textContent = status;
            if (progress !== null) {
                fill.style.width = progress + '%';
            }
        }
        
        function addCanvasNodes(nodes) {
            const resultsSection = document.getElementById('canvasResults');
            resultsSection.innerHTML = '';
            
            // Make canvas container relative for absolute positioning
            resultsSection.style.position = 'relative';
            resultsSection.style.minHeight = '600px';
            resultsSection.style.overflow = 'visible';
            
            // Node type configuration
            const nodeConfig = {
                'budget': { icon: 'coins', label: 'ÏòàÏÇ∞' },
                'chart': { icon: 'chart-bar', label: 'Ï∞®Ìä∏' },
                'concept': { icon: 'lightbulb', label: 'Ïª®ÏÖâ' },
                'education': { icon: 'graduation-cap', label: 'ÍµêÏú°' },
                'artwork': { icon: 'palette', label: 'ÏûëÌíà' },
                'document': { icon: 'file-text', label: 'Î¨∏ÏÑú' },
                'default': { icon: 'box', label: 'ÎÖ∏Îìú' }
            };
            
            nodes.forEach((node, index) => {
                const nodeType = node.type || 'default';
                const config = nodeConfig[nodeType] || nodeConfig.default;
                
                // Add connection indicator for sequential nodes
                const connectionLine = index > 0 ? `
                    <div style="height: 20px; width: 2px; background: linear-gradient(180deg, transparent 0%, #8B5CF6 50%, transparent 100%); margin: 0 auto -10px; opacity: 0.5;"></div>
                ` : '';
                
                // Load saved position or calculate default position
                const savedLayout = loadCanvasLayout();
                const savedNode = savedLayout.nodes?.find(n => n.id === node.id || n.index === index);
                
                const defaultX = 50;
                const defaultY = 50 + (index * 180); // Stack vertically with spacing
                const posX = savedNode?.x ?? defaultX;
                const posY = savedNode?.y ?? defaultY;
                
                const nodeHtml = `
                    <div class="canvas-node" 
                         data-type="${nodeType}" 
                         data-node-id="${node.id || index}"
                         data-index="${index}"
                         style="left: ${posX}px; top: ${posY}px;">
                        <div class="canvas-node-header">
                            <div class="canvas-node-title">
                                <i data-lucide="grip-vertical" stroke-width="2" style="width: 16px; height: 16px; opacity: 0.5; margin-right: 0.5rem; display: inline-block;"></i>
                                ${node.title}
                            </div>
                            <div class="canvas-node-icon">
                                <i data-lucide="${config.icon}" stroke-width="2"></i>
                            </div>
                        </div>
                        <div class="canvas-node-content">
                            ${node.description || `${config.label} ÎÖ∏ÎìúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.`}
                        </div>
                        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.2); font-size: 0.75rem; opacity: 0.8;">
                            <i data-lucide="clock" stroke-width="2" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;"></i>
                            ${new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })}
                        </div>
                    </div>
                `;
                resultsSection.insertAdjacentHTML('beforeend', nodeHtml);
            });
            
            // Re-initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Show canvas controls
            const canvasControls = document.getElementById('canvasControls');
            if (canvasControls && nodes.length > 0) {
                canvasControls.style.display = 'block';
            }
            
            // Initialize drag & drop for all nodes
            initializeCanvasDragDrop();
            
            // Draw connection lines between nodes
            drawConnectionLines();
            
            // DashboardÏóê ÎÖ∏Îìú ÏÉùÏÑ± ÏïåÎ¶º
            notifyDashboardUpdate({
                type: 'canvas_nodes',
                title: `Canvas ÎÖ∏Îìú ${nodes.length}Í∞ú ÏÉùÏÑ±`,
                data: nodes
            });
            
            // Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            updateOverviewStats();
        }
        
        function addDashboardWidgets(widgets) {
            const resultsSection = document.getElementById('canvasResults');
            
            widgets.forEach(widget => {
                const widgetHtml = `
                    <div class="widget-preview" style="background: white; border: 1px solid var(--museflow-border-light); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 0.75rem;">
                        <div class="widget-header" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <div class="widget-icon" style="color: var(--museflow-primary);">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="widget-title" style="font-weight: 700; color: var(--museflow-text-primary);">${widget.title}</div>
                        </div>
                        <div class="widget-content" style="font-size: 0.875rem; color: var(--museflow-text-secondary);">
                            ${widget.description || 'Dashboard ÏúÑÏ†ØÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.'}
                        </div>
                    </div>
                `;
                resultsSection.insertAdjacentHTML('beforeend', widgetHtml);
            });
            
            // DashboardÏóê ÏúÑÏ†Ø ÏÉùÏÑ± ÏïåÎ¶º
            notifyDashboardUpdate({
                type: 'dashboard_widgets',
                title: `Dashboard ÏúÑÏ†Ø ${widgets.length}Í∞ú ÏÉùÏÑ±`,
                data: widgets
            });
            
            // Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            updateOverviewStats();
            
            // Results ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
            document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('[data-tab="results"]').classList.add('active');
            document.querySelectorAll('.preview-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('resultsPanel').classList.add('active');
        }
        
        /**
         * Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
         */
        function updateOverviewStats() {
            // ÏßÑÌñâ Ï§ëÏù∏ ÏûëÏóÖ Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const activeCount = document.getElementById('activeTasksCount');
            if (activeCount) {
                const currentValue = parseInt(activeCount.textContent) || 0;
                activeCount.textContent = `${currentValue + 1}Í∞ú`;
            }
        }
        
        /**
         * AI ÏûëÏóÖ ÏãúÏûë Ïãú Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÌëúÏãú
         */
        function addActiveTask(taskName) {
            const activeTasksList = document.getElementById('activeTasksList');
            const noTasks = activeTasksList.querySelector('.no-tasks');
            
            if (noTasks) {
                noTasks.remove();
            }
            
            const taskHtml = `
                <div class="active-task-item" id="task-${Date.now()}" style="padding: 0.75rem; background: var(--museflow-primary-light); border-radius: var(--radius-md); margin-bottom: 0.5rem; animation: slideIn 0.3s ease;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-spinner fa-spin" style="color: var(--museflow-primary);"></i>
                        <span style="font-size: 0.875rem; font-weight: 600; color: var(--museflow-text-primary);">${taskName}</span>
                    </div>
                    <div class="task-progress" style="height: 4px; background: rgba(139, 92, 246, 0.2); border-radius: 2px; overflow: hidden;">
                        <div class="task-progress-bar" style="height: 100%; background: var(--museflow-primary); width: 0%; transition: width 1s ease;"></div>
                    </div>
                </div>
            `;
            
            activeTasksList.insertAdjacentHTML('beforeend', taskHtml);
            
            // Progress bar Ïï†ÎãàÎ©îÏù¥ÏÖò
            setTimeout(() => {
                const progressBar = activeTasksList.querySelector('.task-progress-bar:last-of-type');
                if (progressBar) {
                    progressBar.style.width = '60%';
                }
            }, 100);
        }
        
        /**
         * AI ÏûëÏóÖ ÏôÑÎ£å Ïãú Ïã§ÏãúÍ∞Ñ ÌòÑÌô©ÏóêÏÑú Ï†úÍ±∞
         */
        function removeActiveTask() {
            const activeTasksList = document.getElementById('activeTasksList');
            const tasks = activeTasksList.querySelectorAll('.active-task-item');
            
            if (tasks.length > 0) {
                tasks[tasks.length - 1].remove();
            }
            
            if (activeTasksList.children.length === 0) {
                activeTasksList.innerHTML = `
                    <div class="no-tasks">
                        <i class="fas fa-coffee"></i>
                        <p>ÌòÑÏû¨ ÏßÑÌñâ Ï§ëÏù∏ ÏûëÏóÖÏù¥ ÏóÜÏäµÎãàÎã§</p>
                    </div>
                `;
            }
        }
        
        // ==========================================
        // Dashboard ‚Üí Canvas Ïó∞Îèô: Task ÏûêÎèô Ïã§Ìñâ
        // ==========================================
        
        /**
         * ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú DashboardÏóêÏÑú Ï†ÑÎã¨Îêú TaskÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏
         */
        function checkPendingDashboardTask() {
            const pendingTask = localStorage.getItem('pending_canvas_task');
            
            if (pendingTask) {
                try {
                    const taskData = JSON.parse(pendingTask);
                    console.log('[Canvas ‚Üê Dashboard] Received task:', taskData);
                    
                    // Task Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú (Ìïú Î≤àÎßå Ïã§Ìñâ)
                    localStorage.removeItem('pending_canvas_task');
                    
                    // TaskÏóê ÎßûÎäî AI Î™ÖÎ†π ÏûêÎèô Ïã§Ìñâ
                    executeTaskFromDashboard(taskData);
                    
                } catch (error) {
                    console.error('[Canvas] Task parsing error:', error);
                }
            }
        }
        
        /**
         * Dashboard TaskÎ•º Canvas AI Î™ÖÎ†πÏúºÎ°ú Î≥ÄÌôò Î∞è Ïã§Ìñâ
         */
        function executeTaskFromDashboard(taskData) {
            const { title, type, project } = taskData;
            
            // Task Ïú†ÌòïÎ≥Ñ AI Î™ÖÎ†π ÏÉùÏÑ±
            let aiCommand = '';
            
            switch (type) {
                case 'document':
                    aiCommand = `${project || 'ÌîÑÎ°úÏ†ùÌä∏'}Ïùò "${title}" Î¨∏ÏÑúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. Ï†ÑÏãú ÎùºÎ≤®, Î≥¥ÎèÑÏûêÎ£å, Í∏∞ÌöçÏïà Îì±ÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.`;
                    break;
                case 'budget':
                    aiCommand = `${project || 'ÌîÑÎ°úÏ†ùÌä∏'}Ïùò ÏòàÏÇ∞ÏïàÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. Ìï≠Î™©Î≥Ñ ÏòàÏÇ∞ Î∂ÑÏÑùÍ≥º Ï∞®Ìä∏Î•º Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.`;
                    break;
                case 'promotion':
                    aiCommand = `${project || 'ÌîÑÎ°úÏ†ùÌä∏'}Ïùò ÌôçÎ≥¥ Í≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌï¥Ï£ºÏÑ∏Ïöî. SNS ÏΩòÌÖêÏ∏†, Ïù¥Î©îÏùº Ï∫†ÌéòÏù∏, Î≥¥ÎèÑÏûêÎ£åÎ•º Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.`;
                    break;
                case 'research':
                    aiCommand = `"${title}"Ïóê ÎåÄÌïú ÌïôÏà† ÏûêÎ£åÎ•º Ï°∞ÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî. ÏúÑÌÇ§ÌîºÎîîÏïÑ, MET Museum, Google ScholarÏóêÏÑú Í≤ÄÏÉâÌï¥Ï£ºÏÑ∏Ïöî.`;
                    break;
                default:
                    aiCommand = `${project || 'ÌîÑÎ°úÏ†ùÌä∏'}Ïùò "${title}" ÏûëÏóÖÏùÑ ÎèÑÏôÄÏ£ºÏÑ∏Ïöî.`;
            }
            
            // AI Î™ÖÎ†π ÏûêÎèô ÏûÖÎ†•
            const messageInput = document.getElementById('messageInput');
            messageInput.value = aiCommand;
            
            // ÌôòÏòÅ Î©îÏãúÏßÄ ÌëúÏãú
            addMessage('ai', `üëã ÏïàÎÖïÌïòÏÑ∏Ïöî! DashboardÏóêÏÑú "${title}" ÏûëÏóÖÏùÑ Ï†ÑÎã¨Î∞õÏïòÏäµÎãàÎã§. ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?`, true);
            
            // 2Ï¥à ÌõÑ ÏûêÎèô Ïã§Ìñâ (ÏÇ¨Ïö©ÏûêÍ∞Ä ÌôïÏù∏Ìï† ÏãúÍ∞Ñ Ï†úÍ≥µ)
            setTimeout(() => {
                sendMessage();
            }, 2000);
        }
        
        /**
         * Canvas ‚Üí Dashboard ÏúÑÏ†Ø ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º
         */
        function notifyDashboardUpdate(updateData) {
            // LocalStorageÎ•º ÌÜµÌïú Dashboard ÏóÖÎç∞Ïù¥Ìä∏ ÏïåÎ¶º
            const dashboardUpdates = JSON.parse(localStorage.getItem('dashboard_updates') || '[]');
            dashboardUpdates.push({
                timestamp: Date.now(),
                type: updateData.type,
                title: updateData.title,
                data: updateData.data
            });
            
            localStorage.setItem('dashboard_updates', JSON.stringify(dashboardUpdates));
            
            console.log('[Canvas ‚Üí Dashboard] Update sent:', updateData);
        }
        
        // ==========================================
        // AI Message Action Buttons
        // ==========================================
        
        /**
         * Î©îÏãúÏßÄ Î≥µÏÇ¨
         */
        function copyMessage(messageId) {
            const message = document.getElementById(messageId);
            const textElement = message.querySelector('.message-text');
            const text = textElement.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showActionSuccess(messageId, 'copy', 'Î≥µÏÇ¨ ÏôÑÎ£å!');
                
                // ÏûêÎèôÏúºÎ°ú Îã§Ïùå Îã®Í≥Ñ ÏßÑÌñâ (2Ï¥à ÌõÑ)
                setTimeout(() => {
                    console.log('[Auto Next] Î≥µÏÇ¨ ÏôÑÎ£å ‚Üí Îã§Ïùå ÏûëÏóÖ ÎåÄÍ∏∞ Ï§ë...');
                }, 2000);
            }).catch(err => {
                console.error('Î≥µÏÇ¨ Ïã§Ìå®:', err);
                alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            });
        }
        
        /**
         * NotionÏóê Ï†ÄÏû•
         */
        async function saveToNotion(messageId) {
            const message = document.getElementById(messageId);
            const textElement = message.querySelector('.message-text');
            const text = textElement.innerText;
            
            showActionSuccess(messageId, 'notion', 'Notion Ï†ÄÏû• Ï§ë...');
            
            try {
                // Get title from current conversation context
                const conversationTitle = document.querySelector('.column-title')?.textContent || 'AI ÎåÄÌôî Í≤∞Í≥º';
                
                // Call Notion API
                const response = await fetch('/api/notion/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: conversationTitle + ' - ' + new Date().toLocaleDateString('ko-KR'),
                        content: text,
                        type: 'budget-approval'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('[Notion] Saved successfully:', result);
                    showActionSuccess(messageId, 'notion', 'Notion Ï†ÄÏû• ÏôÑÎ£å! ‚úì');
                    
                    // ÏûêÎèôÏúºÎ°ú Îã§Ïùå Îã®Í≥Ñ ÏßÑÌñâ
                    setTimeout(() => {
                        console.log('[Auto Next] Notion Ï†ÄÏû• ÏôÑÎ£å ‚Üí Dashboard ÏúÑÏ†Ø ÏóÖÎç∞Ïù¥Ìä∏...');
                        notifyDashboardUpdate({
                            type: 'notion-saved',
                            data: {
                                messageId,
                                notionPageId: result.notionPageId,
                                url: result.url,
                                timestamp: result.createdAt
                            }
                        });
                    }, 1000);
                } else {
                    throw new Error(result.error || 'Notion Ï†ÄÏû• Ïã§Ìå®');
                }
                
            } catch (error) {
                console.error('Notion Ï†ÄÏû• Ïã§Ìå®:', error);
                showActionSuccess(messageId, 'notion', 'Notion Ï†ÄÏû• Ïã§Ìå® ‚úó');
                alert('Notion Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }
        
        /**
         * FigmaÏóê Ï†ÄÏû•
         */
        async function saveToFigma(messageId) {
            const message = document.getElementById(messageId);
            const textElement = message.querySelector('.message-text');
            const text = textElement.innerText;
            
            showActionSuccess(messageId, 'figma', 'Figma Ï†ÄÏû• Ï§ë...');
            
            try {
                // Check Figma API status first
                const statusResponse = await fetch('/api/figma/status');
                const statusData = await statusResponse.json();
                
                if (!statusData.configured) {
                    console.warn('‚ö†Ô∏è Figma API not configured, using mock mode');
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    showActionSuccess(messageId, 'figma', 'Figma Ï†ÄÏû• ÏôÑÎ£å (Mock)');
                    return;
                }
                
                // Real Figma API integration
                // For now, we sync a mock canvas node
                const nodeData = {
                    node: {
                        title: 'AI Generated Content',
                        description: text.substring(0, 200),
                        type: 'document',
                        timestamp: new Date().toISOString()
                    },
                    fileKey: 'default-museflow-file' // TODO: Make this configurable
                };
                
                const syncResponse = await fetch('/api/figma/sync-node', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(nodeData)
                });
                
                const syncData = await syncResponse.json();
                
                if (syncData.success) {
                    showActionSuccess(messageId, 'figma', 'Figma Ï†ÄÏû• ÏôÑÎ£å!');
                    console.log('‚úÖ Synced to Figma:', syncData.data);
                    
                    // Auto next step: Dashboard widget update
                    setTimeout(() => {
                        console.log('[Auto Next] Figma Ï†ÄÏû• ÏôÑÎ£å ‚Üí Dashboard ÏúÑÏ†Ø ÏóÖÎç∞Ïù¥Ìä∏...');
                    }, 2000);
                } else {
                    throw new Error(syncData.error || 'Figma sync failed');
                }
                
            } catch (error) {
                console.error('‚ùå Figma Ï†ÄÏû• Ïã§Ìå®:', error);
                showActionSuccess(messageId, 'figma', 'Figma Ï†ÄÏû• Ïã§Ìå®');
                
                // Show user-friendly error
                setTimeout(() => {
                    const btn = message.querySelector('[onclick*="saveToFigma"]');
                    if (btn) {
                        btn.style.opacity = '1';
                    }
                }, 2000);
            }
        }
        
        /**
         * Ïï°ÏÖò ÏÑ±Í≥µ UI ÏóÖÎç∞Ïù¥Ìä∏
         */
        function showActionSuccess(messageId, actionType, message) {
            const messageElement = document.getElementById(messageId);
            const buttons = messageElement.querySelectorAll('.message-action-btn');
            
            buttons.forEach(btn => {
                const iconClass = btn.querySelector('i').className;
                
                if ((actionType === 'copy' && iconClass.includes('copy')) ||
                    (actionType === 'notion' && iconClass.includes('fa-notion')) ||
                    (actionType === 'figma' && iconClass.includes('fa-figma'))) {
                    
                    btn.classList.add('success');
                    const span = btn.querySelector('span');
                    const originalText = span.textContent;
                    span.textContent = '‚úì ' + message;
                    
                    // 3Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú
                    setTimeout(() => {
                        btn.classList.remove('success');
                        span.textContent = originalText;
                    }, 3000);
                }
            });
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Dashboard Task ÌôïÏù∏
        checkPendingDashboardTask();
        
        // ==========================================
        // Mobile Tab Navigation
        // ==========================================
        
        /**
         * Î™®Î∞îÏùº ÌÉ≠ Ï†ÑÌôò Ìï∏Îì§Îü¨
         */
        function initializeMobileTabs() {
            const mobileTabs = document.querySelectorAll('.mobile-tab');
            const leftColumn = document.querySelector('.left-column');
            const centerColumn = document.querySelector('.center-column');
            const rightColumn = document.querySelector('.right-column');
            
            // Í∏∞Î≥∏Í∞í: conversation (AI Chat) ÌÉ≠ ÌôúÏÑ±Ìôî
            if (window.innerWidth <= 768) {
                centerColumn.classList.add('mobile-active');
            }
            
            // Enhanced mobile tab switching with touch support
            let touchStartX = 0;
            let touchEndX = 0;
            let currentTabIndex = 1; // Start with conversation (middle)
            const tabNames = ['history', 'conversation', 'preview'];
            
            function switchToTab(tabName) {
                // Remove active class from all tabs
                mobileTabs.forEach(t => t.classList.remove('active'));
                
                // Add active to clicked tab
                const targetTab = Array.from(mobileTabs).find(t => 
                    t.getAttribute('data-mobile-tab') === tabName
                );
                if (targetTab) {
                    targetTab.classList.add('active');
                }
                
                // Use requestAnimationFrame for smooth transitions
                requestAnimationFrame(() => {
                    // Hide all columns
                    leftColumn.classList.remove('mobile-active');
                    centerColumn.classList.remove('mobile-active');
                    rightColumn.classList.remove('mobile-active');
                    
                    // Show selected column
                    switch(tabName) {
                        case 'history':
                            leftColumn.classList.add('mobile-active');
                            currentTabIndex = 0;
                            break;
                        case 'conversation':
                            centerColumn.classList.add('mobile-active');
                            currentTabIndex = 1;
                            break;
                        case 'preview':
                            rightColumn.classList.add('mobile-active');
                            currentTabIndex = 2;
                            break;
                    }
                    
                    // Scroll to top of new column
                    const activeColumn = document.querySelector('.mobile-active');
                    if (activeColumn) {
                        activeColumn.scrollTop = 0;
                    }
                });
            }
            
            mobileTabs.forEach(tab => {
                // Click/Touch event
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-mobile-tab');
                    switchToTab(tabName);
                    
                    // Haptic feedback for supported devices
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                });
                
                // Accessibility: Keyboard support
                tab.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const tabName = this.getAttribute('data-mobile-tab');
                        switchToTab(tabName);
                    }
                });
            });
            
            // Swipe gesture support for tab switching
            const container = document.querySelector('.canvas-container');
            
            container.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            container.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeThreshold = 50; // Minimum swipe distance
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Swipe left - next tab
                        if (currentTabIndex < tabNames.length - 1) {
                            switchToTab(tabNames[currentTabIndex + 1]);
                        }
                    } else {
                        // Swipe right - previous tab
                        if (currentTabIndex > 0) {
                            switchToTab(tabNames[currentTabIndex - 1]);
                        }
                    }
                }
            }
        }
        
        // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Í∞êÏßÄ
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                // Desktop: Î™®Îì† Ïª¨Îüº ÌëúÏãú
                document.querySelectorAll('.left-column, .center-column, .right-column').forEach(col => {
                    col.classList.remove('mobile-active');
                });
            } else {
                // Mobile: ÌôúÏÑ± ÌÉ≠Ïóê Îî∞Îùº Ïª¨Îüº ÌëúÏãú
                initializeMobileTabs();
            }
        });
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Î™®Î∞îÏùº ÌÉ≠ Ï¥àÍ∏∞Ìôî
        if (window.innerWidth <= 768) {
            initializeMobileTabs();
        }
        
        // ==========================================
        // Quick Actions - Dashboard Î©îÎâ¥ ÌÜµÌï©
        // ==========================================
        
        /**
         * Quick Action Î™ÖÎ†πÏñ¥ Îß§Ìïë
         */
        const quickActionCommands = {
            'exhibition-label': {
                title: 'Ï†ÑÏãú ÎùºÎ≤® ÏûëÏÑ±',
                prompt: 'Ï†ÑÏãú ÎùºÎ≤®ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. ÏûëÌíàÎ™Ö, ÏûëÍ∞Ä, Ïó∞ÎèÑ, Ïû¨Î£å, ÌÅ¨Í∏∞, ÏÜåÏû• Ï†ïÎ≥¥Î•º Ìè¨Ìï®Ìïú Ï†ÑÎ¨∏Ï†ÅÏù∏ ÎùºÎ≤®ÏùÑ ÎßåÎì§Ïñ¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üìù'
            },
            'budget-approval': {
                title: 'ÏòàÏÇ∞ ÏäπÏù∏ ÏöîÏ≤≠',
                prompt: 'ÏòàÏÇ∞ ÏäπÏù∏ ÏöîÏ≤≠ Î¨∏ÏÑúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. Ìï≠Î™©Î≥Ñ ÏòàÏÇ∞, ÏÇ¨Ïö© Î™©Ï†Å, Í∏∞ÎåÄ Ìö®Í≥ºÎ•º Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üí∞'
            },
            'artwork-selection': {
                title: 'ÏÜåÏû•Ìíà ÏÑ†Ï†ï',
                prompt: 'Ï†ÑÏãú ÏÜåÏû•Ìíà ÏÑ†Ï†ï Í∏∞ÌöçÏïàÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. ÏûëÌíà Î™©Î°ù, ÏÑ†Ï†ï Í∏∞Ï§Ä, Î∞∞Ïπò Í≥ÑÌöçÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üé®'
            },
            'promotion-plan': {
                title: 'ÌôçÎ≥¥ Í≥ÑÌöç ÏàòÎ¶Ω',
                prompt: 'ÌôçÎ≥¥ Í≥ÑÌöçÏùÑ ÏàòÎ¶ΩÌï¥Ï£ºÏÑ∏Ïöî. SNS ÏΩòÌÖêÏ∏†, Î≥¥ÎèÑÏûêÎ£å, Ïù¥Î©îÏùº Ï∫†ÌéòÏù∏, ÏùºÏ†ïÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üì¢'
            },
            'report-writing': {
                title: 'Î≥¥Í≥†ÏÑú ÏûëÏÑ±',
                prompt: 'ÏóÖÎ¨¥ Î≥¥Í≥†ÏÑúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. ÌòÑÌô©, ÏÑ±Í≥º, Í≥ºÏ†ú, Ìñ•ÌõÑ Í≥ÑÌöçÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üìÑ'
            },
            'schedule-management': {
                title: 'Ï†ÑÏãú ÏùºÏ†ï Í¥ÄÎ¶¨',
                prompt: 'Ï†ÑÏãú ÏùºÏ†ï Í¥ÄÎ¶¨ Í≥ÑÌöçÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. Ï§ÄÎπÑ Îã®Í≥ÑÎ≥Ñ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ÏôÄ ÎßàÏùºÏä§ÌÜ§ÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üóìÔ∏è'
            },
            'education-program': {
                title: 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Í∏∞Ìöç',
                prompt: 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®ÏùÑ Í∏∞ÌöçÌï¥Ï£ºÏÑ∏Ïöî. ÎåÄÏÉÅ, Ïª§Î¶¨ÌÅòÎüº, ÌôúÎèô ÎÇ¥Ïö©, ÌèâÍ∞Ä Î∞©Î≤ïÏùÑ Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üë•'
            },
            'research': {
                title: 'ÌïôÏà† ÏûêÎ£å Ï°∞ÏÇ¨',
                prompt: 'ÌïôÏà† ÏûêÎ£åÎ•º Ï°∞ÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî. Wikipedia, MET Museum, Google ScholarÏóêÏÑú Í¥ÄÎ†® Ï†ïÎ≥¥Î•º ÏàòÏßëÌï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üîç'
            },
            'visitor-guide': {
                title: 'Î∞©Î¨∏Í∞ù ÏïàÎÇ¥',
                prompt: 'AI Ï±óÎ¥áÏùÑ ÌÜµÌï¥ Î∞©Î¨∏Í∞ù ÏßàÎ¨∏Ïóê ÎãµÎ≥ÄÌïòÍ≥† Ï†ÑÏãú ÎèôÏÑ†ÏùÑ Ï∂îÏ≤úÌï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üí¨'
            },
            'space-optimization': {
                title: 'Í≥µÍ∞Ñ ÏµúÏ†ÅÌôî',
                prompt: 'Ï†ÑÏãú Í≥µÍ∞ÑÏùò ÏûëÌíà Î∞∞ÏπòÎ•º 3D ÏãúÎÆ¨Î†àÏù¥ÏÖòÏúºÎ°ú ÏµúÏ†ÅÌôîÌï¥Ï£ºÏÑ∏Ïöî. Î∞©Î¨∏Í∞ù ÎèôÏÑ†Í≥º ÌòºÏû°ÎèÑÎ•º Î∂ÑÏÑùÌï¥Ï£ºÏÑ∏Ïöî.',
                icon: 'üèõÔ∏è',
                action: () => {
                    // ÌòÑÏû¨ Canvas Îç∞Ïù¥ÌÑ∞Î•º Digital TwinÏúºÎ°ú Ï†ÑÎã¨
                    const canvasData = {
                        widgets: Array.from(document.querySelectorAll('.widget')).length,
                        timestamp: new Date().toISOString(),
                        source: 'canvas-v4'
                    };
                    
                    // LocalStorageÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    localStorage.setItem('museflow_canvas_data', JSON.stringify(canvasData));
                    
                    // Digital Twin ÌéòÏù¥ÏßÄ Ïó¥Í∏∞
                    window.open('/digital-twin', '_blank');
                    
                    // Console log
                    console.log('üèõÔ∏è ÎîîÏßÄÌÑ∏ Ìä∏Ïúà ÎØ∏Ïà†Í¥Ä Pro Ïó¥Í∏∞ - Îç∞Ïù¥ÌÑ∞ Ï†ÑÎã¨ ÏôÑÎ£å');
                }
            }
        };
        
        /**
         * Quick Action Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨
         */
        document.querySelectorAll('.quick-action-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                const command = quickActionCommands[action];
                
                if (!command) return;
                
                // Special action handler (e.g., 3D Viewer)
                if (command.action) {
                    command.action();
                    return;
                }
                
                // AI ÏûÖÎ†•Ï∞ΩÏóê ÌîÑÎ°¨ÌîÑÌä∏ ÏûêÎèô ÏûÖÎ†•
                const messageInput = document.getElementById('messageInput');
                messageInput.value = command.prompt;
                
                // ÌôòÏòÅ Î©îÏãúÏßÄ
                addMessage('ai', `${command.icon} "${command.title}" ÏûëÏóÖÏùÑ ÏãúÏûëÌï©ÎãàÎã§. ÏûêÎèôÏúºÎ°ú Ïã§ÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?`, true);
                
                // Î™®Î∞îÏùº: Conversation ÌÉ≠ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôò
                if (window.innerWidth <= 768) {
                    document.querySelectorAll('.mobile-tab').forEach(tab => {
                        tab.classList.remove('active');
                        if (tab.getAttribute('data-mobile-tab') === 'conversation') {
                            tab.classList.add('active');
                        }
                    });
                    
                    document.querySelector('.left-column').classList.remove('mobile-active');
                    document.querySelector('.center-column').classList.add('mobile-active');
                    document.querySelector('.right-column').classList.remove('mobile-active');
                }
                
                // ÏûÖÎ†•Ï∞Ω Ìè¨Ïª§Ïä§
                messageInput.focus();
                
                // 2Ï¥à ÌõÑ ÏûêÎèô Ï†ÑÏÜ°
                setTimeout(() => {
                    sendMessage();
                }, 2000);
            });
        });
        
        // ====================================
        // Unified Navbar JavaScript - Identical to Dashboard
        // ====================================
        
        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const unifiedNavLinks = document.getElementById('unifiedNavLinks');
        
        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                unifiedNavLinks.classList.toggle('mobile-open');
                
                // Change icon
                const icon = this.querySelector('i');
                if (unifiedNavLinks.classList.contains('mobile-open')) {
                    icon.className = 'fas fa-times';
                } else {
                    icon.className = 'fas fa-bars';
                }
            });
            
            // Close menu when clicking a link
            document.querySelectorAll('.unified-nav-links a').forEach(link => {
                link.addEventListener('click', function() {
                    unifiedNavLinks.classList.remove('mobile-open');
                    mobileMenuToggle.classList.remove('active');
                    const icon = mobileMenuToggle.querySelector('i');
                    icon.className = 'fas fa-bars';
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.unified-navbar')) {
                    unifiedNavLinks.classList.remove('mobile-open');
                    mobileMenuToggle.classList.remove('active');
                    const icon = mobileMenuToggle.querySelector('i');
                    if (icon) icon.className = 'fas fa-bars';
                }
            });
        }
        
        // Fallback functions if not defined on page
        window.showAIRecommendations = window.showAIRecommendations || function() {
            console.log('[Canvas V4] AI Recommendations clicked');
        };
        
        window.filterFavorites = window.filterFavorites || function() {
            console.log('[Canvas V4] Favorites clicked');
        };
        
        window.toggleNotifications = window.toggleNotifications || function() {
            console.log('[Canvas V4] Notifications clicked');
        };
        
        // Scroll Animation - Hide/Show Navbar
        let lastScrollTop = 0;
        let scrollTimeout;
        
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.unified-navbar');
            if (!navbar) return;
            
            const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
            
            // Add scrolled class for shadow effect
            if (currentScroll > 50) {
                navbar.classList.add('navbar-scrolled');
            } else {
                navbar.classList.remove('navbar-scrolled');
            }
            
            // Hide navbar on scroll down, show on scroll up
            if (currentScroll > lastScrollTop && currentScroll > 100) {
                navbar.classList.add('navbar-hidden');
            } else {
                navbar.classList.remove('navbar-hidden');
            }
            
            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            
            // Show navbar when user stops scrolling
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                navbar.classList.remove('navbar-hidden');
            }, 1500);
        });
        
        // ==========================================
        // Widget System - Dynamic Loading (103 Widgets)
        // ==========================================
        
        let allWidgets = [];
        let allCategories = [];
        let selectedCategory = null;
        
        /**
         * Load all widgets from API
         */
        async function loadWidgets() {
            try {
                const response = await fetch('/api/widgets');
                const result = await response.json();
                
                if (result.success) {
                    allWidgets = result.data;
                    renderWidgets(allWidgets);
                    updateWidgetCount(allWidgets.length, allWidgets.length);
                    console.log(`‚úÖ Loaded ${allWidgets.length} widgets`);
                } else {
                    throw new Error(result.error || 'Failed to load widgets');
                }
            } catch (error) {
                console.error('‚ùå Widget loading error:', error);
                document.getElementById('liveWidgets').innerHTML = `
                    <div class="error-state" style="text-align: center; padding: 3rem 1rem; color: var(--status-error);">
                        <i data-lucide="alert-circle" style="width: 48px; height: 48px; margin: 0 auto 1rem;"></i>
                        <div style="font-size: 1rem; font-weight: 600;">ÏúÑÏ†Ø Î°úÎî© Ïã§Ìå®</div>
                        <div style="font-size: 0.875rem; margin-top: 0.5rem;">${error.message}</div>
                    </div>
                `;
                lucide.createIcons();
            }
        }
        
        /**
         * Load widget categories from API
         */
        async function loadCategories() {
            try {
                const response = await fetch('/api/widgets/categories');
                const result = await response.json();
                
                if (result.success) {
                    allCategories = result.data;
                    renderCategories(allCategories);
                    console.log(`‚úÖ Loaded ${allCategories.length} categories`);
                }
            } catch (error) {
                console.error('‚ùå Category loading error:', error);
            }
        }
        
        /**
         * Render category filter buttons
         */
        function renderCategories(categories) {
            const container = document.getElementById('widgetCategories');
            
            const categoryButtons = categories.map(cat => `
                <button 
                    class="category-btn ${selectedCategory === cat.category ? 'active' : ''}" 
                    data-category="${cat.category}"
                    style="
                        padding: 0.5rem 0.875rem;
                        background: ${selectedCategory === cat.category ? 'var(--museflow-primary)' : 'white'};
                        color: ${selectedCategory === cat.category ? 'white' : 'var(--museflow-text-primary)'};
                        border: 1px solid ${selectedCategory === cat.category ? 'var(--museflow-primary)' : 'var(--museflow-border-light)'};
                        border-radius: var(--radius-full);
                        font-size: 0.8125rem;
                        font-weight: 500;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    "
                    onmouseover="if(!this.classList.contains('active')) this.style.background='var(--museflow-primary-light)'"
                    onmouseout="if(!this.classList.contains('active')) this.style.background='white'"
                >
                    ${cat.category} <span style="opacity: 0.75;">(${cat.count})</span>
                </button>
            `).join('');
            
            container.innerHTML = `
                <button 
                    class="category-btn ${selectedCategory === null ? 'active' : ''}" 
                    data-category="all"
                    style="
                        padding: 0.5rem 0.875rem;
                        background: ${selectedCategory === null ? 'var(--museflow-primary)' : 'white'};
                        color: ${selectedCategory === null ? 'white' : 'var(--museflow-text-primary)'};
                        border: 1px solid ${selectedCategory === null ? 'var(--museflow-primary)' : 'var(--museflow-border-light)'};
                        border-radius: var(--radius-full);
                        font-size: 0.8125rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    "
                    onmouseover="if(!this.classList.contains('active')) this.style.background='var(--museflow-primary-light)'"
                    onmouseout="if(!this.classList.contains('active')) this.style.background='white'"
                >
                    Ï†ÑÏ≤¥ <span style="opacity: 0.75;">(${allWidgets.length})</span>
                </button>
                ${categoryButtons}
            `;
            
            // Add click handlers
            container.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    selectedCategory = category === 'all' ? null : category;
                    
                    // Update active state
                    container.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('active');
                        b.style.background = 'white';
                        b.style.color = 'var(--museflow-text-primary)';
                        b.style.borderColor = 'var(--museflow-border-light)';
                    });
                    this.classList.add('active');
                    this.style.background = 'var(--museflow-primary)';
                    this.style.color = 'white';
                    this.style.borderColor = 'var(--museflow-primary)';
                    
                    // Filter widgets
                    filterWidgets();
                });
            });
        }
        
        /**
         * Filter widgets by category and search
         */
        function filterWidgets() {
            const searchTerm = document.getElementById('widgetSearch').value.toLowerCase();
            
            let filtered = allWidgets;
            
            // Filter by category
            if (selectedCategory) {
                filtered = filtered.filter(w => w.category === selectedCategory);
            }
            
            // Filter by search
            if (searchTerm) {
                filtered = filtered.filter(w => 
                    w.name.toLowerCase().includes(searchTerm) || 
                    (w.description && w.description.toLowerCase().includes(searchTerm))
                );
            }
            
            renderWidgets(filtered);
            updateWidgetCount(filtered.length, allWidgets.length);
        }
        
        /**
         * Render widgets grid
         */
        function renderWidgets(widgets) {
            const container = document.getElementById('liveWidgets');
            
            if (widgets.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 3rem 1rem; color: var(--museflow-text-secondary);">
                        <i data-lucide="search-x" style="width: 48px; height: 48px; margin: 0 auto 1rem;"></i>
                        <div style="font-size: 1rem; font-weight: 600;">ÏúÑÏ†ØÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</div>
                        <div style="font-size: 0.875rem; margin-top: 0.5rem;">Í≤ÄÏÉâÏñ¥ ÎòêÎäî ÌïÑÌÑ∞Î•º Î≥ÄÍ≤ΩÌï¥Î≥¥ÏÑ∏Ïöî</div>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            const widgetCards = widgets.map(widget => {
                const iconMap = {
                    'fa-sparkles': 'sparkles',
                    'fa-magic': 'wand-2',
                    'fa-smile': 'smile',
                    'fa-lightbulb': 'lightbulb',
                    'fa-camera': 'camera',
                    'fa-graduation-cap': 'graduation-cap',
                    'fa-language': 'languages',
                    'fa-user-tie': 'user-check',
                    'fa-headphones': 'headphones',
                    'fa-universal-access': 'accessibility',
                    'fa-child': 'baby',
                    'fa-chart-line': 'line-chart',
                    'fa-chart-pie': 'pie-chart',
                    'fa-chart-bar': 'bar-chart',
                    'fa-chart-area': 'radar',
                    'fa-circle': 'circle',
                    'fa-calendar-check': 'calendar-check',
                    'fa-comment-dots': 'message-circle',
                    'fa-globe': 'globe',
                    'fa-coins': 'coins',
                    'fa-calendar': 'calendar',
                    'fa-tasks': 'list-checks',
                    'fa-users': 'users'
                };
                
                const lucideIcon = iconMap[widget.icon] || 'box';
                
                return `
                    <div class="widget-card" 
                         data-widget-id="${widget.id}" 
                         data-widget-name="${widget.name}"
                         data-widget-category="${widget.category}"
                         draggable="true"
                         style="cursor: grab; transition: all 0.2s ease;" 
                         onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.15)';"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <div class="widget-header-small">
                            <i data-lucide="grip-vertical" style="width: 14px; height: 14px; margin-right: 0.25rem; opacity: 0.5;"></i>
                            <i data-lucide="${lucideIcon}" style="width: 18px; height: 18px;"></i>
                            <span>${widget.name}</span>
                        </div>
                        <div class="widget-content" style="font-size: 0.8125rem; color: var(--museflow-text-secondary); margin-top: 0.5rem; line-height: 1.4;">
                            ${widget.description || 'ÏúÑÏ†Ø ÏÑ§Î™Ö ÏóÜÏùå'}
                        </div>
                        <div class="widget-footer" style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--museflow-border-light);">
                            <span style="font-size: 0.75rem; color: var(--museflow-text-tertiary);">${widget.category}</span>
                            <button class="add-widget-btn" style="padding: 0.375rem 0.75rem; background: var(--museflow-primary); color: white; border: none; border-radius: var(--radius-sm); font-size: 0.75rem; font-weight: 600; cursor: pointer;">
                                Ï∂îÍ∞Ä
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;">
                    ${widgetCards}
                </div>
            `;
            
            // Re-initialize Lucide icons
            lucide.createIcons();
            
            // Add click handlers for "Ï∂îÍ∞Ä" buttons
            container.querySelectorAll('.add-widget-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const widgetCard = this.closest('.widget-card');
                    const widgetId = widgetCard.dataset.widgetId;
                    const widget = allWidgets.find(w => w.id == widgetId);
                    
                    if (widget) {
                        addWidgetToDashboard(widget);
                    }
                });
            });
            
            // ‚≠ê Add drag and drop handlers for widget cards
            container.querySelectorAll('.widget-card').forEach(card => {
                // Drag start
                card.addEventListener('dragstart', function(e) {
                    e.dataTransfer.effectAllowed = 'copy';
                    e.dataTransfer.setData('widget-id', this.dataset.widgetId);
                    e.dataTransfer.setData('widget-name', this.dataset.widgetName);
                    
                    // Visual feedback
                    this.style.opacity = '0.5';
                    this.style.cursor = 'grabbing';
                    
                    console.log('üéØ Dragging widget:', this.dataset.widgetName);
                });
                
                // Drag end
                card.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                    this.style.cursor = 'grab';
                });
            });
        }
        
        /**
         * Update widget count display
         */
        function updateWidgetCount(showing, total) {
            const countEl = document.getElementById('widgetCount');
            countEl.innerHTML = `
                <i data-lucide="box" style="width: 14px; height: 14px;"></i>
                <span>${showing}Í∞ú ÏúÑÏ†Ø ÌëúÏãú Ï§ë</span>
                ${showing !== total ? `<span style="opacity: 0.75;"> / Ï†ÑÏ≤¥ ${total}Í∞ú</span>` : ''}
            `;
            lucide.createIcons();
        }
        
        /**
         * Add widget to dashboard
         */
        function addWidgetToDashboard(widget) {
            console.log('‚ú® Adding widget to dashboard:', widget.name);
            
            // Show success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--status-success);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--radius-md);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                    <div>
                        <div style="font-weight: 600;">${widget.name}</div>
                        <div style="font-size: 0.875rem; opacity: 0.9;">DashboardÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§</div>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
            
            // TODO: Actually add to dashboard via API
            // This would call the dashboard API to persist the widget
        }
        
        /**
         * Initialize widget system
         */
        async function initializeWidgetSystem() {
            await Promise.all([
                loadWidgets(),
                loadCategories()
            ]);
            
            // Initialize drop zones after widgets are loaded
            initializeDropZones();
        }
        
        /**
         * ‚≠ê Initialize Drop Zones for Widget Drag & Drop
         */
        function initializeDropZones() {
            const dropZones = [
                document.getElementById('overviewPanel'),
                document.getElementById('widgetsPanel'),
                document.getElementById('resultsPanel')
            ];
            
            dropZones.forEach(zone => {
                if (!zone) return;
                
                // Drag over
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    
                    // Visual feedback
                    this.style.backgroundColor = 'rgba(139, 92, 246, 0.05)';
                    this.style.border = '2px dashed var(--museflow-primary)';
                });
                
                // Drag leave
                zone.addEventListener('dragleave', function(e) {
                    if (e.target === this) {
                        this.style.backgroundColor = '';
                        this.style.border = '';
                    }
                });
                
                // Drop
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    // Remove visual feedback
                    this.style.backgroundColor = '';
                    this.style.border = '';
                    
                    // Get widget data
                    const widgetId = e.dataTransfer.getData('widget-id');
                    const widgetName = e.dataTransfer.getData('widget-name');
                    
                    if (widgetId) {
                        const widget = allWidgets.find(w => w.id == widgetId);
                        if (widget) {
                            console.log('‚úÖ Widget dropped:', widgetName);
                            addWidgetToDashboard(widget);
                            
                            // Haptic feedback (if supported)
                            if (navigator.vibrate) {
                                navigator.vibrate(50);
                            }
                        }
                    }
                });
            });
            
            console.log('üéØ Drop zones initialized for drag & drop');
        }
        
        // ==========================================
        // Canvas Node Drag & Drop System
        // ==========================================
        
        let draggedNode = null;
        let dragOffset = { x: 0, y: 0 };
        let canvasLayout = { nodes: [] };
        
        /**
         * Initialize drag & drop for all canvas nodes
         */
        function initializeCanvasDragDrop() {
            const nodes = document.querySelectorAll('.canvas-node');
            
            nodes.forEach(node => {
                // Mouse down - start dragging
                node.addEventListener('mousedown', (e) => {
                    // Don't drag if clicking on buttons or interactive elements
                    if (e.target.closest('button')) return;
                    
                    draggedNode = node;
                    draggedNode.classList.add('dragging');
                    
                    const rect = node.getBoundingClientRect();
                    const parentRect = node.parentElement.getBoundingClientRect();
                    
                    dragOffset.x = e.clientX - rect.left;
                    dragOffset.y = e.clientY - rect.top;
                    
                    // Prevent text selection
                    e.preventDefault();
                });
                
                // Touch support for mobile
                node.addEventListener('touchstart', (e) => {
                    if (e.target.closest('button')) return;
                    
                    draggedNode = node;
                    draggedNode.classList.add('dragging');
                    
                    const rect = node.getBoundingClientRect();
                    const touch = e.touches[0];
                    
                    dragOffset.x = touch.clientX - rect.left;
                    dragOffset.y = touch.clientY - rect.top;
                    
                    e.preventDefault();
                });
            });
        }
        
        /**
         * Handle mouse/touch move globally
         */
        document.addEventListener('mousemove', (e) => {
            if (!draggedNode) return;
            
            const parentRect = draggedNode.parentElement.getBoundingClientRect();
            
            let x = e.clientX - parentRect.left - dragOffset.x;
            let y = e.clientY - parentRect.top - dragOffset.y;
            
            // Boundary constraints
            x = Math.max(0, Math.min(x, parentRect.width - draggedNode.offsetWidth));
            y = Math.max(0, Math.min(y, parentRect.height - draggedNode.offsetHeight));
            
            draggedNode.style.left = x + 'px';
            draggedNode.style.top = y + 'px';
            
            // Redraw connection lines
            drawConnectionLines();
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!draggedNode) return;
            
            const touch = e.touches[0];
            const parentRect = draggedNode.parentElement.getBoundingClientRect();
            
            let x = touch.clientX - parentRect.left - dragOffset.x;
            let y = touch.clientY - parentRect.top - dragOffset.y;
            
            x = Math.max(0, Math.min(x, parentRect.width - draggedNode.offsetWidth));
            y = Math.max(0, Math.min(y, parentRect.height - draggedNode.offsetHeight));
            
            draggedNode.style.left = x + 'px';
            draggedNode.style.top = y + 'px';
            
            drawConnectionLines();
            e.preventDefault();
        });
        
        /**
         * Handle mouse/touch up - end dragging
         */
        document.addEventListener('mouseup', () => {
            if (draggedNode) {
                draggedNode.classList.remove('dragging');
                
                // Save layout to localStorage
                saveCanvasLayout();
                
                draggedNode = null;
            }
        });
        
        document.addEventListener('touchend', () => {
            if (draggedNode) {
                draggedNode.classList.remove('dragging');
                saveCanvasLayout();
                draggedNode = null;
            }
        });
        
        /**
         * Draw SVG connection lines between nodes
         */
        function drawConnectionLines() {
            // Remove existing SVG
            const existingSvg = document.getElementById('canvasConnectionsSvg');
            if (existingSvg) {
                existingSvg.remove();
            }
            
            const resultsSection = document.getElementById('canvasResults');
            if (!resultsSection) return;
            
            const nodes = Array.from(resultsSection.querySelectorAll('.canvas-node'));
            if (nodes.length < 2) return;
            
            // Create SVG overlay
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.id = 'canvasConnectionsSvg';
            svg.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 0;
            `;
            
            // Draw lines between sequential nodes
            for (let i = 0; i < nodes.length - 1; i++) {
                const node1 = nodes[i];
                const node2 = nodes[i + 1];
                
                const rect1 = node1.getBoundingClientRect();
                const rect2 = node2.getBoundingClientRect();
                const parentRect = resultsSection.getBoundingClientRect();
                
                // Calculate centers
                const x1 = rect1.left - parentRect.left + rect1.width / 2;
                const y1 = rect1.top - parentRect.top + rect1.height;
                const x2 = rect2.left - parentRect.left + rect2.width / 2;
                const y2 = rect2.top - parentRect.top;
                
                // Create curved path
                const midY = (y1 + y2) / 2;
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `M ${x1} ${y1} Q ${x1} ${midY}, ${(x1 + x2) / 2} ${midY} T ${x2} ${y2}`);
                path.setAttribute('stroke', '#8B5CF6');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                path.setAttribute('opacity', '0.4');
                path.setAttribute('stroke-dasharray', '5,5');
                
                svg.appendChild(path);
                
                // Add arrow marker
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                marker.id = `arrow-${i}`;
                marker.setAttribute('markerWidth', '10');
                marker.setAttribute('markerHeight', '10');
                marker.setAttribute('refX', '5');
                marker.setAttribute('refY', '3');
                marker.setAttribute('orient', 'auto');
                marker.setAttribute('markerUnits', 'strokeWidth');
                
                const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                arrowPath.setAttribute('d', 'M0,0 L0,6 L9,3 z');
                arrowPath.setAttribute('fill', '#8B5CF6');
                arrowPath.setAttribute('opacity', '0.4');
                
                marker.appendChild(arrowPath);
                svg.appendChild(marker);
                path.setAttribute('marker-end', `url(#arrow-${i})`);
            }
            
            resultsSection.insertBefore(svg, resultsSection.firstChild);
        }
        
        /**
         * Save canvas layout to localStorage
         */
        function saveCanvasLayout() {
            const nodes = document.querySelectorAll('.canvas-node');
            const layout = {
                nodes: Array.from(nodes).map(node => ({
                    id: node.dataset.nodeId,
                    index: parseInt(node.dataset.index),
                    x: parseInt(node.style.left) || 0,
                    y: parseInt(node.style.top) || 0,
                    type: node.dataset.type
                })),
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('museflow_canvas_layout', JSON.stringify(layout));
                console.log('‚úÖ Canvas layout saved:', layout);
            } catch (error) {
                console.error('‚ùå Failed to save canvas layout:', error);
            }
        }
        
        /**
         * Load canvas layout from localStorage
         */
        function loadCanvasLayout() {
            try {
                const saved = localStorage.getItem('museflow_canvas_layout');
                if (saved) {
                    const layout = JSON.parse(saved);
                    console.log('‚úÖ Canvas layout loaded:', layout);
                    return layout;
                }
            } catch (error) {
                console.error('‚ùå Failed to load canvas layout:', error);
            }
            return { nodes: [] };
        }
        
        /**
         * Reset canvas layout to default positions
         */
        function resetCanvasLayout() {
            localStorage.removeItem('museflow_canvas_layout');
            
            const nodes = document.querySelectorAll('.canvas-node');
            nodes.forEach((node, index) => {
                const defaultX = 50;
                const defaultY = 50 + (index * 180);
                
                node.style.left = defaultX + 'px';
                node.style.top = defaultY + 'px';
            });
            
            drawConnectionLines();
            
            console.log('‚úÖ Canvas layout reset to default');
        }
        
        // ‚≠ê Debounce function for search performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Search input handler with debounce (300ms)
        const debouncedFilter = debounce(() => {
            filterWidgets();
        }, 300);
        
        document.getElementById('widgetSearch')?.addEventListener('input', function() {
            debouncedFilter();
        });
        
        // Refresh button handler
        document.getElementById('refreshWidgets')?.addEventListener('click', async function() {
            this.innerHTML = '<i data-lucide="loader" class="spin" style="width: 16px; height: 16px;"></i>';
            lucide.createIcons();
            
            await initializeWidgetSystem();
            
            this.innerHTML = '<i data-lucide="refresh-cw" style="width: 16px; height: 16px;"></i>';
            lucide.createIcons();
        });
        
        // Initialize on page load
        initializeWidgetSystem();
        
        // ====================================
        // Initialize Lucide Icons
        // ====================================
        lucide.createIcons();
        
        // Re-initialize Lucide icons after dynamic content updates
        const originalAddMessage = window.addMessage;
        if (originalAddMessage) {
            window.addMessage = function(...args) {
                const result = originalAddMessage.apply(this, args);
                // Wait for DOM update, then re-initialize icons
                setTimeout(() => lucide.createIcons(), 50);
                return result;
            };
        }
    </script>

    <!-- MuseFlow Footer -->
    <footer class="museflow-footer">
        <div class="museflow-footer-content">
            <div class="museflow-footer-logo">
                ‚ú® MuseFlow
            </div>
            <div class="museflow-footer-divider"></div>
            <div class="museflow-footer-text">
                Copyright ¬© 2026, Imageroot
            </div>
            <div class="museflow-footer-divider"></div>
            <div class="museflow-footer-text">
                Made by Hyun Woo Nam Professor
            </div>
            <div class="museflow-footer-divider"></div>
            <div class="museflow-footer-version">
                V4.0
            </div>
        </div>
    </footer>

</body>
</html>
