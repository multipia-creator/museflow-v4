<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MuseFlow Canvas - Enhanced</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Inter, sans-serif;
    background: #0a0a0a;
    color: #e5e5e5;
    overflow: hidden;
}

/* Navbar */
.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 64px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    z-index: 1001;
}

.navbar-logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 700;
    font-size: 1.25rem;
    color: #e5e5e5;
}

.navbar-logo-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.navbar-actions {
    display: flex;
    gap: 0.5rem;
}

.navbar-btn {
    width: 44px;
    height: 44px;
    background: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 12px;
    color: #9CA3AF;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.navbar-btn:hover {
    background: rgba(139, 92, 246, 0.25);
    color: #8B5CF6;
    transform: scale(1.05);
}

/* Container with navbar offset */
.container {
    display: grid;
    grid-template-columns: 40px 1fr 40px;
    height: calc(100vh - 64px - 48px); /* navbar + footer */
    margin-top: 64px;
}

.sidebar {
    background: linear-gradient(180deg, #1a1a1a, #0f0f0f);
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
    padding: 8px 3px;
    gap: 4px;
}

.sidebar.right {
    border-left: 1px solid #333;
    border-right: none;
}

.icon {
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.2s;
    position: relative;
}

.icon:hover {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

.icon.active {
    background: rgba(16, 185, 129, 0.25);
    color: #10b981;
}

.badge {
    position: absolute;
    top: 2px;
    right: 2px;
    background: #ef4444;
    color: #fff;
    font-size: 9px;
    min-width: 14px;
    height: 14px;
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
}

.canvas {
    background: #fafbfc;
    overflow: hidden;
    background-image: linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    position: relative;
}

.viewport {
    width: 100%;
    height: 100%;
    position: relative;
    cursor: grab;
}

.viewport.dragging {
    cursor: grabbing;
}

.panel {
    position: fixed;
    top: 64px;
    bottom: 48px;
    width: 280px;
    background: rgba(26, 26, 26, 0.98);
    border: 1px solid #333;
    z-index: 100;
    transform: translateX(-100%);
    transition: 0.3s;
    display: none;
}

.panel.left {
    left: 40px;
}

.panel.right {
    right: 40px;
    transform: translateX(100%);
}

.panel.active {
    display: block;
    transform: translateX(0);
}

.panel-header {
    padding: 16px;
    border-bottom: 1px solid #333;
    display: flex;
    justify-content: space-between;
}

.panel-title {
    font-size: 14px;
    font-weight: 600;
}

.panel-close {
    width: 24px;
    height: 24px;
    border: none;
    background: transparent;
    color: #666;
    cursor: pointer;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.panel-close:hover {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

.panel-content {
    padding: 16px;
    color: #999;
    font-size: 13px;
}

/* Media Card with thumbnail */
.card {
    position: absolute;
    width: 300px;
    min-width: 200px;
    min-height: 200px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    overflow: visible;
    cursor: move;
    transition: box-shadow 0.2s, transform 0.1s;
}

.card.selected {
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5), 0 8px 30px rgba(0, 0, 0, 0.2);
    z-index: 1000 !important;
}

.card:hover {
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
}

/* Resize Handles */
.resize-handle {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #8b5cf6;
    border: 2px solid #fff;
    border-radius: 50%;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 10;
}

.card.selected .resize-handle {
    opacity: 1;
}

.resize-se { bottom: -6px; right: -6px; cursor: nwse-resize; }
.resize-ne { top: -6px; right: -6px; cursor: nesw-resize; }
.resize-sw { bottom: -6px; left: -6px; cursor: nesw-resize; }
.resize-nw { top: -6px; left: -6px; cursor: nwse-resize; }
.resize-e { top: 50%; right: -6px; transform: translateY(-50%); cursor: ew-resize; }
.resize-w { top: 50%; left: -6px; transform: translateY(-50%); cursor: ew-resize; }
.resize-n { top: -6px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }
.resize-s { bottom: -6px; left: 50%; transform: translateX(-50%); cursor: ns-resize; }

.card-thumbnail {
    width: 100%;
    height: 180px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    overflow: hidden;
    position: relative;
}

.card-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.card-thumbnail video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.card-thumbnail.video {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.card-thumbnail.audio {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.card-thumbnail.image {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.card-thumbnail.document {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.card-thumbnail.data {
    background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
}

.card-header {
    padding: 12px 16px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: #fff;
    font-weight: 600;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.card-content {
    padding: 16px;
    color: #333;
    font-size: 13px;
}

.card-meta {
    display: flex;
    gap: 12px;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid #e5e7eb;
    font-size: 12px;
    color: #6b7280;
}

.controls {
    display: flex;
    gap: 8px;
    background: rgba(26, 26, 26, 0.98);
    padding: 8px 12px;
    border-radius: 12px;
    border: 1px solid #333;
    z-index: 50;
}

.ctrl-btn {
    width: 32px;
    height: 32px;
    border: 1px solid #374151;
    background: rgba(17, 24, 39, 0.6);
    color: #9ca3af;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.ctrl-btn:hover {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

.zoom-level {
    color: #9ca3af;
    font-size: 13px;
    min-width: 45px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
}

.ai-input {
    position: fixed;
    bottom: 68px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    background: rgba(26, 26, 26, 0.98);
    padding: 12px 16px;
    border-radius: 16px;
    border: 1px solid #333;
    z-index: 50;
}

.ai-select {
    padding: 6px 10px;
    background: rgba(17, 24, 39, 0.6);
    border: 1px solid #374151;
    border-radius: 8px;
    color: #e5e7eb;
    font-size: 13px;
}

.ai-field {
    flex: 1;
    min-width: 300px;
    padding: 8px 12px;
    background: rgba(17, 24, 39, 0.6);
    border: 1px solid #374151;
    border-radius: 10px;
    color: #e5e7eb;
    font-size: 14px;
}

.ai-field:focus {
    outline: none;
    border-color: #10b981;
}

.ai-send {
    width: 36px;
    height: 36px;
    border: none;
    background: #10b981;
    color: #fff;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.ai-send:hover {
    background: #059669;
}

/* Footer */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 48px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    font-size: 13px;
    color: #9ca3af;
    z-index: 1000;
}

.footer-left {
    display: flex;
    gap: 1.5rem;
}

.footer-link {
    color: #9ca3af;
    text-decoration: none;
    transition: color 0.2s;
}

.footer-link:hover {
    color: #8B5CF6;
}

/* Animations */
@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    animation: slideIn 0.3s ease-out;
}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="navbar-logo">
        <div class="navbar-logo-icon">
            <i data-lucide="layers" style="width:20px;height:20px"></i>
        </div>
        <span>MuseFlow</span>
    </div>
    <div class="navbar-actions">
        <button class="navbar-btn" title="ÏïåÎ¶º">
            <i data-lucide="bell" style="width:18px;height:18px"></i>
        </button>
        <button class="navbar-btn" title="ÎèÑÏõÄÎßê">
            <i data-lucide="help-circle" style="width:18px;height:18px"></i>
        </button>
        <button class="navbar-btn" title="ÏÑ§Ï†ï">
            <i data-lucide="settings" style="width:18px;height:18px"></i>
        </button>
        <button class="navbar-btn" title="Í≥ÑÏ†ï">
            <i data-lucide="user" style="width:18px;height:18px"></i>
        </button>
    </div>
</nav>

<!-- Main Container -->
<div class="container">
    <div class="sidebar left">
        <div class="icon" data-panel="history"><i data-lucide="clock" style="width:16px;height:16px"></i></div>
        <div class="icon" data-panel="actions"><i data-lucide="zap" style="width:16px;height:16px"></i></div>
        <div class="icon" data-panel="projects"><i data-lucide="folder" style="width:16px;height:16px"></i></div>
        <div class="icon" data-panel="settings"><i data-lucide="settings" style="width:16px;height:16px"></i></div>
    </div>
    <div class="canvas">
        <div class="viewport" id="vp"></div>
    </div>
    <div class="sidebar right">
        <div class="icon" data-panel="stats"><i data-lucide="bar-chart-2" style="width:16px;height:16px"></i></div>
        <div class="icon" data-panel="tasks"><i data-lucide="check-square" style="width:16px;height:16px"></i><span class="badge">2</span></div>
        <div class="icon" data-panel="ai"><i data-lucide="sparkles" style="width:16px;height:16px"></i><span class="badge">1</span></div>
        <div class="icon" data-panel="alerts"><i data-lucide="bell" style="width:16px;height:16px"></i><span class="badge">3</span></div>
    </div>
</div>

<!-- Panels -->
<div class="panel left" id="historyPanel" data-side="left">
    <div class="panel-header">
        <span class="panel-title">History</span>
        <button class="panel-close" onclick="closePanel('historyPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÏµúÍ∑º ÏûëÏóÖ Í∏∞Î°ù</div>
</div>

<div class="panel left" id="actionsPanel" data-side="left">
    <div class="panel-header">
        <span class="panel-title">Actions</span>
        <button class="panel-close" onclick="closePanel('actionsPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">Îπ†Î•∏ ÏûëÏóÖ</div>
</div>

<div class="panel left" id="projectsPanel" data-side="left">
    <div class="panel-header">
        <span class="panel-title">Projects</span>
        <button class="panel-close" onclick="closePanel('projectsPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÌîÑÎ°úÏ†ùÌä∏</div>
</div>

<div class="panel left" id="settingsPanel" data-side="left">
    <div class="panel-header">
        <span class="panel-title">Settings</span>
        <button class="panel-close" onclick="closePanel('settingsPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÏÑ§Ï†ï</div>
</div>

<div class="panel right" id="statsPanel" data-side="right">
    <div class="panel-header">
        <span class="panel-title">Stats</span>
        <button class="panel-close" onclick="closePanel('statsPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÌÜµÍ≥Ñ</div>
</div>

<div class="panel right" id="tasksPanel" data-side="right">
    <div class="panel-header">
        <span class="panel-title">Tasks</span>
        <button class="panel-close" onclick="closePanel('tasksPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÏûëÏóÖ Î™©Î°ù</div>
</div>

<div class="panel right" id="aiPanel" data-side="right">
    <div class="panel-header">
        <span class="panel-title">AI Assistant</span>
        <button class="panel-close" onclick="closePanel('aiPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">AI ÏßÑÌñâ ÏÉÅÌô©</div>
</div>

<div class="panel right" id="alertsPanel" data-side="right">
    <div class="panel-header">
        <span class="panel-title">Alerts</span>
        <button class="panel-close" onclick="closePanel('alertsPanel')">
            <i data-lucide="x" style="width:14px;height:14px"></i>
        </button>
    </div>
    <div class="panel-content">ÏïåÎ¶º</div>
</div>

<!-- AI Input -->
<div class="ai-input">
    <select class="ai-select">
        <option>GPT-4o</option>
        <option>Claude 3.5</option>
        <option>Gemini Pro</option>
    </select>
    <button class="ai-voice" id="voiceBtn" title="ÏùåÏÑ± ÏûÖÎ†•">
        <i data-lucide="mic" style="width:16px;height:16px"></i>
    </button>
    <input class="ai-field" id="aiInput" placeholder="AIÏóêÍ≤å ÏßàÎ¨∏ÌïòÍ±∞ÎÇò ÏùåÏÑ± ÏûÖÎ†•...">
    
    <!-- Zoom Controls (moved here) -->
    <div class="controls">
        <button class="ctrl-btn" id="zoomOut">
            <i data-lucide="zoom-out" style="width:14px;height:14px"></i>
        </button>
        <span class="zoom-level" id="zoomLevel">100%</span>
        <button class="ctrl-btn" id="zoomIn">
            <i data-lucide="zoom-in" style="width:14px;height:14px"></i>
        </button>
        <button class="ctrl-btn" id="fitScreen">
            <i data-lucide="maximize-2" style="width:14px;height:14px"></i>
        </button>
    </div>
    
    <button class="ai-send">
        <i data-lucide="send" style="width:16px;height:16px"></i>
    </button>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="footer-left">
        <span>¬© 2025 MuseFlow</span>
        <a href="#" class="footer-link">ÎèÑÏõÄÎßê</a>
        <a href="#" class="footer-link">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>
        <a href="#" class="footer-link">ÏÑúÎπÑÏä§ ÏïΩÍ¥Ä</a>
    </div>
    <div class="footer-right">
        <span>v4.0.0</span>
    </div>
</footer>

<script>
lucide.createIcons();

// ========== WEB SPEECH API - VOICE INPUT ==========
let recognition = null;
let isRecording = false;

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ko-KR';
    recognition.continuous = false;
    recognition.interimResults = true;
    
    recognition.onstart = () => {
        isRecording = true;
        const btn = document.getElementById('voiceBtn');
        btn.style.background = 'linear-gradient(135deg, #EF4444, #DC2626)';
        btn.style.animation = 'pulse 1.5s infinite';
        console.log('üé§ ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë');
    };
    
    recognition.onresult = (event) => {
        let finalTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
                finalTranscript += event.results[i][0].transcript;
            }
        }
        if (finalTranscript) {
            document.getElementById('aiInput').value = finalTranscript;
            console.log('‚úÖ Ïù∏Ïãù ÏôÑÎ£å:', finalTranscript);
        }
    };
    
    recognition.onerror = (event) => {
        console.error('‚ùå ÏùåÏÑ± Ïù∏Ïãù Ïò§Î•ò:', event.error);
        isRecording = false;
        const btn = document.getElementById('voiceBtn');
        btn.style.background = '';
        btn.style.animation = '';
    };
    
    recognition.onend = () => {
        isRecording = false;
        const btn = document.getElementById('voiceBtn');
        btn.style.background = '';
        btn.style.animation = '';
        console.log('üé§ ÏùåÏÑ± Ïù∏Ïãù Ï¢ÖÎ£å');
    };
}

// Voice Button Click
document.getElementById('voiceBtn')?.addEventListener('click', () => {
    if (!recognition) {
        alert('ÏùåÏÑ± Ïù∏ÏãùÏù¥ ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†ÄÏûÖÎãàÎã§.');
        return;
    }
    if (isRecording) {
        recognition.stop();
    } else {
        recognition.start();
    }
});

// Panel Management
const activePanels = { left: null, right: null };
const viewport = document.getElementById('vp');
let scale = 1, translateX = 0, translateY = 0, isDragging = false, startX, startY;

function closePanel(panelId) {
    const panel = document.getElementById(panelId);
    if (!panel) return;
    panel.classList.remove('active');
    activePanels[panel.dataset.side] = null;
    const icon = document.querySelector(`[data-panel="${panelId.replace('Panel', '')}"]`);
    if (icon) icon.classList.remove('active');
}

document.querySelectorAll('.icon').forEach(icon => {
    icon.addEventListener('click', function() {
        const panelName = this.dataset.panel + 'Panel';
        const panel = document.getElementById(panelName);
        if (!panel) return;
        
        const side = panel.dataset.side;
        if (panel.classList.contains('active')) {
            closePanel(panelName);
            this.classList.remove('active');
            return;
        }
        
        if (activePanels[side]) closePanel(activePanels[side]);
        panel.classList.add('active');
        this.classList.add('active');
        activePanels[side] = panelName;
    });
});

// Open initial panels on page load
window.addEventListener('load', function() {
    // Open left panel: Actions
    const leftIcon = document.querySelector('.icon[data-panel="actions"]');
    if (leftIcon) {
        leftIcon.click();
        console.log('‚úÖ ÏôºÏ™Ω ÏÇ¨Ïù¥ÎìúÎ∞î (Actions) ÏûêÎèô Ïó¥Î¶º');
    }
    
    // Open right panel: Stats
    const rightIcon = document.querySelector('.icon[data-panel="stats"]');
    if (rightIcon) {
        rightIcon.click();
        console.log('‚úÖ Ïò§Î•∏Ï™Ω ÏÇ¨Ïù¥ÎìúÎ∞î (Stats) ÏûêÎèô Ïó¥Î¶º');
    }
});

// Canvas Interaction
viewport.addEventListener('mousedown', e => {
    // Don't drag canvas if clicking on a card
    if (e.target.closest('.card')) {
        return;
    }
    
    isDragging = true;
    viewport.classList.add('dragging');
    startX = e.pageX - translateX;
    startY = e.pageY - translateY;
});

document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    e.preventDefault();
    translateX = e.pageX - startX;
    translateY = e.pageY - startY;
    viewport.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
});

document.addEventListener('mouseup', () => {
    if (isDragging) {
        isDragging = false;
        viewport.classList.remove('dragging');
    }
});

// Zoom
viewport.addEventListener('wheel', e => {
    if (!e.ctrlKey) return;
    e.preventDefault();
    scale = Math.max(0.1, Math.min(3, scale * (e.deltaY > 0 ? 0.9 : 1.1)));
    viewport.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    document.getElementById('zoomLevel').textContent = Math.round(scale * 100) + '%';
});

document.getElementById('zoomIn').addEventListener('click', () => {
    scale = Math.min(3, scale * 1.2);
    viewport.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    document.getElementById('zoomLevel').textContent = Math.round(scale * 100) + '%';
});

document.getElementById('zoomOut').addEventListener('click', () => {
    scale = Math.max(0.1, scale * 0.8);
    viewport.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    document.getElementById('zoomLevel').textContent = Math.round(scale * 100) + '%';
});

document.getElementById('fitScreen').addEventListener('click', () => {
    scale = 1;
    translateX = 0;
    translateY = 0;
    viewport.style.transform = 'translate(0, 0) scale(1)';
    document.getElementById('zoomLevel').textContent = '100%';
});

// Keyboard shortcuts
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
        // Close all panels
        Object.values(activePanels).forEach(p => p && closePanel(p));
        document.querySelectorAll('.icon.active').forEach(i => i.classList.remove('active'));
        
        // Deselect card
        if (selectedCard) {
            selectedCard.classList.remove('selected');
            selectedCard = null;
        }
    }
    
    // Delete selected card
    if ((e.key === 'Delete' || e.key === 'Backspace') && selectedCard) {
        const cardTitle = selectedCard.querySelector('.card-header').textContent.trim();
        selectedCard.remove();
        selectedCard = null;
        console.log('üóëÔ∏è Ïπ¥Îìú ÏÇ≠Ï†ú:', cardTitle);
        e.preventDefault();
    }
    
    // Panel shortcuts (1-8)
    const num = parseInt(e.key);
    if (num >= 1 && num <= 8) {
        const icons = Array.from(document.querySelectorAll('.icon'));
        icons[num - 1]?.click();
    }
});

// Sample Cards with Thumbnails
const cards = [
    { title: 'ÌôçÎ≥¥ ÏòÅÏÉÅ', content: 'Ï†ÑÏãú ÏÜåÍ∞ú ÏòÅÏÉÅ (3:45)', icon: 'video', type: 'video', size: '125 MB', format: 'MP4', x: 100, y: 100, preview: 'https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4' },
    { title: 'Ïò§ÎîîÏò§ Í∞ÄÏù¥Îìú', content: 'Ï†ÑÏãú Ìï¥ÏÑ§ ÏùåÏÑ± (Ìïú/ÏòÅ)', icon: 'headphones', type: 'audio', size: '8.5 MB', format: 'MP3', x: 500, y: 100, preview: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3' },
    { title: 'Ï†ÑÏãú Ìè¨Ïä§ÌÑ∞', content: 'Î©îÏù∏ ÎπÑÏ£ºÏñº ÎîîÏûêÏù∏', icon: 'image', type: 'image', size: '4.2 MB', format: 'PNG', x: 900, y: 100, preview: 'https://picsum.photos/400/300?random=1' },
    { title: 'Í¥ÄÎûåÍ∞ù ÌÜµÍ≥Ñ', content: 'ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏', icon: 'bar-chart-2', type: 'data', size: '1.8 MB', format: 'XLSX', x: 100, y: 450 },
    { title: 'ÌÅêÎ†àÏù¥ÌÑ∞ ÎÖ∏Ìä∏', content: 'ÏûëÌíà Ìï¥ÏÑ§ ÏõêÍ≥†', icon: 'file-text', type: 'document', size: '2.4 MB', format: 'DOCX', x: 500, y: 450 },
    { title: '3D ÔøΩÔøΩÎç∏', content: 'Ïú†Î¨º Ïä§Ï∫î Îç∞Ïù¥ÌÑ∞', icon: 'box', type: 'data', size: '89 MB', format: 'GLB', x: 900, y: 450 },
    { title: 'ÌòÑÏû• ÏÇ¨ÏßÑ', content: 'ÏÑ§Ïπò ÏßÑÌñâ ÏÇ¨ÏßÑ (24Ïû•)', icon: 'camera', type: 'image', size: '45 MB', format: 'JPG', x: 100, y: 800, preview: 'https://picsum.photos/400/300?random=2' },
    { title: 'ÌîºÎìúÎ∞±', content: 'Í¥ÄÎûåÍ∞ù ÏùòÍ≤¨ ÏàòÏßë', icon: 'message-circle', type: 'document', size: '512 KB', format: 'PDF', x: 500, y: 800 },
    { title: 'ÏùºÏ†ïÌëú', content: 'Ï†ÑÏãú Ïö¥ÏòÅ Ïä§ÏºÄÏ§Ñ', icon: 'calendar', type: 'document', size: '1.2 MB', format: 'PDF', x: 900, y: 800 }
];

// Global variables for card management
let selectedCard = null;
let maxZIndex = 1;

// Create card function with resize handles
function createCard(card) {
    const cardEl = document.createElement('div');
    cardEl.className = 'card';
    cardEl.style.left = card.x + 'px';
    cardEl.style.top = card.y + 'px';
    cardEl.style.zIndex = maxZIndex++;
    cardEl.dataset.type = card.type;
    
    // Build thumbnail content based on type and preview availability
    let thumbnailContent = '';
    if (card.preview) {
        if (card.type === 'image') {
            thumbnailContent = `<img src="${card.preview}" alt="${card.title}" style="width:100%;height:100%;object-fit:cover;">`;
        } else if (card.type === 'video') {
            thumbnailContent = `<video src="${card.preview}" style="width:100%;height:100%;object-fit:cover;" muted loop autoplay></video>`;
        } else if (card.type === 'audio') {
            thumbnailContent = `
                <i data-lucide="${card.icon}" style="width:60px;height:60px;color:rgba(255,255,255,0.9);stroke-width:1.5;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);"></i>
                <audio src="${card.preview}" controls style="position:absolute;bottom:10px;left:10px;right:10px;width:calc(100% - 20px);"></audio>
            `;
        } else {
            thumbnailContent = `<i data-lucide="${card.icon}" style="width:60px;height:60px;color:rgba(255,255,255,0.9);stroke-width:1.5"></i>`;
        }
    } else {
        thumbnailContent = `<i data-lucide="${card.icon}" style="width:60px;height:60px;color:rgba(255,255,255,0.9);stroke-width:1.5"></i>`;
    }
    
    cardEl.innerHTML = `
        <div class="card-thumbnail ${card.type}">
            ${thumbnailContent}
        </div>
        <div class="card-header">
            <i data-lucide="${card.icon}" style="width:16px;height:16px"></i>
            ${card.title}
        </div>
        <div class="card-content">
            ${card.content}
            <div class="card-meta">
                <span>üì¶ ${card.size}</span>
                <span>üìÑ ${card.format}</span>
            </div>
        </div>
        
        <!-- Resize Handles -->
        <div class="resize-handle resize-nw"></div>
        <div class="resize-handle resize-n"></div>
        <div class="resize-handle resize-ne"></div>
        <div class="resize-handle resize-e"></div>
        <div class="resize-handle resize-se"></div>
        <div class="resize-handle resize-s"></div>
        <div class="resize-handle resize-sw"></div>
        <div class="resize-handle resize-w"></div>
    `;
    
    // Card selection
    cardEl.addEventListener('click', function(e) {
        if (!e.target.classList.contains('resize-handle')) {
            selectCard(cardEl);
            e.stopPropagation();
        }
    });
    
    // Card drag functionality
    let cardDragging = false;
    let cardStartX, cardStartY, cardInitialX, cardInitialY;
    
    const onCardMouseDown = function(e) {
        // Don't drag if clicking on resize handles
        if (e.target.classList.contains('resize-handle')) {
            return;
        }
        
        // Don't drag if clicking on video/audio controls
        if (e.target.tagName === 'VIDEO' || e.target.tagName === 'AUDIO') {
            return;
        }
        
        // Allow drag from anywhere on the card
        cardDragging = true;
        cardStartX = e.clientX;
        cardStartY = e.clientY;
        cardInitialX = parseInt(cardEl.style.left) || 0;
        cardInitialY = parseInt(cardEl.style.top) || 0;
        cardEl.style.cursor = 'grabbing';
        
        // CRITICAL: Prevent canvas from dragging
        e.stopPropagation();
        
        const headerElement = cardEl.querySelector('.card-header');
        console.log('üéØ Ïπ¥Îìú ÎìúÎûòÍ∑∏ ÏãúÏûë:', headerElement ? headerElement.textContent.trim() : 'Unknown');
    };
    
    const onCardMouseMove = function(e) {
        if (cardDragging) {
            e.preventDefault();
            e.stopPropagation();
            
            const deltaX = (e.clientX - cardStartX) / scale;
            const deltaY = (e.clientY - cardStartY) / scale;
            cardEl.style.left = (cardInitialX + deltaX) + 'px';
            cardEl.style.top = (cardInitialY + deltaY) + 'px';
        }
    };
    
    const onCardMouseUp = function() {
        if (cardDragging) {
            cardDragging = false;
            cardEl.style.cursor = 'move';
            console.log('‚úÖ Ïπ¥Îìú ÎìúÎûòÍ∑∏ ÏôÑÎ£å');
        }
    };
    
    cardEl.addEventListener('mousedown', onCardMouseDown);
    document.addEventListener('mousemove', onCardMouseMove);
    document.addEventListener('mouseup', onCardMouseUp);
    
    // Resize functionality
    setupResizeHandles(cardEl);
    
    viewport.appendChild(cardEl);
    return cardEl;
}

// Card selection management
function selectCard(cardEl) {
    // Deselect previous card
    if (selectedCard) {
        selectedCard.classList.remove('selected');
    }
    
    // Select new card and bring to front
    selectedCard = cardEl;
    cardEl.classList.add('selected');
    cardEl.style.zIndex = maxZIndex++;
    
    console.log('‚úÖ Ïπ¥Îìú ÏÑ†ÌÉù:', cardEl.querySelector('.card-header').textContent.trim());
}

// Deselect when clicking canvas
viewport.addEventListener('click', function(e) {
    if (e.target === viewport && selectedCard) {
        selectedCard.classList.remove('selected');
        selectedCard = null;
    }
});

// Resize handles setup
function setupResizeHandles(cardEl) {
    const handles = cardEl.querySelectorAll('.resize-handle');
    
    handles.forEach(handle => {
        handle.addEventListener('mousedown', function(e) {
            e.stopPropagation();
            const direction = Array.from(handle.classList).find(c => c.startsWith('resize-')).replace('resize-', '');
            
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = cardEl.offsetWidth;
            const startHeight = cardEl.offsetHeight;
            const startLeft = parseInt(cardEl.style.left) || 0;
            const startTop = parseInt(cardEl.style.top) || 0;
            
            function onMouseMove(e) {
                const deltaX = (e.clientX - startX) / scale;
                const deltaY = (e.clientY - startY) / scale;
                
                if (direction.includes('e')) {
                    cardEl.style.width = Math.max(200, startWidth + deltaX) + 'px';
                }
                if (direction.includes('w')) {
                    const newWidth = Math.max(200, startWidth - deltaX);
                    cardEl.style.width = newWidth + 'px';
                    cardEl.style.left = (startLeft + (startWidth - newWidth)) + 'px';
                }
                if (direction.includes('s')) {
                    cardEl.style.height = Math.max(200, startHeight + deltaY) + 'px';
                }
                if (direction.includes('n')) {
                    const newHeight = Math.max(200, startHeight - deltaY);
                    cardEl.style.height = newHeight + 'px';
                    cardEl.style.top = (startTop + (startHeight - newHeight)) + 'px';
                }
            }
            
            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                console.log('‚úÖ Ïπ¥Îìú ÌÅ¨Í∏∞ Ï°∞Ï†à ÏôÑÎ£å:', cardEl.offsetWidth + 'x' + cardEl.offsetHeight);
            }
            
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });
    });
}

// Create all initial cards
cards.forEach(card => createCard(card));

// Global function to add AI-generated content cards
window.addAICard = function(type, title, content, imageUrl = null) {
    const newCard = {
        title: title,
        content: content,
        icon: type === 'image' ? 'image' : type === 'video' ? 'video' : type === 'audio' ? 'headphones' : 'file',
        type: type,
        size: 'AI Generated',
        format: type.toUpperCase(),
        x: Math.random() * 500 + 100,
        y: Math.random() * 400 + 100
    };
    
    const cardEl = createCard(newCard);
    
    // If image/video URL provided, replace thumbnail
    if (imageUrl && (type === 'image' || type === 'video')) {
        const thumbnail = cardEl.querySelector('.card-thumbnail');
        thumbnail.innerHTML = type === 'image' 
            ? `<img src="${imageUrl}" alt="${title}">`
            : `<video src="${imageUrl}" controls></video>`;
    }
    
    lucide.createIcons();
    selectCard(cardEl);
    
    console.log('‚úÖ AI ÏÉùÏÑ± Ïπ¥Îìú Ï∂îÍ∞Ä:', title, '(' + type + ')');
    return cardEl;
};

lucide.createIcons();
</script>
</body>
</html>
