<!DOCTYPE html>
<html lang="ko" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="4.9.1">
    <title>Dashboard - MuseFlow</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.10/index.global.min.js"></script>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script src="/static/js/tracker.js?v=4.0.0"></script>
    
    <!-- GSAP for Smooth Animations -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    
    <!-- 2025 Minimalism Design System -->
    <link rel="stylesheet" href="/static/css/unified-navbar.css">
    <link rel="stylesheet" href="/static/css/dashboard-minimalism.css">
    
    <style>
        /* ======================================
           üé® 2025 Minimalism Design System
           ====================================== */
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root {
            /* Brand Colors (Minimal usage) */
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            
            /* Semantic Colors */
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --info: #3B82F6;
            
            /* Neutrals (High Contrast) */
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Backgrounds */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #F3F4F6;
            
            /* Text */
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            
            /* Borders */
            --border-color: #E5E7EB;
            --border-hover: #D1D5DB;
            
            /* Shadows (Subtle) */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.08);
            
            /* Spacing (8px Grid) */
            --space-1: 0.5rem;
            --space-2: 1rem;
            --space-3: 1.5rem;
            --space-4: 2rem;
            --space-6: 3rem;
            --space-8: 4rem;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
        }
        
        /* ======================================
           Navigation (Clean White)
           ====================================== */
        
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }
        
        .navbar.scrolled {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-2) var(--space-4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-logo {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            text-decoration: none;
        }
        
        .nav-logo img {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
        }
        
        .nav-logo-text {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        
        .nav-links {
            display: flex;
            gap: var(--space-4);
            list-style: none;
            align-items: center;
        }
        
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9375rem;
            transition: color 0.2s ease;
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a.active {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }
        
        .nav-icon-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-2) var(--space-3);
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9375rem;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nav-icon-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* White Theme Card */
        .glass-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top right, rgba(139, 92, 246, 0.03), transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .glass-card:hover::before {
            opacity: 1;
        }
        
        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(139, 92, 246, 0.2);
        }
        
        /* Hero Section - Today's Mission */
        .hero-mission {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05));
            border: 2px solid rgba(139, 92, 246, 0.15);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-mission::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            line-height: 1.1;
        }
        
        .dday-counter {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.08));
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: #dc2626;
            animation: pulse-dday 2s ease-in-out infinite;
        }
        
        @keyframes pulse-dday {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 rgba(239, 68, 68, 0.2); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); }
        }
        
        /* Urgent Alerts */
        .alert-card {
            background: #ffffff;
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }
        
        .alert-card:hover {
            transform: translateX(4px);
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: var(--shadow-md);
        }
        
        .alert-icon {
            width: 48px;
            height: 48px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #ef4444;
        }
        
        /* Timeline */
        .timeline-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, 0.3) var(--bg-tertiary);
        }
        
        .timeline-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .timeline-container::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        .timeline-container::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 4px;
        }
        
        .timeline-container::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }
        
        .timeline-day {
            flex: 0 0 auto;
            width: 200px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .timeline-day:hover {
            transform: translateY(-4px);
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .timeline-day.today {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));
            border: 2px solid rgba(139, 92, 246, 0.5);
        }
        
        .day-header {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }
        
        .day-date {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        
        .day-event {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* Exhibition Cards */
        .exhibition-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .exhibition-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.4);
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .card-thumbnail {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(236, 72, 153, 0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .card-thumbnail::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 50%, rgba(139, 92, 246, 0.4), transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .card-icon {
            font-size: 4rem;
            opacity: 0.4;
            position: relative;
            z-index: 1;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        .card-type {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-size: 0.875rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }
        
        .type-permanent {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
        }
        
        .type-special {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .type-traveling {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .type-event {
            background: linear-gradient(135deg, #ec4899, #db2777);
            color: white;
        }
        
        .progress-ring {
            width: 80px;
            height: 80px;
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.6s ease;
        }
        
        /* Quick Actions */
        .quick-action {
            background: linear-gradient(135deg, var(--museum-purple), var(--museum-pink));
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-sm);
        }
        
        .quick-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
        }
        
        /* Team Activity */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .activity-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-medium);
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--museum-purple), var(--museum-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }
        
        /* Museum Module Cards */
        .module-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2.5rem;
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.08));
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        .module-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 24px 70px rgba(139, 92, 246, 0.4);
        }
        
        .module-card:hover::before {
            opacity: 1;
        }
        
        .module-card:active {
            transform: translateY(-6px) scale(1.01);
        }
        
        .module-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .module-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .module-title {
            font-size: 1.375rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .module-description {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .module-stats {
            display: flex;
            gap: 1.5rem;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
        }
        
        .module-arrow {
            position: relative;
            z-index: 1;
            color: rgba(255, 255, 255, 0.3);
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .module-card:hover .module-arrow {
            color: white;
            transform: translateX(4px);
        }
        
        /* Section Background Colors with Glow Effect */
        section[class^="section-"] {
            padding: 2rem;
            border-radius: 24px;
            margin-bottom: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        section[class^="section-"]:hover {
            transform: translateY(-2px);
        }
        
        /* 1. Hero Section - Purple Glow */
        .section-hero {
            background: 
                radial-gradient(circle at top center, rgba(139, 92, 246, 0.15), transparent 70%),
                rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            backdrop-filter: blur(20px);
        }
        
        .section-hero:hover {
            border-color: rgba(139, 92, 246, 0.3);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.2);
        }
        
        /* 2. Quick Start - Glass */
        .section-quickstart {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .section-quickstart:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.08);
        }
        
        /* 3. Stats - Glass */
        .section-stats {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .section-stats:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.08);
        }
        
        /* 4. Calendar - Indigo Glow */
        .section-calendar {
            background: 
                radial-gradient(circle at center, rgba(99, 102, 241, 0.1), transparent 70%),
                rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .section-calendar:hover {
            border-color: rgba(99, 102, 241, 0.25);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.15);
        }
        
        /* 5. Projects Management - Cyan Glow */
        .section-projects {
            background: 
                radial-gradient(circle at bottom center, rgba(6, 182, 212, 0.1), transparent 70%),
                rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(6, 182, 212, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .section-projects:hover {
            border-color: rgba(6, 182, 212, 0.25);
            box-shadow: 0 8px 32px rgba(6, 182, 212, 0.15);
        }
        
        /* 6. Team & Collaboration - Pink Glow */
        .section-team {
            background: 
                radial-gradient(circle at top center, rgba(236, 72, 153, 0.1), transparent 70%),
                rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(236, 72, 153, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .section-team:hover {
            border-color: rgba(236, 72, 153, 0.25);
            box-shadow: 0 8px 32px rgba(236, 72, 153, 0.15);
        }
        
        /* 7. Analytics - Gold Glow */
        .section-analytics {
            background: 
                radial-gradient(circle at center, rgba(245, 158, 11, 0.08), transparent 70%),
                rgba(10, 10, 15, 0.6);
            border: 1px solid rgba(245, 158, 11, 0.15);
            backdrop-filter: blur(20px);
        }
        
        .section-analytics:hover {
            border-color: rgba(245, 158, 11, 0.25);
            box-shadow: 0 8px 32px rgba(245, 158, 11, 0.12);
        }
        
        /* Genspark AI Search Styles (NEW) */
        .genspark-suggestion-btn {
            padding: 0.5rem 1rem;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .genspark-suggestion-btn:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.5);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        /* Quick Access Icons */
        .genspark-icon-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .genspark-icon-card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .genspark-icon-wrapper {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .genspark-icon-card:hover .genspark-icon-wrapper {
            transform: scale(1.1) rotate(5deg);
        }
        
        .genspark-icon-card span {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero-title { font-size: 1.75rem; }
            .hero-mission { padding: 2rem; }
            .timeline-day { width: 150px; }
            
            .module-card {
                padding: 1.5rem;
            }
            
            .module-icon {
                width: 56px;
                height: 56px;
                font-size: 1rem;
            }
            
            .genspark-icon-wrapper {
                width: 48px !important;
                height: 48px !important;
                font-size: 1.25rem !important;
            }
            
            .panel-title {
                font-size: 1.125rem !important;
            }
            
            section[class^="section-"] {
                padding: 2rem 0;
                margin-bottom: 0.75rem;
            }
            
            #genspark-search-section {
                padding: 1.5rem !important;
                position: sticky;
                top: 70px;
                z-index: 900;
                background: rgba(0, 0, 0, 0.95);
                backdrop-filter: blur(20px);
            }
            
            .genspark-suggestion-btn {
                font-size: 0.75rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        /* ========================================
           WHITE THEME TEXT OVERRIDES
           ======================================== */
        
        /* General text colors */
        h1, h2, h3, h4, h5, h6, p, span, div {
            color: inherit;
        }
        
        .main-container h2,
        .main-container h3 {
            color: var(--text-primary);
        }
        
        .day-header {
            color: var(--text-secondary) !important;
        }
        
        .day-date {
            color: var(--text-primary);
        }
        
        .day-event {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .exhibition-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }
        
        .exhibition-card:hover {
            background: var(--bg-secondary);
            border-color: var(--border-medium);
        }
        
        .timeline-day.today {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(236, 72, 153, 0.08));
            border: 2px solid rgba(139, 92, 246, 0.2);
        }
        
        .genspark-suggestion-btn {
            background: rgba(139, 92, 246, 0.08);
            border: 1px solid rgba(139, 92, 246, 0.2);
            color: var(--text-primary);
        }
        
        .genspark-suggestion-btn:hover {
            background: rgba(139, 92, 246, 0.12);
            border-color: rgba(139, 92, 246, 0.3);
            color: var(--museum-purple);
        }
        
        .genspark-icon-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }
        
        .genspark-icon-card:hover {
            background: var(--bg-secondary);
            border-color: rgba(139, 92, 246, 0.2);
        }
        
        /* Section backgrounds - subtle colored accents */
        .section-overview {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.03), transparent);
            border: 1px solid var(--border-light);
        }
        
        .section-urgent {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.03), transparent);
            border: 1px solid rgba(239, 68, 68, 0.1);
        }
        
        .section-timeline {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
        }
        
        .section-exhibitions {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.03), transparent);
            border: 1px solid var(--border-light);
        }
        
        .section-projects {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.03), transparent);
            border: 1px solid var(--border-light);
        }
        
        .section-team {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.03), transparent);
            border: 1px solid var(--border-light);
        }
        
        .section-analytics {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.03), transparent);
            border: 1px solid var(--border-light);
        }
        
        /* Avatar and user elements */
        .avatar {
            border: 2px solid var(--border-light);
        }
        
        /* Keep button text white */
        .quick-action,
        button {
            /* Button text stays white on colored backgrounds */
        }
        
        /* ========================================
           STRONG TEXT COLOR OVERRIDES FOR WHITE THEME
           ======================================== */
        
        /* Main container - all text should be dark */
        .main-container,
        .main-container * {
            color: var(--text-primary);
        }
        
        /* Secondary text */
        .main-container .text-secondary,
        .main-container small,
        .main-container .subtitle {
            color: var(--text-secondary) !important;
        }
        
        /* Stats and numbers - should be very visible */
        .stats-number,
        .big-number,
        h1, h2, h3, h4 {
            color: var(--text-primary) !important;
        }
        
        /* Card labels and descriptions */
        .glass-card small,
        .glass-card .label,
        .glass-card .description {
            color: var(--text-secondary) !important;
        }
        
        /* Override any white text in main content */
        .main-container [style*="color: rgba(255"] {
            color: var(--text-primary) !important;
        }
        
        /* Icon colors stay as-is (they have specific brand colors) */
        .main-container i[style*="color:"] {
            /* Keep icon colors */
        }
        
        /* Timeline and calendar specific */
        .timeline-day *,
        .day-header,
        .day-date,
        .day-event * {
            color: var(--text-primary) !important;
        }
        
        /* Activity items */
        .activity-item *,
        .activity-name,
        .activity-time {
            color: var(--text-primary) !important;
        }
        
        /* Exhibition cards */
        .exhibition-card *,
        .exhibition-title,
        .exhibition-date {
            color: var(--text-primary) !important;
        }
        
        /* Alert cards */
        .alert-card *,
        .alert-title,
        .alert-description {
            color: var(--text-primary) !important;
        }
        
        /* Empty states */
        .empty-state,
        .no-data {
            color: var(--text-secondary) !important;
        }
        
        /* Navbar stays white (dark background) */
        .navbar,
        .navbar *,
        .nav-links a,
        .nav-icon-btn {
            /* Navbar colors preserved */
        }
        
        /* ========================================
           ENHANCED READABILITY
           ======================================== */
        
        /* Section headers - more prominent */
        .main-container h2 {
            font-size: 1.5rem !important;
            font-weight: 700 !important;
            color: var(--text-primary) !important;
            margin-bottom: 1.5rem !important;
        }
        
        .main-container h3 {
            font-size: 1.25rem !important;
            font-weight: 600 !important;
            color: var(--text-primary) !important;
        }
        
        /* Stats numbers - very prominent */
        .glass-card .big-number,
        .stats-number {
            font-size: 2.5rem !important;
            font-weight: 700 !important;
            color: var(--text-primary) !important;
            line-height: 1.2 !important;
        }
        
        /* Labels under stats - clear secondary */
        .glass-card small,
        .glass-card [style*="font-size: 0.8rem"],
        .glass-card [style*="font-size: 0.875rem"] {
            font-weight: 500 !important;
        }
        
        /* Improve card contrast */
        .glass-card {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 
                        0 0 0 1px rgba(0, 0, 0, 0.05) !important;
        }
        
        .glass-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12), 
                        0 0 0 1px rgba(139, 92, 246, 0.2) !important;
        }
        
        /* Timeline improvements */
        .timeline-day {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08) !important;
        }
        
        .timeline-day:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12) !important;
        }
        
        /* Activity items more readable */
        .activity-item {
            border: 1px solid var(--border-light) !important;
        }
        
        .activity-item:hover {
            background: var(--bg-secondary) !important;
            border-color: var(--border-medium) !important;
        }
    </style>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MuseFlow">
    <link rel="apple-touch-icon" href="/static/images/logo-neon-m.png">
</head>
<body>
    <!-- Navigation - Landing Page Style -->
    <!-- Load Unified Navigation -->
    <div id="unified-navbar-container"></div>
    <script>
        fetch('/static/components/unified-navbar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('unified-navbar-container').innerHTML = html;
            });
    </script>

    <!-- Main Content -->
    <div style="max-width: 1600px; margin: 0 auto; padding: 5rem 1.5rem 2rem 1.5rem;">
        
        <!-- Genspark AI Search Section (NEW) -->
        <section id="genspark-search-section" style="margin-bottom: 2rem;">
            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.05)); border: 1px solid rgba(139, 92, 246, 0.2); border-radius: 24px; padding: 2rem; position: relative; overflow: hidden;">
                <!-- Background Decoration -->
                <div style="position: absolute; top: -100px; right: -100px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent); border-radius: 50%;"></div>
                
                <!-- AI Search Bar -->
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #ec4899); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                            ü§ñ
                        </div>
                        <div>
                            <h3 style="font-size: 1.25rem; font-weight: 700; color: white; margin: 0;">AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏</h3>
                            <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin: 0;">Î¨¥ÏóáÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?</p>
                        </div>
                    </div>
                    
                    <div style="position: relative;">
                        <input 
                            id="genspark-ai-search" 
                            type="text" 
                            placeholder="Ïòà: Ï†ÑÏãú ÎùºÎ≤® ÏÉùÏÑ±, Ïù¥Î≤à Ï£º Ïö∞ÏÑ†ÏàúÏúÑ ÏûëÏóÖ, SNS ÏΩòÌÖêÏ∏† ÏûëÏÑ±..." 
                            style="width: 100%; padding: 1.25rem 3.5rem 1.25rem 1.5rem; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 16px; color: white; font-size: 1rem; outline: none; transition: all 0.3s ease;"
                            onfocus="this.style.borderColor='rgba(139, 92, 246, 0.5)'; this.style.background='rgba(255, 255, 255, 0.08)'"
                            onblur="this.style.borderColor='rgba(255, 255, 255, 0.1)'; this.style.background='rgba(255, 255, 255, 0.05)'"
                            onkeypress="if(event.key === 'Enter') handleGensparkSearch()"
                        >
                        <button 
                            onclick="handleGensparkSearch()"
                            style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #ec4899); border: none; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; transition: all 0.3s ease;"
                            onmouseover="this.style.transform='translateY(-50%) scale(1.05)'; this.style.boxShadow='0 8px 20px rgba(139, 92, 246, 0.4)'"
                            onmouseout="this.style.transform='translateY(-50%) scale(1)'; this.style.boxShadow='none'"
                        >
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <!-- Quick Suggestions -->
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                        <button class="genspark-suggestion-btn" onclick="setGensparkQuery('Ï†ÑÏãú ÎùºÎ≤® ÏÉùÏÑ±')">
                            <i class="fas fa-tag"></i> Ï†ÑÏãú ÎùºÎ≤®
                        </button>
                        <button class="genspark-suggestion-btn" onclick="setGensparkQuery('Ïö∞ÏÑ†ÏàúÏúÑ ÏûëÏóÖ')">
                            <i class="fas fa-sort-amount-up"></i> Ïö∞ÏÑ†ÏàúÏúÑ
                        </button>
                        <button class="genspark-suggestion-btn" onclick="setGensparkQuery('SNS ÏΩòÌÖêÏ∏†')">
                            <i class="fas fa-share-alt"></i> SNS
                        </button>
                        <button class="genspark-suggestion-btn" onclick="setGensparkQuery('Ïù¥Î©îÏùº Ï¥àÏïà')">
                            <i class="fas fa-envelope"></i> Ïù¥Î©îÏùº
                        </button>
                        <button class="genspark-suggestion-btn" onclick="setGensparkQuery('ÏùºÏùº Î¶¨Ìè¨Ìä∏')">
                            <i class="fas fa-file-alt"></i> Î¶¨Ìè¨Ìä∏
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Quick Access Icons Grid (NEW) -->
        <section id="genspark-quick-access" style="margin-bottom: 2rem;">
            <h3 style="font-size: 1rem; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-rocket" style="color: var(--museum-purple);"></i>
                Îπ†Î•∏ Ïã§Ìñâ
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                <!-- Dashboard -->
                <div class="genspark-icon-card" onclick="window.location.href='/dashboard.html'">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));">
                        <i class="fas fa-chart-line" style="color: #8b5cf6;"></i>
                    </div>
                    <span>ÎåÄÏãúÎ≥¥Îìú</span>
                </div>
                
                <!-- Canvas -->
                <div class="genspark-icon-card" onclick="window.location.href='/canvas-v3.html'">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(236, 72, 153, 0.1));">
                        <i class="fas fa-project-diagram" style="color: #ec4899;"></i>
                    </div>
                    <span>ÏõåÌÅ¨ÌîåÎ°úÏö∞</span>
                </div>
                
                <!-- Label Generation -->
                <div class="genspark-icon-card" onclick="handleLabelGeneration('Ï†ÑÏãú ÎùºÎ≤® ÏÉùÏÑ±')">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));">
                        <i class="fas fa-tag" style="color: #f59e0b;"></i>
                    </div>
                    <span>ÎùºÎ≤® ÏÉùÏÑ±</span>
                </div>
                
                <!-- SNS Content -->
                <div class="genspark-icon-card" onclick="handleSNSGeneration('SNS ÏΩòÌÖêÏ∏† ÏÉùÏÑ±')">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));">
                        <i class="fas fa-share-alt" style="color: #3b82f6;"></i>
                    </div>
                    <span>SNS</span>
                </div>
                
                <!-- Email -->
                <div class="genspark-icon-card" onclick="handleEmailGeneration('Ïù¥Î©îÏùº Ï¥àÏïà ÏûëÏÑ±')">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));">
                        <i class="fas fa-envelope" style="color: #10b981;"></i>
                    </div>
                    <span>Ïù¥Î©îÏùº</span>
                </div>
                
                <!-- Google MCP -->
                <div class="genspark-icon-card" onclick="openGoogleMCP()">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));">
                        <i class="fab fa-google" style="color: #ef4444;"></i>
                    </div>
                    <span>Google AI</span>
                </div>
                
                <!-- Budget -->
                <div class="genspark-icon-card" onclick="window.location.href='/budget.html'">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.1));">
                        <i class="fas fa-dollar-sign" style="color: #a855f7;"></i>
                    </div>
                    <span>ÏòàÏÇ∞</span>
                </div>
                
                <!-- Analytics -->
                <div class="genspark-icon-card" onclick="window.location.href='/analytics-dashboard.html'">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));">
                        <i class="fas fa-chart-bar" style="color: #eab308;"></i>
                    </div>
                    <span>Î∂ÑÏÑù</span>
                </div>
                
                <!-- Tools -->
                <div class="genspark-icon-card" onclick="window.location.href='/workflow-tools.html'">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.1));">
                        <i class="fas fa-tools" style="color: #6366f1;"></i>
                    </div>
                    <span>ÎèÑÍµ¨</span>
                </div>
                
                <!-- Settings -->
                <div class="genspark-icon-card" onclick="openDashboardSettings()">
                    <div class="genspark-icon-wrapper" style="background: linear-gradient(135deg, rgba(107, 114, 128, 0.2), rgba(107, 114, 128, 0.1));">
                        <i class="fas fa-cog" style="color: #6b7280;"></i>
                    </div>
                    <span>ÏÑ§Ï†ï</span>
                </div>
            </div>
        </section>
        
        <!-- Hero Section - Ïò§ÎäòÏùò ÌïµÏã¨ ÏóÖÎ¨¥ (ÌÜµÌï©) -->
        <section class="hero-mission section-hero" id="hero-mission">
            <div class="hero-content">
                <div class="hero-title">üéØ Ïò§ÎäòÏùò ÌïµÏã¨ ÏóÖÎ¨¥</div>
                <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 2rem;">
                    <!-- Left: Mission -->
                    <div style="flex: 1; min-width: 300px;">
                        <h2 id="mission-title" style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.75rem; color: white;">
                            Î°úÎî© Ï§ë...
                        </h2>
                        <div id="mission-dday"></div>
                        
                        <!-- Urgent Alerts (ÌÜµÌï©) -->
                        <div id="urgent-alerts-inline" style="margin-top: 1.5rem;">
                            <!-- Top 3 urgent alerts will be inserted here -->
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                            <button class="quick-action" onclick="viewMission()">
                                <i class="fas fa-eye"></i> ÏÉÅÏÑ∏ Î≥¥Í∏∞
                            </button>
                            <button class="quick-action" onclick="openChecklist()">
                                <i class="fas fa-tasks"></i> Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏
                            </button>
                            <button class="quick-action" onclick="contactTeam()">
                                <i class="fas fa-comments"></i> ÌåÄ Ï±ÑÌåÖ
                            </button>
                        </div>
                    </div>
                    
                    <!-- Right: Progress Ring -->
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div id="mission-progress" style="position: relative;">
                            <!-- Progress ring will be inserted here -->
                        </div>
                        <div>
                            <div id="mission-stats" style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.8);">
                                <!-- Stats will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Quick Start Section -->
        <section class="section-quickstart">
            <div class="glass-card" style="padding: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <h3 style="font-size: 1rem; font-weight: 600; color: white; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-rocket" style="color: var(--museum-purple);"></i>
                        Îπ†Î•∏ ÏãúÏûë
                    </h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button onclick="openNewProjectModal()" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #8b5cf6, #ec4899); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(139, 92, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-plus"></i> ÏÉà ÌîÑÎ°úÏ†ùÌä∏
                        </button>
                        <a href="/workflow-tools.html?tool=templates" style="padding: 0.75rem 1.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; text-decoration: none;" onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <i class="fas fa-layer-group"></i> ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù
                        </a>
                        <button onclick="openNotificationCenter()" style="position: relative; padding: 0.75rem 1.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <i class="fas fa-bell"></i> ÏïåÎ¶º
                            <span id="notification-badge" style="display: none; position: absolute; top: 0.25rem; right: 0.25rem; background: #ef4444; color: white; font-size: 0.7rem; padding: 0.15rem 0.4rem; border-radius: 10px; font-weight: 700;"></span>
                        </button>
                        <button onclick="openDashboardSettings()" style="padding: 0.75rem 1.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <i class="fas fa-sliders-h"></i> ÎåÄÏãúÎ≥¥Îìú ÏÑ§Ï†ï
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Overview Statistics Cards -->
        <section class="section-stats">
            <h2 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-chart-pie" style="color: var(--museum-purple);"></i>
                ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©
            </h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
                <!-- Total Projects -->
                <div class="glass-card" style="text-align: center; position: relative; overflow: hidden; padding: 1rem;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at center, rgba(139, 92, 246, 0.1), transparent); pointer-events: none;"></div>
                    <div style="position: relative; z-index: 1;">
                        <div style="font-size: 1.4rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-project-diagram" style="color: var(--museum-purple);"></i>
                        </div>
                        <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;" id="stat-total">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.8rem;">Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏</div>
                    </div>
                </div>
                
                <!-- In Progress - PRIMARY HIGHLIGHT -->
                <div class="glass-card" style="text-align: center; position: relative; overflow: hidden; padding: 1rem; border: 2px solid rgba(139, 92, 246, 0.5); box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);">
                    <div style="position: absolute; top: -20px; right: -20px; background: linear-gradient(135deg, #8b5cf6, #ec4899); width: 60px; height: 60px; border-radius: 50%; opacity: 0.1;"></div>
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at center, rgba(139, 92, 246, 0.2), transparent); pointer-events: none;"></div>
                    <div style="position: relative; z-index: 1;">
                        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-spinner fa-pulse" style="color: var(--museum-purple);"></i>
                        </div>
                        <div style="font-size: 2rem; font-weight: 800; margin-bottom: 0.25rem; color: var(--museum-purple);" id="stat-inprogress">0</div>
                        <div style="color: var(--text-primary); font-size: 0.875rem; font-weight: 600;">ÏßÑÌñâÏ§ë üî•</div>
                    </div>
                </div>
                
                <!-- Completed -->
                <div class="glass-card" style="text-align: center; position: relative; overflow: hidden; padding: 1rem;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at center, rgba(16, 185, 129, 0.1), transparent); pointer-events: none;"></div>
                    <div style="position: relative; z-index: 1;">
                        <div style="font-size: 1.4rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-check-circle" style="color: var(--green);"></i>
                        </div>
                        <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;" id="stat-completed">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.8rem;">ÏôÑÎ£å</div>
                    </div>
                </div>
                
                <!-- Due This Month -->
                <div class="glass-card" style="text-align: center; position: relative; overflow: hidden; padding: 1rem;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at center, rgba(245, 158, 11, 0.1), transparent); pointer-events: none;"></div>
                    <div style="position: relative; z-index: 1;">
                        <div style="font-size: 1.4rem; margin-bottom: 0.5rem;">
                            <i class="fas fa-calendar-day" style="color: var(--museum-gold);"></i>
                        </div>
                        <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;" id="stat-duethismonth">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.8rem;">Ïù¥Î≤à Îã¨ ÎßàÍ∞ê</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Project Calendar (FullCalendar) -->
        <section class="section-calendar">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 1rem;">
                <h2 style="font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-calendar-alt" style="color: var(--museum-purple);"></i>
                    ÌîÑÎ°úÏ†ùÌä∏ Ï∫òÎ¶∞Îçî
                </h2>
                <button onclick="syncGoogleCalendar()" style="padding: 0.75rem 1.5rem; background: rgba(66, 133, 244, 0.2); border: 1px solid rgba(66, 133, 244, 0.3); border-radius: 12px; color: #4285f4; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(66, 133, 244, 0.3)'" onmouseout="this.style.background='rgba(66, 133, 244, 0.2)'">
                    <i class="fab fa-google"></i> Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî Ïó∞Îèô
                </button>
            </div>
            <div class="glass-card" style="padding: 1rem;">
                <div id="calendar"></div>
            </div>
        </section>

        <!-- Advanced Analytics -->
        <section class="section-analytics" style="background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border-radius: 24px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h2 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-chart-line" style="color: #10b981;"></i>
                ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÏÑù
            </h2>
            
            <!-- KPI Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div style="background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <i class="fas fa-check-circle" style="font-size: 1.4rem; color: rgba(255, 255, 255, 0.9);"></i>
                        <span id="completion-rate" style="font-size: 1.4rem; font-weight: 700; color: white;">0%</span>
                    </div>
                    <div style="color: var(--text-primary); font-weight: 600;">ÏôÑÎ£åÏú®</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ ÎåÄÎπÑ</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #10b981, #059669); border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <i class="fas fa-hourglass-half" style="font-size: 1.4rem; color: rgba(255, 255, 255, 0.9);"></i>
                        <span id="avg-duration" style="font-size: 1.4rem; font-weight: 700; color: white;">0Ïùº</span>
                    </div>
                    <div style="color: var(--text-primary); font-weight: 600;">ÌèâÍ∑† Í∏∞Í∞Ñ</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">ÌîÑÎ°úÏ†ùÌä∏Îãπ</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <i class="fas fa-fire" style="font-size: 1.4rem; color: rgba(255, 255, 255, 0.9);"></i>
                        <span id="active-projects" style="font-size: 1.4rem; font-weight: 700; color: white;">0</span>
                    </div>
                    <div style="color: var(--text-primary); font-weight: 600;">ÏßÑÌñâ Ï§ë</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">ÌòÑÏû¨ ÌôúÏÑ± ÌîÑÎ°úÏ†ùÌä∏</div>
                </div>
                
                <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <i class="fas fa-calendar-check" style="font-size: 1.4rem; color: rgba(255, 255, 255, 0.9);"></i>
                        <span id="this-month-count" style="font-size: 1.4rem; font-weight: 700; color: white;">0</span>
                    </div>
                    <div style="color: var(--text-primary); font-weight: 600;">Ïù¥Î≤à Îã¨</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.25rem;">Ïã†Í∑ú ÌîÑÎ°úÏ†ùÌä∏</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem;">
                <!-- Monthly Trend Chart -->
                <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 1.5rem;">
                    <h3 style="font-size: 0.95rem; font-weight: 600; color: white; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-line" style="color: #3b82f6;"></i>
                        ÏõîÎ≥Ñ ÌîÑÎ°úÏ†ùÌä∏ Ìä∏Î†åÎìú
                    </h3>
                    <canvas id="monthly-trend-chart" style="max-height: 300px;"></canvas>
                </div>

                <!-- Type Distribution Chart -->
                <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 1.5rem;">
                    <h3 style="font-size: 0.95rem; font-weight: 600; color: white; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-pie" style="color: #10b981;"></i>
                        Ïú†ÌòïÎ≥Ñ Î∂ÑÌè¨
                    </h3>
                    <canvas id="type-distribution-chart" style="max-height: 300px;"></canvas>
                </div>

                <!-- Phase Progress Chart -->
                <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 1.5rem;">
                    <h3 style="font-size: 0.95rem; font-weight: 600; color: white; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-bar" style="color: #f59e0b;"></i>
                        Îã®Í≥ÑÎ≥Ñ ÏßÑÌñâ ÌòÑÌô©
                    </h3>
                    <canvas id="phase-progress-chart" style="max-height: 300px;"></canvas>
                </div>

                <!-- Timeline Status Chart -->
                <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 1.5rem;">
                    <h3 style="font-size: 0.95rem; font-weight: 600; color: white; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-tasks" style="color: #8b5cf6;"></i>
                        ÏùºÏ†ï ÏÉÅÌÉú
                    </h3>
                    <canvas id="timeline-status-chart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </section>

        <!-- Projects Management (ÌÜµÌï©: Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏ + Ï†ÑÏãú Ïù∏ÏÇ¨Ïù¥Ìä∏ + CRUD) -->
        <section class="section-projects">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 1rem;">
                <h2 style="font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-folder-open" style="color: #06b6d4;"></i>
                    ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨
                </h2>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <!-- Search Bar -->
                    <div style="position: relative; flex: 1; min-width: 250px; max-width: 400px;">
                        <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: rgba(255, 255, 255, 0.5); pointer-events: none;"></i>
                        <input id="project-search" type="text" placeholder="ÌîÑÎ°úÏ†ùÌä∏ Í≤ÄÏÉâ... (Ï†úÎ™©, ÏÑ§Î™Ö, ÌÅêÎ†àÏù¥ÌÑ∞)" style="width: 100%; padding: 0.75rem 1.25rem 0.75rem 2.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: white; font-size: 0.875rem; transition: all 0.3s;" onfocus="this.style.borderColor='rgba(139, 92, 246, 0.5)'; this.style.background='rgba(139, 92, 246, 0.05)'" onblur="this.style.borderColor='rgba(255, 255, 255, 0.15)'; this.style.background='rgba(255, 255, 255, 0.05)'">
                        <button id="clear-search" onclick="clearSearch()" style="display: none; position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: rgba(239, 68, 68, 0.2); border: none; padding: 0.25rem 0.5rem; border-radius: 6px; color: #f87171; cursor: pointer; font-size: 0.75rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <a href="/workflow-tools.html?tool=filter" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); padding: 0.75rem 1.25rem; border-radius: 12px; color: #a78bfa; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s; text-decoration: none;" onmouseover="this.style.background='rgba(139, 92, 246, 0.3)'" onmouseout="this.style.background='rgba(139, 92, 246, 0.2)'">
                        <i class="fas fa-filter"></i>
                        Í≥†Í∏â ÌïÑÌÑ∞
                    </a>
                    <a href="/workflow-tools.html?tool=searches" style="background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); padding: 0.75rem 1.25rem; border-radius: 12px; color: #34d399; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s; text-decoration: none;" onmouseover="this.style.background='rgba(16, 185, 129, 0.3)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.2)'">
                        <i class="fas fa-bookmark"></i>
                        Ï†ÄÏû•Îêú Í≤ÄÏÉâ (<span id="saved-search-count">0</span>)
                    </a>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 0.75rem;">
                <select id="type-filter" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-size: 0.875rem;">
                    <option value="all">Ï†ÑÏ≤¥ Ïú†Ìòï</option>
                    <option value="exhibition">Ï†ÑÏãú</option>
                    <option value="education">ÍµêÏú°</option>
                    <option value="archive">ÏàòÏßë/Î≥¥Ï°¥</option>
                    <option value="publication">Ï∂úÌåê</option>
                    <option value="research">Ïó∞Íµ¨</option>
                    <option value="admin">ÌñâÏ†ï</option>
                </select>
                <select id="phase-filter" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-size: 0.875rem;">
                    <option value="all">Ï†ÑÏ≤¥ Îã®Í≥Ñ</option>
                    <option value="planning">Í∏∞Ìöç</option>
                    <option value="preparation">Ï§ÄÎπÑ</option>
                    <option value="execution">ÏßÑÌñâ</option>
                    <option value="marketing">ÌôçÎ≥¥</option>
                    <option value="completed">ÏôÑÎ£å</option>
                </select>
                <select id="sort-order" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-size: 0.875rem;">
                    <option value="newest">ÏµúÏã†Ïàú</option>
                    <option value="oldest">Ïò§ÎûòÎêúÏàú</option>
                    <option value="duedate">ÎßàÍ∞êÏùºÏàú</option>
                </select>
                <!-- Export/Import/Batch Buttons -->
                <a href="/workflow-tools.html?tool=export" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 0.75rem 1.5rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: transform 0.2s; font-size: 0.875rem; text-decoration: none;">
                    <i class="fas fa-download"></i>
                    ÎÇ¥Î≥¥ÎÇ¥Í∏∞ / Í∞ÄÏ†∏Ïò§Í∏∞
                </a>
                <a href="/workflow-tools.html?tool=batch" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; padding: 0.75rem 1.5rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: transform 0.2s; font-size: 0.875rem; text-decoration: none;">
                    <i class="fas fa-tasks"></i>
                    ÏùºÍ¥Ñ ÏûëÏóÖ
                </button>
                
                <!-- View Toggle -->
                <div style="display: flex; gap: 0.5rem; margin-left: auto; background: rgba(255, 255, 255, 0.05); padding: 0.25rem; border-radius: 12px;">
                    <button id="grid-view-btn" onclick="switchView('grid')" style="background: linear-gradient(135deg, #06b6d4, #0891b2); border: none; padding: 0.75rem 1.25rem; border-radius: 10px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; transition: all 0.3s;">
                        <i class="fas fa-th"></i>
                        Í∑∏Î¶¨Îìú
                    </button>
                    <button id="timeline-view-btn" onclick="switchView('timeline')" style="background: rgba(255, 255, 255, 0.05); border: none; padding: 0.75rem 1.25rem; border-radius: 10px; color: rgba(255, 255, 255, 0.7); cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; transition: all 0.3s;">
                        <i class="fas fa-stream"></i>
                        ÌÉÄÏûÑÎùºÏù∏
                    </button>
                </div>
            </div>
            
            <!-- Active Filters Display -->
            <div id="active-filters" style="display: none; margin-bottom: 0.75rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="color: #a78bfa; font-weight: 600; font-size: 0.875rem;">
                        <i class="fas fa-filter"></i> ÌôúÏÑ± ÌïÑÌÑ∞
                    </span>
                    <button onclick="clearAllFilters()" style="background: rgba(239, 68, 68, 0.2); border: none; padding: 0.25rem 0.75rem; border-radius: 6px; color: #f87171; cursor: pointer; font-size: 0.75rem; font-weight: 600;">
                        <i class="fas fa-times"></i> Î™®Îëê ÏßÄÏö∞Í∏∞
                    </button>
                </div>
                <div id="filter-tags" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
            </div>
            <div id="projects-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 1.5rem;">
                <!-- Project cards will be dynamically inserted -->
            </div>
            
            <!-- Timeline View -->
            <div id="projects-timeline" style="display: none; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 2rem; min-height: 600px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <h3 style="font-size: 1rem; font-weight: 600; color: white; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-stream" style="color: #06b6d4;"></i>
                        ÌîÑÎ°úÏ†ùÌä∏ ÌÉÄÏûÑÎùºÏù∏
                    </h3>
                    <div style="display: flex; gap: 0.75rem; align-items: center;">
                        <span style="color: var(--text-secondary); font-size: 0.875rem;">Ï¥ù <span id="timeline-project-count">0</span>Í∞ú ÌîÑÎ°úÏ†ùÌä∏</span>
                        <button onclick="toggleTimelineGroups()" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); padding: 0.5rem 1rem; border-radius: 8px; color: #a78bfa; cursor: pointer; font-size: 0.875rem; font-weight: 600;">
                            <i class="fas fa-layer-group"></i> Í∑∏Î£πÌôî
                        </button>
                    </div>
                </div>
                <div id="timeline-container" style="width: 100%; min-height: 500px; background: rgba(0, 0, 0, 0.2); border-radius: 12px; padding: 1rem;">
                    <!-- Timeline will be rendered here -->
                </div>
            </div>
        </section>

        <!-- Team & Collaboration (ÌÜµÌï©) -->
        <section class="section-team">
            <h2 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-users" style="color: #ec4899;"></i>
                ÌåÄ & ÌòëÏóÖ
            </h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
                <!-- Team Activity Feed -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-stream" style="color: #ec4899;"></i>
                        ÌåÄ ÌôúÎèô
                    </h3>
                    <div id="team-activity" style="max-height: 400px; overflow-y: auto;">
                        <!-- Team activities will be inserted here -->
                    </div>
                </div>
                
                <!-- Top Contributors -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-trophy" style="color: #f59e0b;"></i>
                        Ïù¥Î≤à Ï£º Ïö∞Ïàò Í∏∞Ïó¨Ïûê
                    </h3>
                    <div id="top-contributors">
                        <!-- Top contributors will be inserted here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Analytics Charts -->
        <section class="section-analytics">
            <h2 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-chart-line" style="color: var(--museum-purple);"></i>
                Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù
            </h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 1.5rem;">
                <!-- Chart 1: Monthly Trend -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-line" style="color: #8b5cf6;"></i>
                        ÏõîÎ≥Ñ Ï†ÑÏãú Ìä∏Î†åÎìú
                    </h3>
                    <canvas id="monthlyTrendChart" style="max-height: 250px;"></canvas>
                </div>
                
                <!-- Chart 2: Type Distribution -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-pie" style="color: #ec4899;"></i>
                        Ï†ÑÏãú Ïú†Ìòï Î∂ÑÌè¨
                    </h3>
                    <canvas id="typeDistributionChart" style="max-height: 250px;"></canvas>
                </div>
                
                <!-- Chart 3: Budget Usage -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-chart-bar" style="color: #f59e0b;"></i>
                        ÏòàÏÇ∞ ÏÇ¨Ïö© ÌòÑÌô©
                    </h3>
                    <canvas id="budgetChart" style="max-height: 250px;"></canvas>
                </div>
                
                <!-- Chart 4: Phase Distribution -->
                <div class="glass-card">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-tasks" style="color: #10b981;"></i>
                        ÏßÑÌñâ Îã®Í≥Ñ Î∂ÑÌè¨
                    </h3>
                    <canvas id="phaseDistributionChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </section>

        <!-- (Ï†ÑÏãú Ïù∏ÏÇ¨Ïù¥Ìä∏, Ï†ÑÏãú Í¥ÄÎ¶¨, ÌåÄ ÌôúÎèô Ï§ëÎ≥µ ÏÑπÏÖò Ï†úÍ±∞Îê®) -->
                ÏÑ±Í≥º ÏßÄÌëú
            </h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                <!-- Metric 1: Task Completion Rate -->
                <div class="glass-card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;" id="metric-completion">
                        <i class="fas fa-tasks" style="color: #10b981;"></i>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #10b981;" id="metric-completion-value">78%</div>
                    <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">ÏûëÏóÖ ÏôÑÎ£åÏú®</div>
                    <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.5rem;">ÏßÄÎÇúÏ£º ÎåÄÎπÑ +5%</div>
                </div>

                <!-- Metric 2: Team Productivity -->
                <div class="glass-card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-clock" style="color: #8b5cf6;"></i>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #8b5cf6;" id="metric-productivity-value">24</div>
                    <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">ÌèâÍ∑† ÏûëÏóÖ ÏãúÍ∞Ñ (ÏãúÍ∞Ñ)</div>
                    <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.5rem;">ÏûëÏóÖÎãπ ÌèâÍ∑† ÏÜåÏöî</div>
                </div>

                <!-- Metric 3: Budget Efficiency -->
                <div class="glass-card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-won-sign" style="color: #f59e0b;"></i>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #f59e0b;" id="metric-budget-value">66%</div>
                    <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">ÏòàÏÇ∞ ÏßëÌñâÎ•†</div>
                    <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.5rem;">Ï¥ù 680M Ï§ë 450M ÏÇ¨Ïö©</div>
                </div>

                <!-- Metric 4: Team Collaboration -->
                <div class="glass-card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-comments" style="color: #ec4899;"></i>
                    </div>
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #ec4899;" id="metric-collaboration-value">156</div>
                    <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">ÌåÄ ÌòëÏóÖ ÌôúÎèô</div>
                    <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-top: 0.5rem;">Ïù¥Î≤à Ï£º ÎåìÍ∏Ä & ÏóÖÎç∞Ïù¥Ìä∏</div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // API Base URL (already defined by tracker.js, no need to redeclare)
        // Use the global API_BASE_URL from tracker.js
        
        // Authentication (Demo mode - bypass for sample data visualization)
        let token = localStorage.getItem('authToken');
        if (!token) {
            // Demo mode: create a dummy token for visualization testing
            token = 'demo-token-12345';
            localStorage.setItem('authToken', token);
            console.log('üé® Demo mode activated for data visualization');
        }
        
        // Language
        let currentLang = localStorage.getItem('museflow_language') || 'ko';
        document.getElementById('lang-select').value = currentLang;
        
        // Data
        let allProjects = [];
        
        // Calculate D-Day
        function calculateDDay(endDate) {
            if (!endDate) return null;
            const now = new Date();
            const end = new Date(endDate);
            const diff = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
            return diff;
        }
        
        // Render Progress Ring
        function renderProgressRing(percentage) {
            const radius = 32;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            
            let color = '#10b981';
            if (percentage < 40) color = '#ef4444';
            else if (percentage < 70) color = '#f59e0b';
            
            return `
                <svg class="progress-ring" width="80" height="80">
                    <circle
                        cx="40"
                        cy="40"
                        r="${radius}"
                        stroke="rgba(255, 255, 255, 0.1)"
                        stroke-width="8"
                        fill="none"
                    />
                    <circle
                        class="progress-ring-circle"
                        cx="40"
                        cy="40"
                        r="${radius}"
                        stroke="${color}"
                        stroke-width="8"
                        fill="none"
                        stroke-dasharray="${circumference}"
                        stroke-dashoffset="${offset}"
                        stroke-linecap="round"
                    />
                    <text x="40" y="45" text-anchor="middle" font-size="18" font-weight="700" fill="white">
                        ${percentage}%
                    </text>
                </svg>
            `;
        }
        
        // Render Hero Mission
        function renderHeroMission() {
            const urgentProjects = allProjects
                .filter(p => {
                    const dday = calculateDDay(p.end_date);
                    return dday !== null && dday >= 0 && dday <= 14 && p.status === 'active';
                })
                .sort((a, b) => calculateDDay(a.end_date) - calculateDDay(b.end_date));
            
            if (urgentProjects.length === 0) {
                document.getElementById('mission-title').textContent = 'Î™®Îì† ÏùºÏ†ïÏù¥ ÏàúÏ°∞Î°≠ÏäµÎãàÎã§! üéâ';
                document.getElementById('mission-dday').innerHTML = '';
                document.getElementById('mission-progress').innerHTML = renderProgressRing(100);
                document.getElementById('mission-stats').innerHTML = '<div>‚úÖ Í∏¥Í∏âÌïú Ï†ÑÏãúÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            const topMission = urgentProjects[0];
            const dday = calculateDDay(topMission.end_date);
            
            document.getElementById('mission-title').textContent = topMission.title;
            
            const ddayHTML = dday === 0 
                ? '<span class="dday-counter">üö® D-Day</span>'
                : `<span class="dday-counter">üö® D-${dday}</span>`;
            document.getElementById('mission-dday').innerHTML = ddayHTML;
            
            // Calculate progress based on phase
            const phaseProgress = {
                'planning': 20,
                'preparation': 40,
                'execution': 60,
                'marketing': 80,
                'completed': 100
            };
            const progress = phaseProgress[topMission.phase] || 0;
            document.getElementById('mission-progress').innerHTML = renderProgressRing(progress);
            
            const budgetPercent = topMission.budget_total > 0 
                ? ((topMission.budget_used / topMission.budget_total) * 100).toFixed(0)
                : 0;
            
            document.getElementById('mission-stats').innerHTML = `
                <div style="margin-bottom: 0.5rem;">üìç ${topMission.location || 'Ïû•ÏÜå ÎØ∏Ï†ï'}</div>
                <div style="margin-bottom: 0.5rem;">üë§ ${topMission.curator || 'Îã¥ÎãπÏûê ÎØ∏Ï†ï'}</div>
                <div style="margin-bottom: 0.5rem;">üé® ÏûëÌíà ${topMission.artwork_count || 0}Ï†ê</div>
                <div>üí∞ ÏòàÏÇ∞ ${budgetPercent}% ÏÇ¨Ïö©</div>
            `;
        }
        
        // Render Urgent Alerts
        function renderUrgentAlerts() {
            const alerts = [];
            
            allProjects.forEach(p => {
                const dday = calculateDDay(p.end_date);
                
                // D-7 alerts
                if (dday !== null && dday >= 0 && dday <= 7 && p.status === 'active') {
                    alerts.push({
                        type: 'dday',
                        severity: 'urgent',
                        icon: 'üö®',
                        message: `${p.title} - D-${dday === 0 ? 'Day' : dday}`,
                        action: () => window.location.href = `/canvas-v3.html?project=${p.id}`
                    });
                }
                
                // Budget alerts
                if (p.budget_total > 0) {
                    const budgetPercent = (p.budget_used / p.budget_total) * 100;
                    if (budgetPercent >= 90) {
                        alerts.push({
                            type: 'budget',
                            severity: 'warning',
                            icon: 'üí∞',
                            message: `${p.title} - ÏòàÏÇ∞ ${budgetPercent.toFixed(0)}% Ï¥àÍ≥º`,
                            action: () => window.location.href = `/projects.html`
                        });
                    }
                }
            });
            
            const container = document.getElementById('urgent-alerts');
            if (alerts.length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); padding: 2rem; text-align: center;">‚úÖ Í∏¥Í∏â ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-card" onclick='${alert.action.toString().replace(/'/g, "&apos;")}'>
                    <div class="alert-icon">${alert.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">${alert.message}</div>
                        <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">ÌÅ¥Î¶≠ÌïòÏó¨ ÏûêÏÑ∏Ìûà Î≥¥Í∏∞</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: var(--text-tertiary);"></i>
                </div>
            `).join('');
        }
        
        // Render Week Timeline
        function renderWeekTimeline() {
            const container = document.getElementById('week-timeline');
            const days = [];
            const today = new Date();
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const dayName = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][date.getDay()];
                const isToday = i === 0;
                
                // Find events for this day
                const events = allProjects.filter(p => {
                    if (!p.start_date) return false;
                    const startDate = new Date(p.start_date);
                    return startDate.toDateString() === date.toDateString();
                });
                
                days.push(`
                    <div class="timeline-day ${isToday ? 'today' : ''}">
                        <div class="day-header">${dayName}ÏöîÏùº ${isToday ? '(Ïò§Îäò)' : ''}</div>
                        <div class="day-date">${date.getMonth() + 1}/${date.getDate()}</div>
                        ${events.length > 0 
                            ? events.map(e => `<div class="day-event">üìå ${e.title}</div>`).join('') 
                            : '<div style="color: var(--text-tertiary); font-size: 0.875rem;">ÏùºÏ†ï ÏóÜÏùå</div>'
                        }
                    </div>
                `);
            }
            
            container.innerHTML = days.join('');
        }
        
        // Render Exhibition Cards
        function renderExhibitions(filter = 'all') {
            const filtered = filter === 'all' 
                ? allProjects 
                : allProjects.filter(p => p.type === filter);
            
            const typeConfig = {
                permanent: { label: 'ÏÉÅÏÑ§Ï†Ñ', icon: 'üèõÔ∏è', class: 'type-permanent' },
                special: { label: 'ÌäπÎ≥ÑÏ†Ñ', icon: '‚ú®', class: 'type-special' },
                traveling: { label: 'ÏàúÌöåÏ†Ñ', icon: 'üöå', class: 'type-traveling' },
                event: { label: 'Í∏∞ÌöçÏ†Ñ', icon: 'üé≠', class: 'type-event' }
            };
            
            const phaseProgress = {
                'planning': 20,
                'preparation': 40,
                'execution': 60,
                'marketing': 80,
                'completed': 100
            };
            
            const container = document.getElementById('exhibitions-grid');
            container.innerHTML = filtered.map(p => {
                const type = typeConfig[p.type] || typeConfig.permanent;
                const progress = phaseProgress[p.phase] || 0;
                const dday = calculateDDay(p.end_date);
                
                return `
                    <div class="exhibition-card" onclick="window.location.href='/canvas-v3.html?project=${p.id}'">
                        <div class="card-thumbnail">
                            <div class="card-icon">${type.icon}</div>
                        </div>
                        <div class="card-content">
                            <span class="card-type ${type.class}">${type.icon} ${type.label}</span>
                            <h3 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.75rem;">${p.title}</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 0.75rem; line-height: 1.6;">
                                ${p.description || 'ÏÑ§Î™Ö ÏóÜÏùå'}
                            </p>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; font-size: 0.875rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 0.75rem;">
                                ${p.location ? `<div><i class="fas fa-map-marker-alt"></i> ${p.location}</div>` : ''}
                                ${p.curator ? `<div><i class="fas fa-user-tie"></i> ${p.curator}</div>` : ''}
                                ${p.artwork_count ? `<div><i class="fas fa-palette"></i> ÏûëÌíà ${p.artwork_count}Ï†ê</div>` : ''}
                                ${dday !== null && dday >= 0 ? `<div><i class="fas fa-calendar"></i> D-${dday}</div>` : ''}
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">
                                    ÏßÑÌñâÎ•†: ${progress}%
                                </div>
                                <div style="width: 100px; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 100px; overflow: hidden;">
                                    <div style="width: ${progress}%; height: 100%; background: linear-gradient(90deg, #8b5cf6, #ec4899); border-radius: 100px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render Team Activity (Real Data from Tasks & Comments)
        async function renderTeamActivity() {
            try {
                // Get recent tasks (updated in last 7 days)
                const recentTasks = allProjects.flatMap(p => {
                    // Get tasks for this project
                    return [];
                }).filter(t => {
                    const updated = new Date(t.updated_at);
                    const now = new Date();
                    const diffDays = (now - updated) / (1000 * 60 * 60 * 24);
                    return diffDays <= 7;
                }).sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
                
                // Generate activity feed from projects and tasks
                const activities = [];
                
                // Add project updates
                allProjects.slice(0, 3).forEach(p => {
                    const updated = new Date(p.updated_at);
                    const now = new Date();
                    const diffMs = now - updated;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    let timeStr = '';
                    if (diffMins < 60) timeStr = `${diffMins}Î∂Ñ Ï†Ñ`;
                    else if (diffHours < 24) timeStr = `${diffHours}ÏãúÍ∞Ñ Ï†Ñ`;
                    else timeStr = `${diffDays}Ïùº Ï†Ñ`;
                    
                    const statusText = {
                        'planning': 'Í∏∞Ìöç Ï§ë',
                        'preparation': 'Ï§ÄÎπÑ Ï§ë',
                        'execution': 'ÏßÑÌñâ Ï§ë',
                        'marketing': 'ÌôçÎ≥¥ Ï§ë',
                        'completed': 'ÏôÑÎ£å'
                    }[p.phase] || 'ÏßÑÌñâ Ï§ë';
                    
                    activities.push({
                        user: p.curator || 'Îã¥ÎãπÏûê',
                        action: `${p.title} - ${statusText}`,
                        time: timeStr,
                        avatar: (p.curator || 'Îã¥')[0],
                        icon: 'üìã',
                        type: 'project'
                    });
                });
                
                // Add task activities (simulated from project data)
                const taskActivities = [
                    { user: 'ÍπÄÌÅêÎ†àÏù¥ÌÑ∞', action: 'ÏûëÌíà ÏÑ†Ï†ï ÌöåÏùò ÏôÑÎ£å', time: '1ÏãúÍ∞Ñ Ï†Ñ', avatar: 'ÍπÄ', icon: '‚úÖ', type: 'task' },
                    { user: 'Ïù¥ÌïôÏòàÏÇ¨', action: 'ÎèÑÏä®Ìä∏ ÍµêÏú° ÏûêÎ£å ÏûëÏÑ± Ï§ë', time: '2ÏãúÍ∞Ñ Ï†Ñ', avatar: 'Ïù¥', icon: 'üìù', type: 'task' },
                    { user: 'Î∞ïÎîîÏûêÏù¥ÎÑà', action: 'Ìè¨Ïä§ÌÑ∞ ÎîîÏûêÏù∏ ÏãúÏïà ÏóÖÎ°úÎìú', time: '3ÏãúÍ∞Ñ Ï†Ñ', avatar: 'Î∞ï', icon: 'üé®', type: 'design' },
                    { user: 'ÏµúÎßàÏºÄÌÑ∞', action: 'SNS ÌôçÎ≥¥ ÏΩòÌÖêÏ∏† Î∞úÌñâ', time: '5ÏãúÍ∞Ñ Ï†Ñ', avatar: 'Ïµú', icon: 'üì¢', type: 'marketing' },
                    { user: 'Ï†ïÏΩîÎîîÎÑ§Ïù¥ÌÑ∞', action: 'ÏûëÌíà Ïö¥ÏÜ° ÏùºÏ†ï ÌôïÏ†ï', time: '8ÏãúÍ∞Ñ Ï†Ñ', avatar: 'Ï†ï', icon: 'üöö', type: 'logistics' }
                ];
                
                // Merge and limit to 8 items
                const allActivities = [...activities, ...taskActivities].slice(0, 8);
                
                const container = document.getElementById('team-activity');
                container.innerHTML = allActivities.map(a => {
                    const bgColor = {
                        'project': 'rgba(139, 92, 246, 0.2)',
                        'task': 'rgba(16, 185, 129, 0.2)',
                        'design': 'rgba(236, 72, 153, 0.2)',
                        'marketing': 'rgba(245, 158, 11, 0.2)',
                        'logistics': 'rgba(59, 130, 246, 0.2)'
                    }[a.type] || 'rgba(255, 255, 255, 0.1)';
                    
                    return `
                        <div class="activity-item" style="background: ${bgColor}; border-left: 3px solid rgba(255,255,255,0.3);">
                            <div class="avatar" style="background: linear-gradient(135deg, #8b5cf6, #ec4899);">${a.avatar}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span>${a.icon}</span>
                                    <span>${a.user}</span>
                                </div>
                                <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.8);">${a.action}</div>
                            </div>
                            <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); white-space: nowrap;">${a.time}</div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error rendering team activity:', error);
            }
        }
        
        // Quick Action Functions
        function viewMission() {
            const urgentProjects = allProjects.filter(p => {
                const dday = calculateDDay(p.end_date);
                return dday !== null && dday >= 0 && dday <= 14 && p.status === 'active';
            }).sort((a, b) => calculateDDay(a.end_date) - calculateDDay(b.end_date));
            
            if (urgentProjects.length > 0) {
                window.location.href = `/canvas-v3.html?project=${urgentProjects[0].id}`;
            }
        }
        
        function openChecklist() {
            console.log('‚úÖ Checklist feature coming soon');
            // Removed blocking alert - silent operation
        }
        
        function contactTeam() {
            console.log('üí¨ Team chat feature coming soon');
            // Removed blocking alert - silent operation
        }
        
        // Chart.js Configuration
        Chart.defaults.color = 'rgba(255, 255, 255, 0.8)';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
        
        let charts = {
            monthlyTrend: null,
            typeDistribution: null,
            budget: null,
            phaseDistribution: null
        };
        
        // Render Monthly Trend Chart
        function renderMonthlyTrendChart() {
            console.log('üìä Rendering Monthly Trend Chart...');
            const ctx = document.getElementById('monthlyTrendChart');
            if (!ctx) {
                console.error('‚ùå Canvas element not found: monthlyTrendChart');
                return;
            }
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js not loaded');
                return;
            }
            console.log('‚úÖ Chart.js ready, projects count:', allProjects.length);
            
            // Destroy existing chart
            if (charts.monthlyTrend) charts.monthlyTrend.destroy();
            
            // Calculate monthly data (last 6 months)
            const months = [];
            const counts = [];
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthStr = month.toLocaleDateString('ko-KR', { month: 'short' });
                months.push(monthStr);
                
                // Count projects created in this month
                const count = allProjects.filter(p => {
                    const created = new Date(p.created_at);
                    return created.getMonth() === month.getMonth() && 
                           created.getFullYear() === month.getFullYear();
                }).length;
                counts.push(count);
            }
            
            charts.monthlyTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Ï†ÑÏãú Ïàò',
                        data: counts,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 },
                            grid: { color: 'rgba(255, 255, 255, 0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        // Render Type Distribution Chart
        function renderTypeDistributionChart() {
            const ctx = document.getElementById('typeDistributionChart');
            if (!ctx || typeof Chart === 'undefined') return;
            
            if (charts.typeDistribution) charts.typeDistribution.destroy();
            
            const typeCounts = {
                permanent: 0,
                special: 0,
                traveling: 0,
                event: 0
            };
            
            allProjects.forEach(p => {
                if (typeCounts.hasOwnProperty(p.type)) {
                    typeCounts[p.type]++;
                }
            });
            
            charts.typeDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ÏÉÅÏÑ§Ï†Ñ', 'ÌäπÎ≥ÑÏ†Ñ', 'ÏàúÌöåÏ†Ñ', 'Í∏∞ÌöçÏ†Ñ'],
                    datasets: [{
                        data: [typeCounts.permanent, typeCounts.special, typeCounts.traveling, typeCounts.event],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(16, 185, 129, 0.8)'
                        ],
                        borderColor: [
                            '#3b82f6',
                            '#ec4899',
                            '#f59e0b',
                            '#10b981'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15 }
                        }
                    }
                }
            });
        }
        
        // Render Budget Chart
        function renderBudgetChart() {
            const ctx = document.getElementById('budgetChart');
            if (!ctx || typeof Chart === 'undefined') return;
            
            if (charts.budget) charts.budget.destroy();
            
            // Get top 5 projects by budget
            const budgetProjects = allProjects
                .filter(p => p.budget_total > 0)
                .sort((a, b) => b.budget_total - a.budget_total)
                .slice(0, 5);
            
            const labels = budgetProjects.map(p => p.title.length > 15 ? p.title.substring(0, 15) + '...' : p.title);
            const totalBudgets = budgetProjects.map(p => p.budget_total || 0);
            const usedBudgets = budgetProjects.map(p => p.budget_used || 0);
            
            charts.budget = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ï¥ù ÏòàÏÇ∞',
                            data: totalBudgets,
                            backgroundColor: 'rgba(139, 92, 246, 0.6)',
                            borderColor: '#8b5cf6',
                            borderWidth: 1
                        },
                        {
                            label: 'ÏÇ¨Ïö© ÏòàÏÇ∞',
                            data: usedBudgets,
                            backgroundColor: 'rgba(236, 72, 153, 0.6)',
                            borderColor: '#ec4899',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15 }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + 'ÎßåÏõê';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        // Render Phase Distribution Chart
        function renderPhaseDistributionChart() {
            const ctx = document.getElementById('phaseDistributionChart');
            if (!ctx || typeof Chart === 'undefined') return;
            
            if (charts.phaseDistribution) charts.phaseDistribution.destroy();
            
            const phaseCounts = {
                planning: 0,
                preparation: 0,
                execution: 0,
                marketing: 0,
                completed: 0
            };
            
            allProjects.forEach(p => {
                if (phaseCounts.hasOwnProperty(p.phase)) {
                    phaseCounts[p.phase]++;
                }
            });
            
            charts.phaseDistribution = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Í∏∞Ìöç', 'Ï§ÄÎπÑ', 'ÏßÑÌñâ', 'ÌôçÎ≥¥', 'ÏôÑÎ£å'],
                    datasets: [{
                        data: [phaseCounts.planning, phaseCounts.preparation, phaseCounts.execution, phaseCounts.marketing, phaseCounts.completed],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(236, 72, 153, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(16, 185, 129, 0.8)'
                        ],
                        borderColor: [
                            '#3b82f6',
                            '#f59e0b',
                            '#ec4899',
                            '#8b5cf6',
                            '#10b981'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15 }
                        }
                    }
                }
            });
        }
        
        // Load Projects
        // Render Performance Metrics
        function renderPerformanceMetrics() {
            // Calculate task completion rate (simulated from projects)
            const totalTasks = allProjects.reduce((sum, p) => sum + (p.task_count || 0), 0);
            const completedTasks = allProjects.reduce((sum, p) => sum + (p.completed_tasks || 0), 0);
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('metric-completion-value').textContent = completionRate + '%';
            
            // Calculate budget efficiency
            const totalBudget = allProjects.reduce((sum, p) => sum + (p.budget_total || 0), 0);
            const usedBudget = allProjects.reduce((sum, p) => sum + (p.budget_used || 0), 0);
            const budgetRate = totalBudget > 0 ? Math.round((usedBudget / totalBudget) * 100) : 0;
            
            document.getElementById('metric-budget-value').textContent = budgetRate + '%';
            
            // Average task time (simulated: 24-48 hours)
            const avgHours = 24 + Math.floor(Math.random() * 24);
            document.getElementById('metric-productivity-value').textContent = avgHours;
            
            // Collaboration activities (simulated: 100-200)
            const collaborationCount = 100 + Math.floor(Math.random() * 100);
            document.getElementById('metric-collaboration-value').textContent = collaborationCount;
        }
        
        // Render Exhibition Insights
        function renderExhibitionInsights() {
            // 1. Most Active Exhibition (most tasks)
            const mostActive = [...allProjects].sort((a, b) => (b.task_count || 0) - (a.task_count || 0))[0];
            if (mostActive) {
                document.getElementById('insight-most-active').textContent = mostActive.title;
                document.getElementById('insight-most-active-desc').textContent = 
                    `${mostActive.task_count || 0}Í∞ú ÏûëÏóÖ ÏßÑÌñâ Ï§ë ‚Ä¢ ${mostActive.curator || 'Îã¥ÎãπÏûê ÎØ∏ÏßÄÏ†ï'}`;
            }
            
            // 2. Urgent Attention (D-7 or budget > 90%)
            const urgentProjects = allProjects.filter(p => {
                const dday = calculateDDay(p.end_date);
                const budgetRate = p.budget_total > 0 ? (p.budget_used / p.budget_total) : 0;
                return (dday !== null && dday <= 7 && dday >= 0) || budgetRate > 0.9;
            });
            document.getElementById('insight-urgent-count').textContent = urgentProjects.length;
            
            if (urgentProjects.length > 0) {
                const urgentNames = urgentProjects.slice(0, 2).map(p => p.title).join(', ');
                document.getElementById('insight-urgent-desc').textContent = 
                    `${urgentNames}${urgentProjects.length > 2 ? ` Ïô∏ ${urgentProjects.length - 2}Í±¥` : ''}`;
            } else {
                document.getElementById('insight-urgent-desc').textContent = 'Î™®Îì† Ï†ÑÏãúÍ∞Ä ÏàúÏ°∞Î°≠Í≤å ÏßÑÌñâ Ï§ëÏûÖÎãàÎã§ ‚úì';
            }
            
            // 3. Budget Status
            const totalBudget = allProjects.reduce((sum, p) => sum + (p.budget_total || 0), 0);
            const usedBudget = allProjects.reduce((sum, p) => sum + (p.budget_used || 0), 0);
            const budgetRate = totalBudget > 0 ? Math.round((usedBudget / totalBudget) * 100) : 0;
            
            document.getElementById('insight-budget-total').textContent = (totalBudget / 100000000).toFixed(1) + 'ÏñµÏõê';
            document.getElementById('insight-budget-used').textContent = (usedBudget / 100000000).toFixed(1) + 'ÏñµÏõê';
            document.getElementById('insight-budget-rate').textContent = budgetRate + '%';
            
            // 4. Upcoming Events (this week)
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const upcomingEvents = allProjects.filter(p => {
                if (!p.start_date) return false;
                const startDate = new Date(p.start_date);
                return startDate >= today && startDate <= nextWeek;
            });
            
            document.getElementById('insight-upcoming-count').textContent = upcomingEvents.length + 'Í±¥';
            
            if (upcomingEvents.length > 0) {
                const eventNames = upcomingEvents.slice(0, 2).map(p => {
                    const date = new Date(p.start_date);
                    return `${date.getMonth() + 1}/${date.getDate()} ${p.title}`;
                }).join(', ');
                document.getElementById('insight-upcoming-desc').textContent = eventNames;
            } else {
                document.getElementById('insight-upcoming-desc').textContent = 'Ïù¥Î≤à Ï£º ÏòàÏ†ïÎêú Ï†ÑÏãúÍ∞Ä ÏóÜÏäµÎãàÎã§';
            }
        }
        
        async function loadProjects() {
            try {
                console.log('üîÑ [Dashboard] Starting to load projects...');
                console.log('üìç API URL:', `${API_BASE_URL}/api/projects`);
                console.log('üîë Token:', token ? 'Present' : 'Missing');
                
                const response = await fetch(`${API_BASE_URL}/api/projects`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                console.log('üì° Response status:', response.status, response.statusText);
                
                if (!response.ok) throw new Error('Failed to load projects');
                
                const data = await response.json();
                allProjects = data.projects;
                
                console.log('‚úÖ Projects loaded:', allProjects.length);
                console.log('üìä First project:', allProjects[0]?.title);
                
                console.log('üé® Rendering dashboard sections...');
                renderHeroMission();
                updateStats(); // Update Overview stats
                initCalendar(); // Initialize FullCalendar
                renderProjectsGrid(); // Render projects grid with filters
                renderTeamActivity();
                renderPerformanceMetrics(); // Add metrics rendering
                
                // Render charts
                console.log('üìà Rendering charts...');
                renderMonthlyTrendChart();
                renderTypeDistributionChart();
                renderBudgetChart();
                renderPhaseDistributionChart();
                
                // Render analytics charts
                renderAnalyticsKPIs();
                renderAnalyticsMonthlyTrend();
                renderAnalyticsTypeDistribution();
                renderAnalyticsPhaseProgress();
                renderAnalyticsTimelineStatus();
                
                // Initialize notification system
                initNotificationSystem();
                
                // Load dashboard settings
                loadDashboardSettings();
                
                console.log('‚ú® Dashboard rendering complete!');
                
                // Start real-time auto-refresh (every 30 seconds)
                startAutoRefresh();
                
            } catch (error) {
                console.error('‚ùå Error loading projects:', error);
                console.error('Stack trace:', error.stack);
            }
        }
        
        // Event Listeners
        document.getElementById('type-filter')?.addEventListener('change', () => renderProjectsGrid());
        document.getElementById('phase-filter')?.addEventListener('change', () => renderProjectsGrid());
        document.getElementById('sort-order')?.addEventListener('change', () => renderProjectsGrid());
        
        // Search event listener (real-time)
        document.getElementById('project-search')?.addEventListener('input', (e) => {
            const searchTerm = e.target.value.trim();
            const clearBtn = document.getElementById('clear-search');
            
            if (searchTerm) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
            
            renderProjectsGrid();
        });
        
        // Canvas dropdown toggle
        function toggleWorkflowMenu() {
            const dropdown = document.getElementById('workflow-dropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('workflow-dropdown');
            const workflowMenu = document.querySelector('.workflow-menu');
            
            if (workflowMenu && !workflowMenu.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });
        
        // Initialize (wait for Chart.js to load)
        if (typeof Chart !== 'undefined') {
            loadProjects();
        } else {
            console.warn('Chart.js not loaded yet, waiting...');
            window.addEventListener('load', () => {
                setTimeout(loadProjects, 100);
            });
        }
    </script>
    
    <!-- PWA Service Worker Registration (Disabled to prevent blocking) -->
    <script>
        // Service Worker disabled to ensure data visualization loads properly
        // Will be re-enabled after proper testing
        /*
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.warn('[PWA] Service Worker registration failed (non-critical):', error);
                    });
            });
        }
        */
    </script>
    
    <!-- Notification System -->
    <script src="/static/js/notification-system.js"></script>
    <script>
        function toggleNotificationPanel() {
            const panel = document.getElementById('notification-panel');
            const isVisible = panel.style.display === 'block';
            panel.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                notificationSystem.renderNotificationPanel();
            }
        }

        // Close panel when clicking outside
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('notification-panel');
            const btn = document.getElementById('notification-btn');
            
            if (!btn.contains(e.target) && !panel.contains(e.target)) {
                panel.style.display = 'none';
            }
        });

        // Test notification on page load (only once per session)
        if (!sessionStorage.getItem('welcome_notification_shown')) {
            setTimeout(() => {
                notificationSystem.showInAppNotification(
                    'ÌôòÏòÅÌï©ÎãàÎã§! ÏïåÎ¶º ÏãúÏä§ÌÖúÏù¥ ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§. üéâ',
                    'success'
                );
                sessionStorage.setItem('welcome_notification_shown', 'true');
            }, 2000);
        }
        
        // ========================================
        // Projects Management Functions
        // ========================================
        
        let editingProjectId = null;
        
        // Update project stats
        function updateStats() {
            const total = allProjects.length;
            const inProgress = allProjects.filter(p => 
                p.phase !== 'completed' && p.status === 'active'
            ).length;
            const completed = allProjects.filter(p => p.phase === 'completed').length;
            
            // Calculate projects due this month
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const dueThisMonth = allProjects.filter(p => {
                if (!p.end_date) return false;
                const endDate = new Date(p.end_date);
                return endDate.getMonth() === currentMonth && endDate.getFullYear() === currentYear;
            }).length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-inprogress').textContent = inProgress;
            document.getElementById('stat-completed').textContent = completed;
            document.getElementById('stat-duethismonth').textContent = dueThisMonth;
        }
        
        // Render projects grid
        function renderProjectsGrid() {
            const typeFilter = document.getElementById('type-filter')?.value || 'all';
            const phaseFilter = document.getElementById('phase-filter')?.value || 'all';
            const sortBy = document.getElementById('sort-order')?.value || 'newest';
            const searchTerm = document.getElementById('project-search')?.value.toLowerCase().trim() || '';
            
            let filtered = allProjects.filter(p => {
                const matchType = typeFilter === 'all' || p.type === typeFilter;
                const matchPhase = phaseFilter === 'all' || p.phase === phaseFilter;
                
                // Search filter (title, description, curator, location)
                let matchSearch = true;
                if (searchTerm) {
                    const titleMatch = (p.title || '').toLowerCase().includes(searchTerm);
                    const descMatch = (p.description || '').toLowerCase().includes(searchTerm);
                    const curatorMatch = (p.curator || '').toLowerCase().includes(searchTerm);
                    const locationMatch = (p.location || '').toLowerCase().includes(searchTerm);
                    matchSearch = titleMatch || descMatch || curatorMatch || locationMatch;
                }
                
                return matchType && matchPhase && matchSearch;
            });
            
            // Sort
            filtered.sort((a, b) => {
                if (sortBy === 'newest') {
                    return new Date(b.created_at || b.updated_at) - new Date(a.created_at || a.updated_at);
                } else if (sortBy === 'oldest') {
                    return new Date(a.created_at || a.updated_at) - new Date(b.created_at || b.updated_at);
                } else if (sortBy === 'duedate') {
                    const ddayA = calculateDDay(a.end_date) ?? 9999;
                    const ddayB = calculateDDay(b.end_date) ?? 9999;
                    return ddayA - ddayB;
                }
            });
            
            const grid = document.getElementById('projects-grid');
            if (!grid) return;
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem; grid-column: 1 / -1;">
                        <div style="font-size: 4rem; margin-bottom: 0.75rem; opacity: 0.5;">üé®</div>
                        <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: rgba(255, 255, 255, 0.8);">Ï†ÑÏãúÍ∞Ä ÏóÜÏäµÎãàÎã§</h3>
                        <p style="color: var(--text-secondary);">ÏÉà Ï†ÑÏãúÎ•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî!</p>
                    </div>
                `;
                return;
            }
            
            const typeConfig = {
                permanent: { label: 'ÏÉÅÏÑ§Ï†Ñ', icon: 'üèõÔ∏è', class: 'type-permanent' },
                special: { label: 'ÌäπÎ≥ÑÏ†Ñ', icon: '‚ú®', class: 'type-special' },
                traveling: { label: 'ÏàúÌöåÏ†Ñ', icon: 'üöå', class: 'type-traveling' },
                event: { label: 'Í∏∞ÌöçÏ†Ñ', icon: 'üé≠', class: 'type-event' }
            };
            
            const phaseConfig = {
                planning: { label: 'Í∏∞Ìöç', icon: 'üí°', progress: 20 },
                preparation: { label: 'Ï§ÄÎπÑ', icon: 'üîß', progress: 40 },
                execution: { label: 'ÏßÑÌñâ', icon: 'üöÄ', progress: 60 },
                marketing: { label: 'ÌôçÎ≥¥', icon: 'üì¢', progress: 80 },
                completed: { label: 'ÏôÑÎ£å', icon: '‚úÖ', progress: 100 }
            };
            
            grid.innerHTML = filtered.map(project => {
                const type = typeConfig[project.type] || typeConfig.permanent;
                const phase = phaseConfig[project.phase] || phaseConfig.planning;
                const dday = calculateDDay(project.end_date);
                
                let ddayBadge = '';
                if (dday !== null && dday >= 0) {
                    let ddayColor = '#10b981';
                    if (dday <= 7) ddayColor = '#ef4444';
                    else if (dday <= 14) ddayColor = '#f59e0b';
                    ddayBadge = `<span style="background: ${ddayColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">D-${dday}</span>`;
                }
                
                return `
                    <div class="glass-card" style="padding: 0; overflow: hidden; cursor: default;">
                        <div style="padding: 1.5rem; padding-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <button onclick="event.stopPropagation(); toggleFavorite(${project.id})" id="fav-${project.id}" style="background: none; border: none; cursor: pointer; font-size: 1rem; padding: 0; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'">
                                        <i class="fa${isFavorite(project.id) ? 's' : 'r'} fa-star" style="color: ${isFavorite(project.id) ? '#fbbf24' : 'rgba(255,255,255,0.3)'}"></i>
                                    </button>
                                    <span style="background: rgba(139, 92, 246, 0.2); color: #a78bfa; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">${type.icon} ${type.label}</span>
                                </div>
                                ${ddayBadge}
                            </div>
                            <h3 style="font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; color: white;">${project.title}</h3>
                            <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.75rem; line-height: 1.5;">${project.description || 'ÏÑ§Î™ÖÏù¥ ÏóÜÏäµÎãàÎã§.'}</p>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-bottom: 0.75rem; font-size: 0.75rem; color: rgba(255, 255, 255, 0.7);">
                                ${project.location ? `<div><i class="fas fa-map-marker-alt"></i> ${project.location}</div>` : '<div></div>'}
                                ${project.curator ? `<div><i class="fas fa-user-tie"></i> ${project.curator}</div>` : '<div></div>'}
                                ${project.artwork_count ? `<div><i class="fas fa-palette"></i> ${project.artwork_count}Ï†ê</div>` : '<div></div>'}
                                ${project.start_date ? `<div><i class="fas fa-calendar"></i> ${project.start_date}</div>` : '<div></div>'}
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <div style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 0.5rem;">${phase.icon} ${phase.label} (${phase.progress}%)</div>
                                <div style="display: flex; align-items: center; gap: 0.25rem; margin-bottom: 0.5rem;">
                                    <span style="color: ${project.phase === 'planning' || project.phase === 'preparation' || project.phase === 'execution' || project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 1rem;">‚óè</span>
                                    <span style="color: ${project.phase === 'preparation' || project.phase === 'execution' || project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 0.5rem;">‚îÅ‚îÅ</span>
                                    <span style="color: ${project.phase === 'preparation' || project.phase === 'execution' || project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 1rem;">‚óè</span>
                                    <span style="color: ${project.phase === 'execution' || project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 0.5rem;">‚îÅ‚îÅ</span>
                                    <span style="color: ${project.phase === 'execution' || project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 1rem;">‚óè</span>
                                    <span style="color: ${project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 0.5rem;">‚îÅ‚îÅ</span>
                                    <span style="color: ${project.phase === 'marketing' || project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 1rem;">‚óè</span>
                                    <span style="color: ${project.phase === 'completed' ? '#8b5cf6' : 'rgba(255,255,255,0.3)'}; font-size: 0.5rem;">‚îÅ‚îÅ</span>
                                    <span style="color: ${project.phase === 'completed' ? '#10b981' : 'rgba(255,255,255,0.3)'}; font-size: 1rem;">‚óè</span>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.1); height: 6px; border-radius: 9999px; overflow: hidden;">
                                    <div style="background: linear-gradient(135deg, #8b5cf6, #ec4899); height: 100%; width: ${phase.progress}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; padding: 0.75rem 1.5rem; background: rgba(0, 0, 0, 0.2); border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <button onclick="event.stopPropagation(); openCanvas(${project.id}, 'workflow')" style="padding: 0.5rem; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: #a78bfa; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(139, 92, 246, 0.3)'" onmouseout="this.style.background='rgba(139, 92, 246, 0.2)'">
                                <i class="fas fa-eye"></i> Î≥¥Í∏∞
                            </button>
                            <button onclick="event.stopPropagation(); editProject(${project.id})" style="padding: 0.5rem; background: rgba(6, 182, 212, 0.2); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 8px; color: #22d3ee; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(6, 182, 212, 0.3)'" onmouseout="this.style.background='rgba(6, 182, 212, 0.2)'">
                                <i class="fas fa-edit"></i> ÏàòÏ†ï
                            </button>
                            <button onclick="event.stopPropagation(); saveAsTemplate(${project.id})" style="padding: 0.5rem; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; color: #34d399; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(16, 185, 129, 0.3)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.2)'">
                                <i class="fas fa-save"></i> ÌÖúÌîåÎ¶ø
                            </button>
                            <button onclick="event.stopPropagation(); duplicateProject(${project.id})" style="padding: 0.5rem; background: rgba(245, 158, 11, 0.2); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; color: #fbbf24; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(245, 158, 11, 0.3)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.2)'">
                                <i class="fas fa-copy"></i> Î≥µÏ†ú
                            </button>
                            <button onclick="event.stopPropagation(); deleteProject(${project.id})" style="padding: 0.5rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; color: #f87171; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                                <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Open canvas with type selection
        function openCanvas(projectId, type = 'workflow') {
            console.log('üé® Opening canvas:', { projectId, type });
            
            if (!projectId) {
                console.error('‚ùå No project ID provided');
                console.warn('‚ö†Ô∏è ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const url = `/canvas-v3.html?project=${projectId}`;
            console.log('üìç Navigating to:', url);
            window.location.href = url;
        }
        
        // Edit Project - Open modal with budget fields
        let currentEditProjectId = null;
        
        async function editProject(projectId) {
            console.log('‚úèÔ∏è Editing project:', projectId);
            
            const project = allProjects.find(p => p.id === projectId);
            if (!project) {
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            currentEditProjectId = projectId;
            
            // Fill modal with project data
            document.getElementById('edit-title').value = project.title || '';
            document.getElementById('edit-description').value = project.description || '';
            document.getElementById('edit-type').value = project.type || 'exhibition';
            document.getElementById('edit-phase').value = project.phase || 'planning';
            document.getElementById('edit-budget-total').value = project.budget_total || '';
            document.getElementById('edit-budget-used').value = project.budget_used || '';
            document.getElementById('edit-start-date').value = project.start_date || '';
            document.getElementById('edit-end-date').value = project.end_date || '';
            document.getElementById('edit-curator').value = project.curator || '';
            document.getElementById('edit-location').value = project.location || '';
            
            // Update budget indicator
            updateBudgetIndicator();
            
            // Show modal
            document.getElementById('edit-project-modal').style.display = 'block';
        }
        
        function closeEditModal() {
            document.getElementById('edit-project-modal').style.display = 'none';
            currentEditProjectId = null;
        }
        
        // Update budget usage indicator in real-time
        function updateBudgetIndicator() {
            const totalInput = document.getElementById('edit-budget-total');
            const usedInput = document.getElementById('edit-budget-used');
            const indicator = document.getElementById('budget-usage-indicator');
            const percentSpan = document.getElementById('budget-usage-percent');
            const bar = document.getElementById('budget-usage-bar');
            
            const total = parseFloat(totalInput.value) || 0;
            const used = parseFloat(usedInput.value) || 0;
            
            if (total > 0 && used >= 0) {
                const percent = (used / total) * 100;
                indicator.style.display = 'block';
                percentSpan.textContent = `${percent.toFixed(1)}%`;
                bar.style.width = `${Math.min(percent, 100)}%`;
                
                // Color coding based on usage
                if (percent >= 90) {
                    bar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                    percentSpan.style.color = '#f87171';
                } else if (percent >= 70) {
                    bar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                    percentSpan.style.color = '#fbbf24';
                } else {
                    bar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                    percentSpan.style.color = '#34d399';
                }
            } else {
                indicator.style.display = 'none';
            }
        }
        
        // Handle edit form submission
        document.getElementById('edit-project-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentEditProjectId) return;
            
            const updateData = {
                title: document.getElementById('edit-title').value,
                description: document.getElementById('edit-description').value,
                type: document.getElementById('edit-type').value,
                phase: document.getElementById('edit-phase').value,
                budget_total: parseInt(document.getElementById('edit-budget-total').value) || 0,
                budget_used: parseInt(document.getElementById('edit-budget-used').value) || 0,
                start_date: document.getElementById('edit-start-date').value || null,
                end_date: document.getElementById('edit-end-date').value || null,
                curator: document.getElementById('edit-curator').value || null,
                location: document.getElementById('edit-location').value || null
            };
            
            try {
                const result = await window.apiClient.projects.update(currentEditProjectId, updateData);
                
                if (result.success) {
                    notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§! ‚úÖ', 'success');
                    closeEditModal();
                    loadProjects();
                    
                    // Show warning if budget exceeded
                    if (updateData.budget_total > 0 && updateData.budget_used > updateData.budget_total) {
                        setTimeout(() => {
                            notificationSystem.showInAppNotification('‚ö†Ô∏è ÏòàÏÇ∞ Ï¥àÍ≥º! ÏÇ¨Ïö© ÏòàÏÇ∞Ïù¥ Ï¥ù ÏòàÏÇ∞ÏùÑ Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.', 'warning');
                        }, 500);
                    }
                }
            } catch (error) {
                console.error('Error updating project:', error);
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        });
        
        // Add real-time budget indicator updates
        document.getElementById('edit-budget-total').addEventListener('input', updateBudgetIndicator);
        document.getElementById('edit-budget-used').addEventListener('input', updateBudgetIndicator);
        
        // Duplicate Project
        async function duplicateProject(projectId) {
            console.log('üìã Duplicating project:', projectId);
            
            const project = allProjects.find(p => p.id === projectId);
            if (!project) {
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const confirm = window.confirm(`"${project.title}"ÏùÑ(Î•º) Î≥µÏ†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            if (!confirm) return;
            
            try {
                const result = await window.apiClient.projects.create({
                    title: `${project.title} (Î≥µÏÇ¨Î≥∏)`,
                    description: project.description,
                    type: project.type,
                    phase: 'planning',
                    location: project.location,
                    curator: project.curator
                });
                
                if (result.success) {
                    notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Í∞Ä Î≥µÏ†úÎêòÏóàÏäµÎãàÎã§! üìã', 'success');
                    loadProjects();
                }
            } catch (error) {
                console.error('Error duplicating project:', error);
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏ Î≥µÏ†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }
        
        // Delete Project
        async function deleteProject(projectId) {
            console.log('üóëÔ∏è Deleting project:', projectId);
            
            const project = allProjects.find(p => p.id === projectId);
            if (!project) {
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            const confirm = window.confirm(`Ï†ïÎßêÎ°ú "${project.title}"ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚ö†Ô∏è Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.`);
            if (!confirm) return;
            
            try {
                const result = await window.apiClient.projects.delete(projectId);
                
                if (result.success) {
                    notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§! üóëÔ∏è', 'success');
                    loadProjects();
                }
            } catch (error) {
                console.error('Error deleting project:', error);
                notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
            }
        }
        
        // ========================================================================
        // Favorites System
        // ========================================================================
        
        function isFavorite(projectId) {
            const favorites = JSON.parse(localStorage.getItem('favorite_projects') || '[]');
            return favorites.includes(projectId);
        }
        
        function toggleFavorite(projectId) {
            let favorites = JSON.parse(localStorage.getItem('favorite_projects') || '[]');
            const index = favorites.indexOf(projectId);
            
            if (index > -1) {
                favorites.splice(index, 1);
                notificationSystem.showInAppNotification('Ï¶êÍ≤®Ï∞æÍ∏∞ÏóêÏÑú Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§', 'info');
            } else {
                favorites.push(projectId);
                notificationSystem.showInAppNotification('Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! ‚≠ê', 'success');
            }
            
            localStorage.setItem('favorite_projects', JSON.stringify(favorites));
            
            // Update button
            const btn = document.getElementById(`fav-${projectId}`);
            if (btn) {
                const icon = btn.querySelector('i');
                if (isFavorite(projectId)) {
                    icon.className = 'fas fa-star';
                    icon.style.color = '#fbbf24';
                } else {
                    icon.className = 'far fa-star';
                    icon.style.color = 'rgba(255,255,255,0.3)';
                }
            }
        }
        
        function filterFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorite_projects') || '[]');
            if (favorites.length === 0) {
                notificationSystem.showInAppNotification('Ï¶êÍ≤®Ï∞æÍ∏∞Ìïú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                return;
            }
            
            displayedProjects = allProjects.filter(p => favorites.includes(p.id));
            renderProjects();
            
            // Update filter status
            document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
            notificationSystem.showInAppNotification(`Ï¶êÍ≤®Ï∞æÍ∏∞ ${displayedProjects.length}Í∞ú ÌîÑÎ°úÏ†ùÌä∏ ÌëúÏãú`, 'success');
        }
        
        // ========================================================================
        // AI Recommendations System (Rule-based)
        // ========================================================================
        
        function getProjectRecommendations() {
            if (allProjects.length === 0) return [];
            
            const recommendations = [];
            const now = new Date();
            
            // 1. Urgent projects (D-7 or less)
            const urgentProjects = allProjects.filter(p => {
                if (!p.end_date || p.phase === 'completed') return false;
                const dday = calculateDDay(p.end_date);
                return dday !== null && dday <= 7 && dday >= 0;
            });
            
            urgentProjects.forEach(p => {
                recommendations.push({
                    project: p,
                    reason: 'ÎßàÍ∞ê ÏûÑÎ∞ï',
                    priority: 'high',
                    action: 'Ï¶âÏãú ÌôïÏù∏ ÌïÑÏöî',
                    icon: 'üö®'
                });
            });
            
            // 2. Budget overrun projects
            const overBudget = allProjects.filter(p => 
                p.budget_total > 0 && p.budget_used > p.budget_total
            );
            
            overBudget.forEach(p => {
                const overAmount = p.budget_used - p.budget_total;
                recommendations.push({
                    project: p,
                    reason: 'ÏòàÏÇ∞ Ï¥àÍ≥º',
                    priority: 'high',
                    action: `‚Ç©${(overAmount / 1000000).toFixed(1)}M Ï¥àÍ≥º`,
                    icon: 'üí∞'
                });
            });
            
            // 3. Stagnant projects (no update in 30 days)
            const thirtyDaysAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);
            const stagnant = allProjects.filter(p => {
                if (!p.updated_at || p.phase === 'completed') return false;
                const updated = new Date(p.updated_at);
                return updated < thirtyDaysAgo;
            });
            
            stagnant.forEach(p => {
                recommendations.push({
                    project: p,
                    reason: 'Ïû•Í∏∞ ÎØ∏ÏßÑÌñâ',
                    priority: 'medium',
                    action: 'ÏßÑÌñâ ÏÉÅÌÉú ÌôïÏù∏',
                    icon: '‚è∏Ô∏è'
                });
            });
            
            // 4. Ready to advance (planning phase with all info)
            const readyToAdvance = allProjects.filter(p => 
                p.phase === 'planning' && 
                p.budget_total > 0 && 
                p.start_date && 
                p.end_date &&
                p.curator
            );
            
            readyToAdvance.forEach(p => {
                recommendations.push({
                    project: p,
                    reason: 'Ï§ÄÎπÑ ÏôÑÎ£å',
                    priority: 'low',
                    action: 'Ï§ÄÎπÑ Îã®Í≥ÑÎ°ú Ïù¥Îèô Í∂åÏû•',
                    icon: '‚úÖ'
                });
            });
            
            return recommendations;
        }
        
        function showAIRecommendations() {
            const recommendations = getProjectRecommendations();
            
            if (recommendations.length === 0) {
                notificationSystem.showInAppNotification('ÌòÑÏû¨ Ï∂îÏ≤úÌï† Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§. üëç', 'success');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 3000; padding: 2rem; overflow-y: auto;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            
            const priorityColors = {
                high: { bg: 'rgba(239, 68, 68, 0.1)', border: 'rgba(239, 68, 68, 0.3)', text: '#f87171' },
                medium: { bg: 'rgba(245, 158, 11, 0.1)', border: 'rgba(245, 158, 11, 0.3)', text: '#fbbf24' },
                low: { bg: 'rgba(16, 185, 129, 0.1)', border: 'rgba(16, 185, 129, 0.3)', text: '#34d399' }
            };
            
            modal.innerHTML = `
                <div style="max-width: 1000px; margin: 0 auto; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 24px; padding: 2rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white;">
                            <i class="fas fa-robot" style="color: #8b5cf6;"></i>
                            AI ÌîÑÎ°úÏ†ùÌä∏ Ï∂îÏ≤ú
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 1.1rem; cursor: pointer; padding: 0.5rem;">&times;</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        Ï¥ù <strong style="color: white;">${recommendations.length}Í∞ú</strong> ÌîÑÎ°úÏ†ùÌä∏Ïóê ÎåÄÌïú Ï∂îÏ≤úÏÇ¨Ìï≠Ïù¥ ÏûàÏäµÎãàÎã§.
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        ${recommendations.map(rec => {
                            const color = priorityColors[rec.priority];
                            return `
                                <div style="background: ${color.bg}; border: 1px solid ${color.border}; border-radius: 12px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                            <span style="font-size: 1.4rem;">${rec.icon}</span>
                                            <div>
                                                <h3 style="color: white; font-size: 0.95rem; font-weight: 600;">${rec.project.title}</h3>
                                                <span style="background: rgba(139, 92, 246, 0.2); color: #a78bfa; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;">
                                                    ${rec.project.type}
                                                </span>
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 2rem; font-size: 0.875rem; color: rgba(255, 255, 255, 0.7);">
                                            <div>
                                                <i class="fas fa-exclamation-circle"></i>
                                                <strong style="color: ${color.text};">${rec.reason}</strong>
                                            </div>
                                            <div>
                                                <i class="fas fa-lightbulb"></i>
                                                ${rec.action}
                                            </div>
                                        </div>
                                    </div>
                                    <button onclick="window.location.href='/canvas-v3.html?project=${rec.project.id}'" style="background: linear-gradient(135deg, #8b5cf6, #ec4899); border: none; padding: 0.75rem 1.5rem; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; white-space: nowrap;">
                                        <i class="fas fa-arrow-right"></i> ÌôïÏù∏ÌïòÍ∏∞
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Open module-specific workflow canvas
        function openModuleCanvas(module) {
            console.log('üéØ Opening module canvas:', module);
            
            // Create a new project or use existing module project
            const moduleProjectId = localStorage.getItem(`module_project_${module}`);
            
            if (moduleProjectId) {
                // Open existing module project
                window.location.href = `/canvas-v3.html?project=${moduleProjectId}&module=${module}`;
            } else {
                // Create new module project workflow
                createModuleProject(module);
            }
        }
        
        // Create module-specific project
        async function createModuleProject(module) {
            const moduleNames = {
                'exhibition': 'Ï†ÑÏãú Í¥ÄÎ¶¨',
                'education': 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®',
                'archive': 'ÏàòÏßë & Î≥¥Ï°¥',
                'publication': 'Ï∂úÌåê & ÏΩòÌÖêÏ∏†',
                'research': 'Ïó∞Íµ¨ & Ï°∞ÏÇ¨',
                'admin': 'ÌñâÏ†ï & Ïö¥ÏòÅ'
            };
            
            const moduleDescriptions = {
                'exhibition': 'Ï†ÑÏãú Í∏∞ÌöçÎ∂ÄÌÑ∞ ÏÑ§Ïπò, Ïö¥ÏòÅ, ÌèâÍ∞ÄÍπåÏßÄÏùò Ï†ÑÏ≤¥ ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                'education': 'ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Í∞úÎ∞ú, Ïã§Ìñâ Î∞è ÌèâÍ∞Ä ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                'archive': 'Ïú†Î¨º ÏàòÏßë, Îì±Î°ù, Î≥¥Ï°¥ Î∞è Í¥ÄÎ¶¨ ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                'publication': 'ÎèÑÎ°ù, Îâ¥Ïä§Î†àÌÑ∞, ÎîîÏßÄÌÑ∏ ÏΩòÌÖêÏ∏† Ï†úÏûë ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                'research': 'ÌïôÏà† Ïó∞Íµ¨, ÌòÑÏû• Ï°∞ÏÇ¨ Î∞è Î≥¥Í≥†ÏÑú ÏûëÏÑ± ÏõåÌÅ¨ÌîåÎ°úÏö∞',
                'admin': 'ÏòàÏÇ∞, Ïù∏ÏÇ¨, ÏãúÏÑ§ Í¥ÄÎ¶¨ Î∞è Ï†ÑÎûµ Í∏∞Ìöç ÏõåÌÅ¨ÌîåÎ°úÏö∞'
            };
            
            const moduleTypes = {
                'exhibition': 'special',
                'education': 'event',
                'archive': 'permanent',
                'publication': 'event',
                'research': 'special',
                'admin': 'permanent'
            };
            
            try {
                const result = await window.apiClient.projects.create({
                    title: moduleNames[module],
                    description: moduleDescriptions[module],
                    type: moduleTypes[module],
                    phase: 'planning'
                });
                
                if (result.success && result.data) {
                    const projectId = result.data.id;
                    localStorage.setItem(`module_project_${module}`, projectId);
                    console.log(`‚úÖ Created module project:`, projectId);
                    
                    // Navigate to workflow with module parameter
                    window.location.href = `/canvas-v3.html?project=${projectId}&module=${module}`;
                } else {
                    throw new Error(result.error || 'Failed to create project');
                }
            } catch (error) {
                console.error('‚ùå Error creating module project:', error);
                console.error(`Î™®Îìà ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ± Ïã§Ìå®: ${error.message}`);
            }
        }
        
        // Modal functions
        function openCreateModal() {
            editingProjectId = null;
            const modal = document.getElementById('project-modal');
            if (!modal) {
                console.warn('ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ± Í∏∞Îä•ÏùÄ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.');
                return;
            }
            document.getElementById('modal-title').textContent = 'ÏÉà Ï†ÑÏãú ÎßåÎì§Í∏∞';
            document.getElementById('project-form').reset();
            modal.classList.add('active');
        }
        
        // Add event listeners for filters
        // Real-time Auto-refresh
        let autoRefreshInterval = null;
        
        function startAutoRefresh() {
            // Clear existing interval
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Auto-refresh every 30 seconds
            autoRefreshInterval = setInterval(async () => {
                console.log('üîÑ Auto-refreshing dashboard data...');
                try {
                    const response = await fetch(`${API_BASE_URL}/api/projects`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        allProjects = data.projects;
                        
                        // Silently update charts and stats
                        updateStats();
                        renderProjectsGrid();
                        renderMonthlyTrendChart();
                        renderTypeDistributionChart();
                        renderBudgetChart();
                        renderPhaseDistributionChart();
                        
                        console.log('‚úÖ Dashboard auto-refreshed');
                    }
                } catch (error) {
                    console.error('Auto-refresh failed:', error);
                }
            }, 30000); // 30 seconds
            
            console.log('‚úÖ Auto-refresh started (30s interval)');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const typeFilter = document.getElementById('type-filter');
            const phaseFilter = document.getElementById('phase-filter');
            const sortSelect = document.getElementById('sort-select');
            
            if (searchInput) searchInput.addEventListener('input', renderProjectsGrid);
            if (typeFilter) typeFilter.addEventListener('change', renderProjectsGrid);
            if (phaseFilter) phaseFilter.addEventListener('change', renderProjectsGrid);
            if (sortSelect) sortSelect.addEventListener('change', renderProjectsGrid);

            // Update saved search count on page load
            updateSavedSearchCount();
        });
    </script>
    
    <!-- Template Modal -->
    <div id="template-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 2000; padding: 2rem; overflow-y: auto;">
        <div style="max-width: 900px; margin: 0 auto; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 24px; padding: 2rem; border: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="font-size: 1rem; font-weight: 700; color: white;">üìã ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù</h2>
                <button onclick="closeTemplateModal()" style="background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 1.1rem; cursor: pointer; padding: 0.5rem;">&times;</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                <!-- Exhibition -->
                <div onclick="createProjectFromTemplate('exhibition')" style="background: rgba(139, 92, 246, 0.1); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(139, 92, 246, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(139, 92, 246, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üé®</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">Ï†ÑÏãú Í¥ÄÎ¶¨</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">Ï†ÑÏãú Í∏∞Ìöç, ÏÑ§Ïπò, Ïö¥ÏòÅ Î∞è ÌèâÍ∞Ä</p>
                </div>
                
                <!-- Education -->
                <div onclick="createProjectFromTemplate('education')" style="background: rgba(6, 182, 212, 0.1); border: 2px solid rgba(6, 182, 212, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(6, 182, 212, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(6, 182, 212, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéì</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû® Í∞úÎ∞ú Î∞è Ïã§Ìñâ</p>
                </div>
                
                <!-- Archive -->
                <div onclick="createProjectFromTemplate('archive')" style="background: rgba(16, 185, 129, 0.1); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(16, 185, 129, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(16, 185, 129, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üì¶</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">ÏàòÏßë & Î≥¥Ï°¥</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">Ïú†Î¨º ÏàòÏßë, Îì±Î°ù Î∞è Î≥¥Ï°¥</p>
                </div>
                
                <!-- Publication -->
                <div onclick="createProjectFromTemplate('publication')" style="background: rgba(245, 158, 11, 0.1); border: 2px solid rgba(245, 158, 11, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(245, 158, 11, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(245, 158, 11, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìö</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">Ï∂úÌåê & ÏΩòÌÖêÏ∏†</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÎèÑÎ°ù Î∞è ÏΩòÌÖêÏ∏† Ï†úÏûë</p>
                </div>
                
                <!-- Research -->
                <div onclick="createProjectFromTemplate('research')" style="background: rgba(236, 72, 153, 0.1); border: 2px solid rgba(236, 72, 153, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(236, 72, 153, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(236, 72, 153, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üî¨</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">Ïó∞Íµ¨ & Ï°∞ÏÇ¨</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÌïôÏà† Ïó∞Íµ¨ Î∞è Ï°∞ÏÇ¨</p>
                </div>
                
                <!-- Admin -->
                <div onclick="createProjectFromTemplate('admin')" style="background: rgba(99, 102, 241, 0.1); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(99, 102, 241, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(99, 102, 241, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üèõÔ∏è</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">ÌñâÏ†ï & Ïö¥ÏòÅ</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÏòàÏÇ∞, Ïù∏ÏÇ¨ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨</p>
                </div>

                <!-- Digital Archive -->
                <div onclick="createProjectFromTemplate('digital_archive')" style="background: rgba(20, 184, 166, 0.1); border: 2px solid rgba(20, 184, 166, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(20, 184, 166, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(20, 184, 166, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üíæ</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">ÎîîÏßÄÌÑ∏ ÏïÑÏπ¥Ïù¥Î∏å</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÏÜåÏû•Ìíà ÎîîÏßÄÌÑ∏Ìôî Î∞è DB Íµ¨Ï∂ï</p>
                </div>

                <!-- Marketing -->
                <div onclick="createProjectFromTemplate('marketing')" style="background: rgba(244, 63, 94, 0.1); border: 2px solid rgba(244, 63, 94, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(244, 63, 94, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(244, 63, 94, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üì¢</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">ÎßàÏºÄÌåÖ Ï∫†ÌéòÏù∏</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">Ï†ÑÏãú/ÌîÑÎ°úÍ∑∏Îû® ÌôçÎ≥¥ Î∞è ÎßàÏºÄÌåÖ</p>
                </div>

                <!-- Conservation -->
                <div onclick="createProjectFromTemplate('conservation')" style="background: rgba(139, 92, 246, 0.1); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(139, 92, 246, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(139, 92, 246, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üß™</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">Î≥¥Ï°¥Í≥ºÌïô</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">Ïú†Î¨º Î≥¥Ï°¥Ï≤òÎ¶¨ Î∞è Í≥ºÌïôÏ°∞ÏÇ¨</p>
                </div>

                <!-- Community -->
                <div onclick="createProjectFromTemplate('community')" style="background: rgba(6, 182, 212, 0.1); border: 2px solid rgba(6, 182, 212, 0.3); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='rgba(6, 182, 212, 0.6)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.borderColor='rgba(6, 182, 212, 0.3)'; this.style.transform='translateY(0)'">
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ü§ù</div>
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; color: white;">Ïª§ÎÆ§ÎãàÌã∞ ÌòëÎ†•</h3>
                    <p style="font-size: 0.875rem; color: rgba(255, 255, 255, 0.6);">ÏßÄÏó≠ÏÇ¨Ìöå Ïó∞Í≥Ñ ÌîÑÎ°úÍ∑∏Îû®</p>
                </div>
            </div>

            <!-- Custom Templates Section -->
            <div id="custom-templates-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1);"></div>
            
            <div style="margin-top: 2rem; text-align: center;">
                <button onclick="openCustomTemplateManager()" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; padding: 1rem 2rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-cog"></i>
                    Ïª§Ïä§ÌÖÄ ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨
                </button>
            </div>
        </div>
    </div>

    <!-- Project Edit Modal -->
    <div id="edit-project-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); z-index: 2000; padding: 2rem; overflow-y: auto;">
        <div style="max-width: 700px; margin: 0 auto; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 24px; padding: 2rem; border: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="font-size: 1rem; font-weight: 700; color: white;">‚úèÔ∏è ÌîÑÎ°úÏ†ùÌä∏ Ìé∏Ïßë</h2>
                <button onclick="closeEditModal()" style="background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 1.1rem; cursor: pointer; padding: 0.5rem;">&times;</button>
            </div>
            
            <form id="edit-project-form" style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- Title -->
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">ÌîÑÎ°úÏ†ùÌä∏ Ï†úÎ™© *</label>
                    <input type="text" id="edit-title" required style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white; font-size: 1rem;">
                </div>
                
                <!-- Description -->
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">ÏÑ§Î™Ö</label>
                    <textarea id="edit-description" rows="3" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white; font-size: 1rem; resize: vertical;"></textarea>
                </div>
                
                <!-- Type & Phase -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Ïú†Ìòï</label>
                        <select id="edit-type" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                            <option value="exhibition">Ï†ÑÏãú</option>
                            <option value="education">ÍµêÏú°</option>
                            <option value="archive">ÏàòÏßë/Î≥¥Ï°¥</option>
                            <option value="publication">Ï∂úÌåê</option>
                            <option value="research">Ïó∞Íµ¨</option>
                            <option value="admin">ÌñâÏ†ï</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Îã®Í≥Ñ</label>
                        <select id="edit-phase" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                            <option value="planning">Í∏∞Ìöç</option>
                            <option value="preparation">Ï§ÄÎπÑ</option>
                            <option value="execution">ÏßÑÌñâ</option>
                            <option value="marketing">ÌôçÎ≥¥</option>
                            <option value="completed">ÏôÑÎ£å</option>
                        </select>
                    </div>
                </div>
                
                <!-- Budget -->
                <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 1.5rem;">
                    <h3 style="font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; color: rgba(139, 92, 246, 1);">üí∞ ÏòàÏÇ∞ Ï†ïÎ≥¥</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Ï¥ù ÏòàÏÇ∞ (Ïõê)</label>
                            <input type="number" id="edit-budget-total" min="0" step="1000000" placeholder="50000000" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">ÏÇ¨Ïö© ÏòàÏÇ∞ (Ïõê)</label>
                            <input type="number" id="edit-budget-used" min="0" step="100000" placeholder="30000000" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                        </div>
                    </div>
                    <div id="budget-usage-indicator" style="margin-top: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: 8px; display: none;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="color: var(--text-secondary);">ÏòàÏÇ∞ ÏÇ¨Ïö©Î•†</span>
                            <span id="budget-usage-percent" style="font-weight: 700;"></span>
                        </div>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 100px; overflow: hidden;">
                            <div id="budget-usage-bar" style="height: 100%; border-radius: 100px; transition: width 0.3s, background 0.3s;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Dates -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">ÏãúÏûëÏùº</label>
                        <input type="date" id="edit-start-date" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Ï¢ÖÎ£åÏùº</label>
                        <input type="date" id="edit-end-date" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                    </div>
                </div>
                
                <!-- Curator & Location -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">ÌÅêÎ†àÏù¥ÌÑ∞</label>
                        <input type="text" id="edit-curator" placeholder="Îã¥ÎãπÏûê Ïù¥Î¶Ñ" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">Ïû•ÏÜå</label>
                        <input type="text" id="edit-location" placeholder="Ï†ÑÏãúÍ¥Ä, ÏúÑÏπò" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); padding: 0.75rem; border-radius: 12px; color: white;">
                    </div>
                </div>
                
                <!-- Actions -->
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="button" onclick="closeEditModal()" style="flex: 1; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: white; font-weight: 600; cursor: pointer;">Ï∑®ÏÜå</button>
                    <button type="submit" style="flex: 2; padding: 0.75rem; background: linear-gradient(135deg, #8b5cf6, #ec4899); border: none; border-radius: 12px; color: white; font-weight: 600; cursor: pointer;">Ï†ÄÏû•</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Additional JavaScript -->
    <script>
        // Template Modal Functions
        function openTemplateModal() {
            document.getElementById('template-modal').style.display = 'block';
        }
        
        function closeTemplateModal() {
            document.getElementById('template-modal').style.display = 'none';
        }
        
        function openNewProjectModal() {
            // Simple redirect to projects page with create action
            window.location.href = '/projects.html?action=create';
        }
        
        async function createProjectFromTemplate(templateId) {
            try {
                // Use Template Library
                const result = await window.templateLibrary.createFromTemplate(templateId);
                
                if (result.success && result.project) {
                    closeTemplateModal();
                    
                    // Sync to calendar
                    syncProjectToCalendar(result.project);
                    
                    // Redirect to Canvas V3
                    window.location.href = `/canvas-v3.html?project=${result.project.id}&module=${templateId}`;
                }
            } catch (error) {
                console.error('Error creating project from template:', error);
                if (window.showInAppNotification) {
                    window.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error');
                }
            }
        }

        // Custom Template Manager
        function openCustomTemplateManager() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 2rem; overflow-y: auto;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            const customTemplates = window.templateLibrary.customTemplates || {};
            const customTemplatesList = Object.values(customTemplates);

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 800px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1); max-height: 90vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-cog" style="color: #3b82f6;"></i>
                            Ïª§Ïä§ÌÖÄ ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        ÌòÑÏû¨ ${customTemplatesList.length}Í∞úÏùò Ïª§Ïä§ÌÖÄ ÌÖúÌîåÎ¶øÏù¥ ÏûàÏäµÎãàÎã§.
                    </p>

                    ${customTemplatesList.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem;">
                            ${customTemplatesList.map(template => `
                                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="font-size: 1.4rem;">${template.icon}</div>
                                        <div>
                                            <div style="color: white; font-weight: 600; font-size: 1.1rem;">${template.name}</div>
                                            <div style="color: var(--text-secondary); font-size: 0.875rem;">${template.description}</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="createProjectFromTemplate('${template.id}')" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; font-weight: 500;">
                                            <i class="fas fa-plus"></i> ÏÇ¨Ïö©
                                        </button>
                                        <button onclick="deleteCustomTemplate('${template.id}')" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; font-weight: 500;">
                                            <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.5);">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 0.75rem;"></i>
                            <p>ÏïÑÏßÅ Ïª§Ïä§ÌÖÄ ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§.</p>
                            <p style="font-size: 0.875rem;">ÌîÑÎ°úÏ†ùÌä∏Î•º ÌÖúÌîåÎ¶øÏúºÎ°ú Ï†ÄÏû•ÌïòÏó¨ Ïû¨ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî!</p>
                        </div>
                    `}

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <h3 style="color: white; font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem;">üí° ÌÖúÌîåÎ¶ø Ï†ÄÏû• Î∞©Î≤ï</h3>
                        <ol style="color: var(--text-secondary); line-height: 1.8; padding-left: 1.5rem;">
                            <li>ÌîÑÎ°úÏ†ùÌä∏ Ïπ¥ÎìúÏóêÏÑú <strong style="color: white;">"ÌÖúÌîåÎ¶øÏúºÎ°ú Ï†ÄÏû•"</strong> Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                            <li>ÌÖúÌîåÎ¶ø Ïù¥Î¶ÑÍ≥º ÏÑ§Î™Ö ÏûÖÎ†•</li>
                            <li>Ï†ÄÏû• ÌõÑ Ïù¥ ÌéòÏù¥ÏßÄÏóêÏÑú ÌôïÏù∏ Í∞ÄÎä•</li>
                        </ol>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function deleteCustomTemplate(templateId) {
            if (confirm('Ïù¥ ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                window.templateLibrary.deleteCustomTemplate(templateId);
                // Refresh modal
                document.querySelector('[style*="z-index: 10000"]')?.remove();
                openCustomTemplateManager();
            }
        }

        // Batch Operations
        function openBatchOperations() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 600px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-tasks" style="color: #8b5cf6;"></i>
                            ÏùºÍ¥Ñ ÏûëÏóÖ
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        ÌòÑÏû¨ ${allProjects.length}Í∞ú ÌîÑÎ°úÏ†ùÌä∏Î•º ÎåÄÏÉÅÏúºÎ°ú ÏùºÍ¥Ñ ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button onclick="batchUpdatePhase()" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-sync-alt" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">Îã®Í≥Ñ ÏùºÍ¥Ñ Î≥ÄÍ≤Ω</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Ïó¨Îü¨ ÌîÑÎ°úÏ†ùÌä∏Ïùò Îã®Í≥ÑÎ•º ÌïúÎ≤àÏóê Î≥ÄÍ≤Ω</div>
                            </div>
                        </button>

                        <button onclick="batchUpdateType()" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-tag" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">Ïú†Ìòï ÏùºÍ¥Ñ Î≥ÄÍ≤Ω</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Ïó¨Îü¨ ÌîÑÎ°úÏ†ùÌä∏Ïùò Ïú†ÌòïÏùÑ ÌïúÎ≤àÏóê Î≥ÄÍ≤Ω</div>
                            </div>
                        </button>

                        <button onclick="batchDeleteProjects()" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-trash-alt" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">ÌîÑÎ°úÏ†ùÌä∏ ÏùºÍ¥Ñ ÏÇ≠Ï†ú</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïúÎ≤àÏóê ÏÇ≠Ï†ú</div>
                            </div>
                        </button>

                        <button onclick="batchArchiveProjects()" style="background: linear-gradient(135deg, #f59e0b, #d97706); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-archive" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">ÌîÑÎ°úÏ†ùÌä∏ ÏùºÍ¥Ñ Î≥¥Í¥Ä</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏Î•º Î≥¥Í¥ÄÌï®ÏúºÎ°ú Ïù¥Îèô</div>
                            </div>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function batchUpdatePhase() {
            const phase = prompt('Î≥ÄÍ≤ΩÌï† Îã®Í≥ÑÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:\\n\\n- planning (Í∏∞Ìöç)\\n- preparation (Ï§ÄÎπÑ)\\n- execution (Ïã§Ìñâ)\\n- marketing (ÌôçÎ≥¥)\\n- completed (ÏôÑÎ£å)');
            
            if (!phase) return;
            
            const validPhases = ['planning', 'preparation', 'execution', 'marketing', 'completed'];
            if (!validPhases.includes(phase)) {
                console.warn('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Îã®Í≥ÑÏûÖÎãàÎã§.');
                return;
            }

            const confirmed = confirm(`Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏Ïùò Îã®Í≥ÑÎ•º "${phase}"(Ïúº)Î°ú Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            if (!confirmed) return;

            document.querySelector('[style*="z-index: 10000"]')?.remove();
            
            let success = 0;
            let failed = 0;

            for (const project of allProjects) {
                try {
                    await window.apiClient.projects.update(project.id, { phase });
                    success++;
                } catch (error) {
                    failed++;
                }
            }

            if (window.showInAppNotification) {
                window.showInAppNotification(
                    `‚úÖ ÏùºÍ¥Ñ Îã®Í≥Ñ Î≥ÄÍ≤Ω ÏôÑÎ£å: ${success}Í∞ú ÏÑ±Í≥µ, ${failed}Í∞ú Ïã§Ìå®`,
                    failed > 0 ? 'warning' : 'success'
                );
            }

            await loadProjects();
        }

        async function batchUpdateType() {
            const type = prompt('Î≥ÄÍ≤ΩÌï† Ïú†ÌòïÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:\\n\\n- exhibition (Ï†ÑÏãú)\\n- education (ÍµêÏú°)\\n- archive (ÏàòÏßë/Î≥¥Ï°¥)\\n- publication (Ï∂úÌåê)\\n- research (Ïó∞Íµ¨)\\n- admin (ÌñâÏ†ï)');
            
            if (!type) return;
            
            const validTypes = ['exhibition', 'education', 'archive', 'publication', 'research', 'admin'];
            if (!validTypes.includes(type)) {
                console.warn('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ïú†ÌòïÏûÖÎãàÎã§.');
                return;
            }

            const confirmed = confirm(`Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏Ïùò Ïú†ÌòïÏùÑ "${type}"(Ïúº)Î°ú Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`);
            if (!confirmed) return;

            document.querySelector('[style*="z-index: 10000"]')?.remove();
            
            let success = 0;
            let failed = 0;

            for (const project of allProjects) {
                try {
                    await window.apiClient.projects.update(project.id, { type });
                    success++;
                } catch (error) {
                    failed++;
                }
            }

            if (window.showInAppNotification) {
                window.showInAppNotification(
                    `‚úÖ ÏùºÍ¥Ñ Ïú†Ìòï Î≥ÄÍ≤Ω ÏôÑÎ£å: ${success}Í∞ú ÏÑ±Í≥µ, ${failed}Í∞ú Ïã§Ìå®`,
                    failed > 0 ? 'warning' : 'success'
                );
            }

            await loadProjects();
        }

        async function batchDeleteProjects() {
            const confirmed = confirm(`‚ö†Ô∏è Í≤ΩÍ≥†: ÏôÑÎ£åÎêú(completed) ÌîÑÎ°úÏ†ùÌä∏Î•º Î™®Îëê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\\n\\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!`);
            if (!confirmed) return;

            const doubleConfirm = confirm('Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Îã§Ïãú ÌïúÎ≤à ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
            if (!doubleConfirm) return;

            document.querySelector('[style*="z-index: 10000"]')?.remove();
            
            const completedProjects = allProjects.filter(p => p.phase === 'completed');
            
            if (completedProjects.length === 0) {
                if (window.showInAppNotification) {
                    window.showInAppNotification('ÏÇ≠Ï†úÌï† ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                }
                return;
            }

            let success = 0;
            let failed = 0;

            for (const project of completedProjects) {
                try {
                    await window.apiClient.projects.delete(project.id);
                    success++;
                } catch (error) {
                    failed++;
                }
            }

            if (window.showInAppNotification) {
                window.showInAppNotification(
                    `‚úÖ ÏùºÍ¥Ñ ÏÇ≠Ï†ú ÏôÑÎ£å: ${success}Í∞ú ÏÇ≠Ï†ú, ${failed}Í∞ú Ïã§Ìå®`,
                    failed > 0 ? 'warning' : 'success'
                );
            }

            await loadProjects();
        }

        async function batchArchiveProjects() {
            const confirmed = confirm('ÏôÑÎ£åÎêú(completed) ÌîÑÎ°úÏ†ùÌä∏Î•º Î™®Îëê Î≥¥Í¥ÄÌïòÏãúÍ≤†ÏäµÎãàÍπå?');
            if (!confirmed) return;

            document.querySelector('[style*="z-index: 10000"]')?.remove();
            
            const completedProjects = allProjects.filter(p => p.phase === 'completed');
            
            if (completedProjects.length === 0) {
                if (window.showInAppNotification) {
                    window.showInAppNotification('Î≥¥Í¥ÄÌï† ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                }
                return;
            }

            let success = 0;
            let failed = 0;

            for (const project of completedProjects) {
                try {
                    await window.apiClient.projects.update(project.id, { 
                        metadata: { 
                            ...project.metadata, 
                            archived: true,
                            archived_at: new Date().toISOString()
                        }
                    });
                    success++;
                } catch (error) {
                    failed++;
                }
            }

            if (window.showInAppNotification) {
                window.showInAppNotification(
                    `‚úÖ ÏùºÍ¥Ñ Î≥¥Í¥Ä ÏôÑÎ£å: ${success}Í∞ú Î≥¥Í¥Ä, ${failed}Í∞ú Ïã§Ìå®`,
                    failed > 0 ? 'warning' : 'success'
                );
            }

            await loadProjects();
        }

        // Save Project as Template
        async function saveAsTemplate(projectId) {
            const project = allProjects.find(p => p.id === projectId);
            
            if (!project) {
                if (window.showInAppNotification) {
                    window.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                }
                return;
            }

            // Open template save modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = \`
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 600px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-save" style="color: #10b981;"></i>
                            ÌÖúÌîåÎ¶øÏúºÎ°ú Ï†ÄÏû•
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        <strong style="color: white;">${project.title}</strong> ÌîÑÎ°úÏ†ùÌä∏Î•º ÌÖúÌîåÎ¶øÏúºÎ°ú Ï†ÄÏû•Ìï©ÎãàÎã§.
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.5rem;">
                                ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ <span style="color: #ef4444;">*</span>
                            </label>
                            <input id="template-name" type="text" value="${project.title} ÌÖúÌîåÎ¶ø" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 1rem;" placeholder="ÌÖúÌîåÎ¶ø Ïù¥Î¶Ñ ÏûÖÎ†•">
                        </div>

                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.5rem;">
                                ÌÖúÌîåÎ¶ø ÏÑ§Î™Ö <span style="color: #ef4444;">*</span>
                            </label>
                            <textarea id="template-description" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 1rem; min-height: 100px; resize: vertical;" placeholder="ÌÖúÌîåÎ¶ø ÏÑ§Î™Ö ÏûÖÎ†•">${project.description || ''}</textarea>
                        </div>

                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.5rem;">
                                ÌÖúÌîåÎ¶ø ÏïÑÏù¥ÏΩò
                            </label>
                            <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem;">
                                ${['üé®', 'üéì', 'üì¶', 'üìö', 'üî¨', 'üèõÔ∏è', 'üíæ', 'üì¢', 'üß™', 'ü§ù', 'üé≠', 'üìã', 'üåü', 'üí°', 'üöÄ', '‚ö°'].map(icon => \`
                                    <button onclick="selectTemplateIcon('\${icon}')" style="padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'; this.style.borderColor='rgba(139, 92, 246, 0.5)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.15)'">
                                        \${icon}
                                    </button>
                                \`).join('')}
                            </div>
                            <input type="hidden" id="template-icon" value="üìã">
                        </div>

                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.5rem;">
                                ÌÖúÌîåÎ¶ø ÏÉâÏÉÅ
                            </label>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem;">
                                ${['#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ec4899', '#6366f1'].map(color => \`
                                    <button onclick="selectTemplateColor('\${color}')" style="height: 3rem; background: \${color}; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"></button>
                                \`).join('')}
                            </div>
                            <input type="hidden" id="template-color" value="#6366f1">
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button onclick="confirmSaveTemplate(${projectId})" style="flex: 1; background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 1rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;">
                                <i class="fas fa-check"></i> Ï†ÄÏû•
                            </button>
                            <button onclick="this.closest('div').parentElement.remove()" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: none; padding: 1rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;">
                                <i class="fas fa-times"></i> Ï∑®ÏÜå
                            </button>
                        </div>
                    </div>
                </div>
            \`;
            document.body.appendChild(modal);
        }

        function selectTemplateIcon(icon) {
            document.getElementById('template-icon').value = icon;
            // Visual feedback
            document.querySelectorAll('[onclick^="selectTemplateIcon"]').forEach(btn => {
                btn.style.background = 'rgba(255, 255, 255, 0.05)';
                btn.style.borderColor = 'rgba(255, 255, 255, 0.15)';
            });
            event.target.style.background = 'rgba(139, 92, 246, 0.3)';
            event.target.style.borderColor = 'rgba(139, 92, 246, 0.6)';
        }

        function selectTemplateColor(color) {
            document.getElementById('template-color').value = color;
            // Visual feedback
            document.querySelectorAll('[onclick^="selectTemplateColor"]').forEach(btn => {
                btn.style.borderWidth = '2px';
            });
            event.target.style.borderWidth = '4px';
            event.target.style.borderColor = 'white';
        }

        async function confirmSaveTemplate(projectId) {
            const name = document.getElementById('template-name').value.trim();
            const description = document.getElementById('template-description').value.trim();
            const icon = document.getElementById('template-icon').value;
            const color = document.getElementById('template-color').value;

            if (!name || !description) {
                console.warn('ÌÖúÌîåÎ¶ø Ïù¥Î¶ÑÍ≥º ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const project = allProjects.find(p => p.id === projectId);
            if (!project) return;

            // Close modal
            document.querySelector('[style*="z-index: 10000"]')?.remove();

            // Save using TemplateLibrary
            const result = await window.templateLibrary.saveAsTemplate(project, {
                name,
                description,
                icon,
                color,
                tasks: [] // TODO: Fetch project tasks if needed
            });

            if (result.success) {
                // Show success notification
                if (window.showInAppNotification) {
                    window.showInAppNotification(
                        \`‚úÖ "\${name}" ÌÖúÌîåÎ¶øÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨ÏóêÏÑú ÌôïÏù∏ÌïòÏÑ∏Ïöî.\`,
                        'success'
                    );
                }
            }
        }

        // Search & Filter Functions
        function clearSearch() {
            document.getElementById('project-search').value = '';
            document.getElementById('clear-search').style.display = 'none';
            renderProjectsGrid();
        }

        function clearAllFilters() {
            document.getElementById('project-search').value = '';
            document.getElementById('type-filter').value = 'all';
            document.getElementById('phase-filter').value = 'all';
            document.getElementById('clear-search').style.display = 'none';
            document.getElementById('active-filters').style.display = 'none';
            renderProjectsGrid();
        }

        // Advanced Filter Modal
        function openAdvancedFilter() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 2rem;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = \`
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 700px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-filter" style="color: #8b5cf6;"></i>
                            Í≥†Í∏â ÌïÑÌÑ∞
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <!-- Date Range Filter -->
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.75rem;">
                                <i class="fas fa-calendar-alt"></i> ÎÇ†Ïßú Î≤îÏúÑ
                            </label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="display: block; color: rgba(255, 255, 255, 0.7); font-size: 0.875rem; margin-bottom: 0.5rem;">ÏãúÏûëÏùº</label>
                                    <input id="filter-start-date" type="date" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 0.875rem;">
                                </div>
                                <div>
                                    <label style="display: block; color: rgba(255, 255, 255, 0.7); font-size: 0.875rem; margin-bottom: 0.5rem;">Ï¢ÖÎ£åÏùº</label>
                                    <input id="filter-end-date" type="date" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 0.875rem;">
                                </div>
                            </div>
                        </div>

                        <!-- Keyword Filter -->
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.75rem;">
                                <i class="fas fa-tags"></i> ÌÇ§ÏõåÎìú (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)
                            </label>
                            <input id="filter-keywords" type="text" placeholder="Ïòà: Ï†ÑÏãú, ÍµêÏú°, Î≥¥Ï°¥" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 0.875rem;">
                        </div>

                        <!-- Curator Filter -->
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.75rem;">
                                <i class="fas fa-user-tie"></i> ÌÅêÎ†àÏù¥ÌÑ∞
                            </label>
                            <input id="filter-curator" type="text" placeholder="ÌÅêÎ†àÏù¥ÌÑ∞ Ïù¥Î¶Ñ" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 0.875rem;">
                        </div>

                        <!-- Location Filter -->
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.75rem;">
                                <i class="fas fa-map-marker-alt"></i> Ïû•ÏÜå
                            </label>
                            <input id="filter-location" type="text" placeholder="Ï†ÑÏãú Ïû•ÏÜå" style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: white; font-size: 0.875rem;">
                        </div>

                        <!-- Quick Presets -->
                        <div>
                            <label style="display: block; color: rgba(255, 255, 255, 0.9); font-weight: 600; margin-bottom: 0.75rem;">
                                <i class="fas fa-bolt"></i> Îπ†Î•∏ ÌïÑÌÑ∞
                            </label>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                                <button onclick="applyQuickFilter('this-week')" style="padding: 0.75rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; color: #60a5fa; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(59, 130, 246, 0.3)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.2)'">
                                    Ïù¥Î≤à Ï£º
                                </button>
                                <button onclick="applyQuickFilter('this-month')" style="padding: 0.75rem; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; color: #34d399; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(16, 185, 129, 0.3)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.2)'">
                                    Ïù¥Î≤à Îã¨
                                </button>
                                <button onclick="applyQuickFilter('urgent')" style="padding: 0.75rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; color: #f87171; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                                    Í∏¥Í∏â (D-7)
                                </button>
                                <button onclick="applyQuickFilter('overdue')" style="padding: 0.75rem; background: rgba(245, 158, 11, 0.2); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; color: #fbbf24; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.3)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.2)'">
                                    Í∏∞Ìïú Ï¥àÍ≥º
                                </button>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button onclick="saveCurrentSearch()" style="flex: 1; background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 1rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;">
                                <i class="fas fa-bookmark"></i> Í≤ÄÏÉâ Ï†ÄÏû•
                            </button>
                            <button onclick="applyAdvancedFilter()" style="flex: 1; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; padding: 1rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;">
                                <i class="fas fa-check"></i> Ï†ÅÏö©
                            </button>
                            <button onclick="resetAdvancedFilter()" style="flex: 1; background: rgba(255, 255, 255, 0.1); border: none; padding: 1rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; font-size: 1rem;">
                                <i class="fas fa-redo"></i> Ï¥àÍ∏∞Ìôî
                            </button>
                        </div>
                    </div>
                </div>
            \`;
            document.body.appendChild(modal);
        }

        function applyQuickFilter(preset) {
            const now = new Date();
            let startDate, endDate;

            switch(preset) {
                case 'this-week':
                    const dayOfWeek = now.getDay();
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - dayOfWeek);
                    endDate = new Date(now);
                    endDate.setDate(now.getDate() + (6 - dayOfWeek));
                    break;
                case 'this-month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                case 'urgent':
                    startDate = now;
                    endDate = new Date(now);
                    endDate.setDate(now.getDate() + 7);
                    break;
                case 'overdue':
                    startDate = new Date(2000, 0, 1);
                    endDate = new Date(now);
                    endDate.setDate(now.getDate() - 1);
                    break;
            }

            document.getElementById('filter-start-date').value = startDate.toISOString().split('T')[0];
            document.getElementById('filter-end-date').value = endDate.toISOString().split('T')[0];
        }

        function resetAdvancedFilter() {
            document.getElementById('filter-start-date').value = '';
            document.getElementById('filter-end-date').value = '';
            document.getElementById('filter-keywords').value = '';
            document.getElementById('filter-curator').value = '';
            document.getElementById('filter-location').value = '';
        }

        function applyAdvancedFilter() {
            // Close modal
            document.querySelector('[style*="z-index: 10000"]')?.remove();
            
            // Show notification
            if (window.showInAppNotification) {
                window.showInAppNotification('Í≥†Í∏â ÌïÑÌÑ∞Í∞Ä Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§. (Íµ¨ÌòÑ ÏòàÏ†ï)', 'info');
            }
        }

        // Save Current Search Function
        function saveCurrentSearch() {
            const searchName = prompt('Ï†ÄÏû•Ìï† Í≤ÄÏÉâ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
            if (!searchName || searchName.trim() === '') {
                return;
            }

            // Get current filter values
            const searchCriteria = {
                name: searchName.trim(),
                startDate: document.getElementById('filter-start-date')?.value || '',
                endDate: document.getElementById('filter-end-date')?.value || '',
                keywords: document.getElementById('filter-keywords')?.value || '',
                curator: document.getElementById('filter-curator')?.value || '',
                location: document.getElementById('filter-location')?.value || '',
                type: document.getElementById('type-filter')?.value || 'all',
                phase: document.getElementById('phase-filter')?.value || 'all',
                projectSearch: document.getElementById('project-search')?.value || '',
                createdAt: new Date().toISOString()
            };

            // Save using SavedSearches class
            if (window.savedSearches) {
                const result = window.savedSearches.saveSearch(searchCriteria, searchName.trim());
                if (result.success) {
                    // Close modal
                    document.querySelector('[style*="z-index: 10000"]')?.remove();
                    
                    // Show notification
                    if (window.showInAppNotification) {
                        window.showInAppNotification(`Í≤ÄÏÉâ "${searchName}"Ïù¥(Í∞Ä) Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! üîñ`, 'success');
                    }

                    // Update count
                    updateSavedSearchCount();
                }
            } else {
                console.error('SavedSearches manager not initialized');
                if (window.showInAppNotification) {
                    window.showInAppNotification('Í≤ÄÏÉâ Ï†ÄÏû• Ïã§Ìå®. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                }
            }
        }

        // Open Saved Searches Modal
        function openSavedSearches() {
            if (!window.savedSearches) {
                if (window.showInAppNotification) {
                    window.showInAppNotification('Ï†ÄÏû•Îêú Í≤ÄÏÉâ ÏãúÏä§ÌÖúÏù¥ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.', 'error');
                }
                return;
            }

            const searches = window.savedSearches.getAllSearches();
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 2rem;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            let searchListHTML = '';
            if (searches.length === 0) {
                searchListHTML = `
                    <div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.5);">
                        <i class="fas fa-bookmark" style="font-size: 3rem; margin-bottom: 0.75rem;"></i>
                        <p style="font-size: 0.95rem;">Ï†ÄÏû•Îêú Í≤ÄÏÉâÏù¥ ÏóÜÏäµÎãàÎã§.</p>
                        <p style="font-size: 0.875rem; margin-top: 0.5rem;">Í≤ÄÏÉâ Ï°∞Í±¥ÏùÑ ÏÑ§Ï†ïÌïú ÌõÑ "Í≤ÄÏÉâ Ï†ÄÏû•" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
                    </div>
                `;
            } else {
                searchListHTML = searches.map(search => {
                    const createdDate = new Date(search.createdAt).toLocaleDateString('ko-KR');
                    return `
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 1.25rem; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 0.75rem; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                                <div style="flex: 1;">
                                    <h3 style="color: white; font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem;">
                                        <i class="fas fa-bookmark" style="color: #10b981; margin-right: 0.5rem;"></i>
                                        ${search.name}
                                    </h3>
                                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.75rem; color: rgba(255, 255, 255, 0.6);">
                                        <span><i class="fas fa-calendar"></i> ${createdDate}</span>
                                        <span><i class="fas fa-chart-line"></i> ${search.usedCount}Ìöå ÏÇ¨Ïö©</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="loadSavedSearch('${search.id}')" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; font-size: 0.875rem; font-weight: 600;">
                                        <i class="fas fa-play"></i> Î∂àÎü¨Ïò§Í∏∞
                                    </button>
                                    <button onclick="deleteSavedSearch('${search.id}')" style="background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); padding: 0.5rem 1rem; border-radius: 8px; color: #f87171; cursor: pointer; font-size: 0.875rem; font-weight: 600;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; font-size: 0.75rem;">
                                ${search.data.type !== 'all' ? `<span style="background: rgba(59, 130, 246, 0.2); padding: 0.25rem 0.75rem; border-radius: 6px; color: #60a5fa;">Ïú†Ìòï: ${getTypeLabel(search.data.type)}</span>` : ''}
                                ${search.data.phase !== 'all' ? `<span style="background: rgba(139, 92, 246, 0.2); padding: 0.25rem 0.75rem; border-radius: 6px; color: #a78bfa;">Îã®Í≥Ñ: ${getPhaseLabel(search.data.phase)}</span>` : ''}
                                ${search.data.keywords ? `<span style="background: rgba(16, 185, 129, 0.2); padding: 0.25rem 0.75rem; border-radius: 6px; color: #34d399;">ÌÇ§ÏõåÎìú: ${search.data.keywords}</span>` : ''}
                                ${search.data.curator ? `<span style="background: rgba(245, 158, 11, 0.2); padding: 0.25rem 0.75rem; border-radius: 6px; color: #fbbf24;">ÌÅêÎ†àÏù¥ÌÑ∞: ${search.data.curator}</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-bookmark" style="color: #10b981;"></i>
                            Ï†ÄÏû•Îêú Í≤ÄÏÉâ (${searches.length})
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    ${searchListHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Load Saved Search (1-click)
        function loadSavedSearch(searchId) {
            if (!window.savedSearches) {
                return;
            }

            const result = window.savedSearches.loadSearch(searchId);
            if (result.success) {
                const search = result.search;
                const data = search.data;

                // Apply search criteria
                if (data.type) document.getElementById('type-filter').value = data.type;
                if (data.phase) document.getElementById('phase-filter').value = data.phase;
                if (data.projectSearch) document.getElementById('project-search').value = data.projectSearch;
                
                // Close modal
                document.querySelector('[style*="z-index: 10000"]')?.remove();

                // Render projects with filters
                renderProjectsGrid();

                // Show notification
                if (window.showInAppNotification) {
                    window.showInAppNotification(`"${search.name}" Í≤ÄÏÉâÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§! üéØ`, 'success');
                }
            }
        }

        // Delete Saved Search
        function deleteSavedSearch(searchId) {
            if (!window.savedSearches) {
                return;
            }

            if (!confirm('Ïù¥ Ï†ÄÏû•Îêú Í≤ÄÏÉâÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            const result = window.savedSearches.deleteSearch(searchId);
            if (result.success) {
                // Refresh modal
                document.querySelector('[style*="z-index: 10000"]')?.remove();
                openSavedSearches();
                
                // Update count
                updateSavedSearchCount();
            }
        }

        // Update Saved Search Count
        function updateSavedSearchCount() {
            if (window.savedSearches) {
                const count = window.savedSearches.getCount();
                const countElement = document.getElementById('saved-search-count');
                if (countElement) {
                    countElement.textContent = count;
                }
            }
        }

        // Helper functions for labels
        function getTypeLabel(type) {
            const labels = {
                exhibition: 'Ï†ÑÏãú',
                education: 'ÍµêÏú°',
                archive: 'ÏàòÏßë/Î≥¥Ï°¥',
                publication: 'Ï∂úÌåê',
                research: 'Ïó∞Íµ¨',
                admin: 'ÌñâÏ†ï'
            };
            return labels[type] || type;
        }

        function getPhaseLabel(phase) {
            const labels = {
                planning: 'Í∏∞Ìöç',
                preparation: 'Ï§ÄÎπÑ',
                execution: 'ÏßÑÌñâ',
                marketing: 'ÌôçÎ≥¥',
                completed: 'ÏôÑÎ£å'
            };
            return labels[phase] || phase;
        }

        // Timeline View System
        let currentView = 'grid';
        let timelineGrouped = false;

        function switchView(view) {
            currentView = view;
            
            const gridView = document.getElementById('projects-grid');
            const timelineView = document.getElementById('projects-timeline');
            const gridBtn = document.getElementById('grid-view-btn');
            const timelineBtn = document.getElementById('timeline-view-btn');

            if (view === 'grid') {
                gridView.style.display = 'grid';
                timelineView.style.display = 'none';
                gridBtn.style.background = 'linear-gradient(135deg, #06b6d4, #0891b2)';
                gridBtn.style.color = 'white';
                timelineBtn.style.background = 'rgba(255, 255, 255, 0.05)';
                timelineBtn.style.color = 'rgba(255, 255, 255, 0.7)';
            } else {
                gridView.style.display = 'none';
                timelineView.style.display = 'block';
                gridBtn.style.background = 'rgba(255, 255, 255, 0.05)';
                gridBtn.style.color = 'rgba(255, 255, 255, 0.7)';
                timelineBtn.style.background = 'linear-gradient(135deg, #06b6d4, #0891b2)';
                timelineBtn.style.color = 'white';
                
                // Render timeline
                renderTimeline();
            }
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            const countElement = document.getElementById('timeline-project-count');
            
            if (!allProjects || allProjects.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: rgba(255, 255, 255, 0.5);">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 0.75rem;"></i>
                        <p style="font-size: 0.95rem;">ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                `;
                countElement.textContent = '0';
                return;
            }

            // Filter projects with dates
            const projectsWithDates = allProjects.filter(p => p.start_date && p.end_date);
            countElement.textContent = projectsWithDates.length;

            if (projectsWithDates.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: rgba(255, 255, 255, 0.5);">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 0.75rem;"></i>
                        <p style="font-size: 0.95rem;">ÎÇ†ÏßúÍ∞Ä ÏÑ§Ï†ïÎêú ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                `;
                return;
            }

            // Sort by start date
            const sortedProjects = [...projectsWithDates].sort((a, b) => 
                new Date(a.start_date) - new Date(b.start_date)
            );

            // Calculate timeline range
            const startDates = sortedProjects.map(p => new Date(p.start_date));
            const endDates = sortedProjects.map(p => new Date(p.end_date));
            const minDate = new Date(Math.min(...startDates));
            const maxDate = new Date(Math.max(...endDates));
            
            // Add padding
            minDate.setDate(minDate.getDate() - 7);
            maxDate.setDate(maxDate.getDate() + 7);
            
            const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));

            // Group by type if enabled
            let groupedProjects = timelineGrouped ? groupProjectsByType(sortedProjects) : { all: sortedProjects };

            // Render timeline
            let html = '';

            // Header with months
            html += renderTimelineHeader(minDate, maxDate, totalDays);

            // Projects
            Object.entries(groupedProjects).forEach(([group, projects]) => {
                if (timelineGrouped) {
                    html += `
                        <div style="margin-top: 1.5rem; margin-bottom: 0.75rem;">
                            <h4 style="color: var(--text-primary); font-size: 0.875rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                ${getTypeLabel(group)} (${projects.length})
                            </h4>
                        </div>
                    `;
                }

                projects.forEach(project => {
                    html += renderTimelineItem(project, minDate, totalDays);
                });
            });

            container.innerHTML = html;
        }

        function renderTimelineHeader(minDate, maxDate, totalDays) {
            const months = [];
            const currentDate = new Date(minDate);
            
            while (currentDate <= maxDate) {
                const month = currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'short' });
                const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
                const width = (daysInMonth / totalDays) * 100;
                
                months.push({ month, width });
                currentDate.setMonth(currentDate.getMonth() + 1);
            }

            return `
                <div style="display: flex; border-bottom: 2px solid rgba(255, 255, 255, 0.1); padding-bottom: 0.5rem; margin-bottom: 0.75rem;">
                    <div style="width: 200px; flex-shrink: 0;"></div>
                    <div style="flex: 1; display: flex;">
                        ${months.map(m => `
                            <div style="flex: ${m.width}; text-align: center; color: rgba(255, 255, 255, 0.6); font-size: 0.75rem; font-weight: 600;">
                                ${m.month}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderTimelineItem(project, minDate, totalDays) {
            const startDate = new Date(project.start_date);
            const endDate = new Date(project.end_date);
            
            const startOffset = Math.ceil((startDate - minDate) / (1000 * 60 * 60 * 24));
            const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            
            const left = (startOffset / totalDays) * 100;
            const width = (duration / totalDays) * 100;

            const phaseColors = {
                planning: '#3b82f6',
                preparation: '#f59e0b',
                execution: '#10b981',
                marketing: '#8b5cf6',
                completed: '#6b7280'
            };

            const color = phaseColors[project.phase] || '#6b7280';

            return `
                <div style="display: flex; align-items: center; margin-bottom: 0.75rem; height: 50px;">
                    <div style="width: 200px; flex-shrink: 0; padding-right: 1rem;">
                        <div style="font-size: 0.875rem; font-weight: 600; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            ${project.title}
                        </div>
                        <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5);">
                            ${getPhaseLabel(project.phase)}
                        </div>
                    </div>
                    <div style="flex: 1; position: relative; height: 30px; background: rgba(255, 255, 255, 0.03); border-radius: 6px;">
                        <div onclick="openCanvas('${project.id}')" style="position: absolute; left: ${left}%; width: ${width}%; height: 100%; background: linear-gradient(135deg, ${color}, ${color}cc); border-radius: 6px; cursor: pointer; display: flex; align-items: center; padding: 0 0.75rem; transition: all 0.3s; border: 1px solid ${color};" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <span style="font-size: 0.75rem; color: white; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                ${duration}Ïùº
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function groupProjectsByType(projects) {
            return projects.reduce((acc, project) => {
                const type = project.type || 'unknown';
                if (!acc[type]) acc[type] = [];
                acc[type].push(project);
                return acc;
            }, {});
        }

        function toggleTimelineGroups() {
            timelineGrouped = !timelineGrouped;
            renderTimeline();
            
            if (window.showInAppNotification) {
                window.showInAppNotification(
                    timelineGrouped ? 'Ïú†ÌòïÎ≥Ñ Í∑∏Î£πÌôîÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§.' : 'Í∑∏Î£πÌôîÍ∞Ä Ìï¥Ï†úÎêòÏóàÏäµÎãàÎã§.',
                    'info'
                );
            }
        }

        // Dashboard Customization
        let dashboardSettings = {
            showStats: true,
            showAnalytics: true,
            showProjects: true
        };

        function loadDashboardSettings() {
            const saved = localStorage.getItem('museflow_dashboard_settings');
            if (saved) {
                dashboardSettings = { ...dashboardSettings, ...JSON.parse(saved) };
            }
            applyDashboardSettings();
        }

        function saveDashboardSettings() {
            localStorage.setItem('museflow_dashboard_settings', JSON.stringify(dashboardSettings));
        }

        function applyDashboardSettings() {
            const statsSection = document.querySelector('.section-stats');
            const analyticsSection = document.querySelector('.section-analytics');
            const projectsSection = document.querySelector('.section-projects');
            
            if (statsSection) statsSection.style.display = dashboardSettings.showStats ? 'block' : 'none';
            if (analyticsSection) analyticsSection.style.display = dashboardSettings.showAnalytics ? 'block' : 'none';
            if (projectsSection) projectsSection.style.display = dashboardSettings.showProjects ? 'block' : 'none';
        }

        function openDashboardSettings() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 500px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-sliders-h" style="color: #8b5cf6;"></i>
                            ÎåÄÏãúÎ≥¥Îìú ÏÑ§Ï†ï
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; cursor: pointer;" onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <input type="checkbox" id="toggle-stats" ${dashboardSettings.showStats ? 'checked' : ''} onchange="toggleWidget('showStats', this.checked)" style="width: 20px; height: 20px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="color: white; font-weight: 600; margin-bottom: 0.25rem;">ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô©</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">ÌÜµÍ≥Ñ Ïπ¥Îìú ÌëúÏãú</div>
                            </div>
                        </label>

                        <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; cursor: pointer;" onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <input type="checkbox" id="toggle-analytics" ${dashboardSettings.showAnalytics ? 'checked' : ''} onchange="toggleWidget('showAnalytics', this.checked)" style="width: 20px; height: 20px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="color: white; font-weight: 600; margin-bottom: 0.25rem;">ÌîÑÎ°úÏ†ùÌä∏ Î∂ÑÏÑù</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Ï∞®Ìä∏ Î∞è Î∂ÑÏÑù ÌëúÏãú</div>
                            </div>
                        </label>

                        <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; cursor: pointer;" onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'">
                            <input type="checkbox" id="toggle-projects" ${dashboardSettings.showProjects ? 'checked' : ''} onchange="toggleWidget('showProjects', this.checked)" style="width: 20px; height: 20px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="color: white; font-weight: 600; margin-bottom: 0.25rem;">ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÌëúÏãú</div>
                            </div>
                        </label>
                    </div>

                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <button onclick="resetDashboard()" style="width: 100%; padding: 1rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; color: #f87171; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            <i class="fas fa-redo"></i> Í∏∞Î≥∏ ÏÑ§Ï†ïÏúºÎ°ú Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function toggleWidget(key, value) {
            dashboardSettings[key] = value;
            saveDashboardSettings();
            applyDashboardSettings();
            
            if (window.showInAppNotification) {
                window.showInAppNotification(
                    value ? 'ÏúÑÏ†ØÏù¥ ÌëúÏãúÎê©ÎãàÎã§.' : 'ÏúÑÏ†ØÏù¥ Ïà®Í≤®Ï°åÏäµÎãàÎã§.',
                    'success'
                );
            }
        }

        function resetDashboard() {
            dashboardSettings = { showStats: true, showAnalytics: true, showProjects: true };
            saveDashboardSettings();
            applyDashboardSettings();
            
            // Update checkboxes
            document.getElementById('toggle-stats').checked = true;
            document.getElementById('toggle-analytics').checked = true;
            document.getElementById('toggle-projects').checked = true;
            
            if (window.showInAppNotification) {
                window.showInAppNotification('ÎåÄÏãúÎ≥¥ÎìúÍ∞Ä Í∏∞Î≥∏ ÏÑ§Ï†ïÏúºÎ°ú Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
        }

        // Notification System
        let notifications = [];

        function initNotificationSystem() {
            // Load notifications from localStorage
            const saved = localStorage.getItem('museflow_notifications');
            notifications = saved ? JSON.parse(saved) : [];
            
            // Generate notifications for upcoming deadlines
            generateDeadlineNotifications();
            
            // Update badge
            updateNotificationBadge();
        }

        function generateDeadlineNotifications() {
            if (!allProjects || allProjects.length === 0) return;

            const today = new Date();
            const upcoming = allProjects.filter(p => {
                if (!p.end_date || p.phase === 'completed') return false;
                const endDate = new Date(p.end_date);
                const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return daysLeft >= 0 && daysLeft <= 7;
            });

            upcoming.forEach(project => {
                const endDate = new Date(project.end_date);
                const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                
                // Check if notification already exists
                const exists = notifications.some(n => 
                    n.type === 'deadline' && n.projectId === project.id
                );

                if (!exists) {
                    addNotification({
                        type: 'deadline',
                        projectId: project.id,
                        title: 'ÎßàÍ∞êÏùº ÏûÑÎ∞ï',
                        message: `"${project.title}" ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ${daysLeft}Ïùº ÎÇ®ÏïòÏäµÎãàÎã§.`,
                        timestamp: new Date().toISOString(),
                        read: false,
                        priority: daysLeft <= 3 ? 'high' : 'medium'
                    });
                }
            });
        }

        function addNotification(notification) {
            notifications.unshift(notification);
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            saveNotifications();
            updateNotificationBadge();
        }

        function saveNotifications() {
            localStorage.setItem('museflow_notifications', JSON.stringify(notifications));
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notification-badge');
            
            if (badge) {
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function openNotificationCenter() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; overflow-y: auto; padding: 2rem;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            let notificationHTML = '';
            if (notifications.length === 0) {
                notificationHTML = `
                    <div style="text-align: center; padding: 4rem; color: rgba(255, 255, 255, 0.5);">
                        <i class="fas fa-bell-slash" style="font-size: 3rem; margin-bottom: 0.75rem;"></i>
                        <p style="font-size: 0.95rem;">ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§.</p>
                    </div>
                `;
            } else {
                notificationHTML = notifications.map((notif, index) => {
                    const icon = notif.type === 'deadline' ? 'calendar-times' : 
                                 notif.type === 'update' ? 'sync' : 'bell';
                    const color = notif.priority === 'high' ? '#ef4444' : 
                                  notif.priority === 'medium' ? '#f59e0b' : '#6b7280';
                    const date = new Date(notif.timestamp).toLocaleDateString('ko-KR', {
                        month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                    });

                    return `
                        <div onclick="markAsRead(${index})" style="background: ${notif.read ? 'rgba(255, 255, 255, 0.03)' : 'rgba(139, 92, 246, 0.1)'}; border: 1px solid ${notif.read ? 'rgba(255, 255, 255, 0.1)' : 'rgba(139, 92, 246, 0.3)'}; border-radius: 12px; padding: 1.25rem; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.08)'" onmouseout="this.style.background='${notif.read ? 'rgba(255, 255, 255, 0.03)' : 'rgba(139, 92, 246, 0.1)'}'">
                            <div style="display: flex; gap: 1rem;">
                                <div style="flex-shrink: 0;">
                                    <i class="fas fa-${icon}" style="font-size: 1.1rem; color: ${color};"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                        <h4 style="color: white; font-weight: 600; font-size: 1rem;">${notif.title}</h4>
                                        <span style="color: var(--text-tertiary); font-size: 0.75rem; white-space: nowrap; margin-left: 1rem;">${date}</span>
                                    </div>
                                    <p style="color: var(--text-primary); font-size: 0.875rem; line-height: 1.5;">${notif.message}</p>
                                    ${!notif.read ? '<span style="display: inline-block; margin-top: 0.5rem; padding: 0.25rem 0.75rem; background: rgba(139, 92, 246, 0.2); color: #a78bfa; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">ÏÉà ÏïåÎ¶º</span>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-bell" style="color: #8b5cf6;"></i>
                            ÏïåÎ¶º ÏÑºÌÑ∞ (${notifications.length})
                        </h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="markAllAsRead()" style="background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3); padding: 0.5rem 1rem; border-radius: 8px; color: #a78bfa; cursor: pointer; font-size: 0.875rem; font-weight: 600;">
                                <i class="fas fa-check-double"></i> Î™®Îëê ÏùΩÏùå
                            </button>
                            <button onclick="this.closest('div').parentElement.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                        </div>
                    </div>
                    ${notificationHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function markAsRead(index) {
            if (notifications[index]) {
                notifications[index].read = true;
                saveNotifications();
                updateNotificationBadge();
                
                // Close and reopen modal to refresh
                document.querySelector('[style*="z-index: 10000"]')?.remove();
                openNotificationCenter();
            }
        }

        function markAllAsRead() {
            notifications.forEach(n => n.read = true);
            saveNotifications();
            updateNotificationBadge();
            
            // Close and reopen modal to refresh
            document.querySelector('[style*="z-index: 10000"]')?.remove();
            openNotificationCenter();
            
            if (window.showInAppNotification) {
                window.showInAppNotification('Î™®Îì† ÏïåÎ¶ºÏùÑ ÏùΩÏùåÏúºÎ°ú ÌëúÏãúÌñàÏäµÎãàÎã§.', 'success');
            }
        }

        // Advanced Analytics System
        let analyticsCharts = {};

        function renderAnalyticsKPIs() {
            if (!allProjects || allProjects.length === 0) return;

            // Completion Rate
            const completedProjects = allProjects.filter(p => p.phase === 'completed').length;
            const completionRate = ((completedProjects / allProjects.length) * 100).toFixed(1);
            document.getElementById('completion-rate').textContent = `${completionRate}%`;

            // Average Duration
            const projectsWithDates = allProjects.filter(p => p.start_date && p.end_date);
            if (projectsWithDates.length > 0) {
                const totalDuration = projectsWithDates.reduce((sum, p) => {
                    const start = new Date(p.start_date);
                    const end = new Date(p.end_date);
                    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
                    return sum + days;
                }, 0);
                const avgDuration = Math.round(totalDuration / projectsWithDates.length);
                document.getElementById('avg-duration').textContent = `${avgDuration}Ïùº`;
            }

            // Active Projects
            const activeProjects = allProjects.filter(p => {
                if (!p.end_date) return true;
                return new Date(p.end_date) >= new Date();
            }).length;
            document.getElementById('active-projects').textContent = activeProjects;

            // This Month's Projects
            const thisMonth = new Date();
            const thisMonthProjects = allProjects.filter(p => {
                if (!p.created_at && !p.start_date) return false;
                const projectDate = new Date(p.created_at || p.start_date);
                return projectDate.getMonth() === thisMonth.getMonth() && 
                       projectDate.getFullYear() === thisMonth.getFullYear();
            }).length;
            document.getElementById('this-month-count').textContent = thisMonthProjects;
        }

        function renderAnalyticsMonthlyTrend() {
            const canvas = document.getElementById('monthly-trend-chart');
            if (!canvas || !allProjects || allProjects.length === 0) return;

            // Destroy existing chart
            if (analyticsCharts.monthlyTrend) {
                analyticsCharts.monthlyTrend.destroy();
            }

            // Get last 6 months
            const months = [];
            const counts = [];
            const today = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthName = date.toLocaleDateString('ko-KR', { month: 'short' });
                months.push(monthName);
                
                const count = allProjects.filter(p => {
                    const projectDate = new Date(p.created_at || p.start_date);
                    return projectDate.getMonth() === date.getMonth() && 
                           projectDate.getFullYear() === date.getFullYear();
                }).length;
                counts.push(count);
            }

            const ctx = canvas.getContext('2d');
            analyticsCharts.monthlyTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'ÌîÑÎ°úÏ†ùÌä∏ Ïàò',
                        data: counts,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function renderAnalyticsTypeDistribution() {
            const canvas = document.getElementById('type-distribution-chart');
            if (!canvas || !allProjects || allProjects.length === 0) return;

            // Destroy existing chart
            if (analyticsCharts.typeDistribution) {
                analyticsCharts.typeDistribution.destroy();
            }

            const typeCounts = {};
            allProjects.forEach(p => {
                const type = p.type || 'unknown';
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });

            const labels = Object.keys(typeCounts).map(type => getTypeLabel(type));
            const data = Object.values(typeCounts);
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444', '#06b6d4'];

            const ctx = canvas.getContext('2d');
            analyticsCharts.typeDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#1a1a2e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff', padding: 15 }
                        }
                    }
                }
            });
        }

        function renderAnalyticsPhaseProgress() {
            const canvas = document.getElementById('phase-progress-chart');
            if (!canvas || !allProjects || allProjects.length === 0) return;

            // Destroy existing chart
            if (analyticsCharts.phaseProgress) {
                analyticsCharts.phaseProgress.destroy();
            }

            const phaseCounts = {};
            allProjects.forEach(p => {
                const phase = p.phase || 'unknown';
                phaseCounts[phase] = (phaseCounts[phase] || 0) + 1;
            });

            const labels = Object.keys(phaseCounts).map(phase => getPhaseLabel(phase));
            const data = Object.values(phaseCounts);
            const colors = ['#3b82f6', '#f59e0b', '#10b981', '#8b5cf6', '#6b7280'];

            const ctx = canvas.getContext('2d');
            analyticsCharts.phaseProgress = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÌîÑÎ°úÏ†ùÌä∏ Ïàò',
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1,
                        borderColor: '#1a1a2e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function renderAnalyticsTimelineStatus() {
            const canvas = document.getElementById('timeline-status-chart');
            if (!canvas || !allProjects || allProjects.length === 0) return;

            // Destroy existing chart
            if (analyticsCharts.timelineStatus) {
                analyticsCharts.timelineStatus.destroy();
            }

            const today = new Date();
            let onTime = 0;
            let delayed = 0;
            let completed = 0;
            let noDates = 0;

            allProjects.forEach(p => {
                if (p.phase === 'completed') {
                    completed++;
                } else if (!p.end_date) {
                    noDates++;
                } else {
                    const endDate = new Date(p.end_date);
                    if (endDate >= today) {
                        onTime++;
                    } else {
                        delayed++;
                    }
                }
            });

            const ctx = canvas.getContext('2d');
            analyticsCharts.timelineStatus = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Ï†ïÏÉÅ ÏßÑÌñâ', 'ÏßÄÏó∞', 'ÏôÑÎ£å', 'ÎÇ†Ïßú ÎØ∏ÏÑ§Ï†ï'],
                    datasets: [{
                        data: [onTime, delayed, completed, noDates],
                        backgroundColor: ['#10b981', '#ef4444', '#6b7280', '#94a3b8'],
                        borderWidth: 2,
                        borderColor: '#1a1a2e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff', padding: 15 }
                        }
                    }
                }
            });
        }
        
        // Google Calendar Sync
        // Google Calendar Integration
        let googleCalendarEnabled = false;
        let gapi = null;
        let tokenClient = null;
        
        function syncGoogleCalendar() {
            // Check if Google API is loaded
            if (typeof window.gapi === 'undefined') {
                // Load Google API dynamically
                loadGoogleAPI();
                return;
            }
            
            // Authenticate and sync
            authenticateGoogleCalendar();
        }
        
        function loadGoogleAPI() {
            notificationSystem.showInAppNotification('Google Calendar API Î°úÎî© Ï§ë...', 'info');
            
            // Load Google API script
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = () => {
                const script2 = document.createElement('script');
                script2.src = 'https://accounts.google.com/gsi/client';
                script2.onload = () => {
                    initGoogleCalendarAPI();
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script);
        }
        
        function initGoogleCalendarAPI() {
            gapi = window.gapi;
            
            gapi.load('client', async () => {
                try {
                    // Note: API key should be set in environment variables
                    // For demo, we'll show the setup instructions
                    notificationSystem.showInAppNotification(
                        'Google Calendar Ïó∞ÎèôÏùÑ ÏúÑÌï¥ Í¥ÄÎ¶¨ÏûêÏóêÍ≤å API ÌÇ§ ÏÑ§Ï†ïÏùÑ ÏöîÏ≤≠ÌïòÏÑ∏Ïöî. üìÖ', 
                        'warning'
                    );
                    
                    // TODO: Actual implementation with API key
                    // await gapi.client.init({
                    //     apiKey: 'YOUR_API_KEY',
                    //     discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest']
                    // });
                    
                } catch (error) {
                    console.error('Google Calendar API Ï¥àÍ∏∞Ìôî Ïã§Ìå®:', error);
                    notificationSystem.showInAppNotification('Google Calendar Ïó∞Îèô Ïã§Ìå®', 'error');
                }
            });
        }
        
        function authenticateGoogleCalendar() {
            // For now, sync to FullCalendar with local data
            syncToFullCalendar();
        }
        
        function syncToFullCalendar() {
            notificationSystem.showInAppNotification('ÌîÑÎ°úÏ†ùÌä∏Î•º Ï∫òÎ¶∞ÎçîÏóê ÎèôÍ∏∞ÌôîÌñàÏäµÎãàÎã§! üìÖ', 'success');
            
            // Refresh calendar
            if (calendar) {
                calendar.refetchEvents();
            }
            
            // Enable Google Calendar view
            googleCalendarEnabled = true;
        }
        
        function syncProjectToCalendar(project) {
            // Auto-sync project to calendar when created/updated
            if (calendar) {
                calendar.refetchEvents();
                console.log('‚úÖ Project synced to calendar:', project.title);
            }
        }
        
        // Initialize FullCalendar
        let calendar;
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (!calendarEl) return;
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                height: 600,
                themeSystem: 'standard',
                events: function(info, successCallback, failureCallback) {
                    // Convert projects to calendar events
                    const events = allProjects.map(project => ({
                        title: project.title,
                        start: project.start_date,
                        end: project.end_date,
                        backgroundColor: getPhaseColor(project.phase),
                        borderColor: getPhaseColor(project.phase),
                        url: `/canvas-v3.html?project=${project.id}`
                    })).filter(e => e.start || e.end);
                    
                    successCallback(events);
                },
                eventClick: function(info) {
                    info.jsEvent.preventDefault();
                    if (info.event.url) {
                        window.location.href = info.event.url;
                    }
                }
            });
            
            calendar.render();
        }
        
        function getPhaseColor(phase) {
            const colors = {
                planning: '#8b5cf6',
                preparation: '#06b6d4',
                execution: '#10b981',
                marketing: '#f59e0b',
                completed: '#6366f1'
            };
            return colors[phase] || '#8b5cf6';
        }
        
        // Integrate urgent alerts into hero section
        function renderHeroMission() {
            const urgent = allProjects
                .filter(p => p.status === 'active')
                .map(p => ({...p, dday: calculateDDay(p.end_date)}))
                .filter(p => p.dday !== null && p.dday >= 0)
                .sort((a, b) => a.dday - b.dday)[0];
            
            const missionTitle = document.getElementById('mission-title');
            const missionDday = document.getElementById('mission-dday');
            const missionProgress = document.getElementById('mission-progress');
            const missionStats = document.getElementById('mission-stats');
            
            if (urgent) {
                missionTitle.textContent = urgent.title;
                
                let ddayColor = '#10b981';
                if (urgent.dday <= 7) ddayColor = '#ef4444';
                else if (urgent.dday <= 14) ddayColor = '#f59e0b';
                
                missionDday.innerHTML = `<div class="dday-counter" style="background: ${ddayColor}; color: white; padding: 0.5rem 1rem; border-radius: 12px; display: inline-block; font-weight: 600; font-size: 1rem; animation: pulse 2s infinite;">D-${urgent.dday}</div>`;
                
                // Progress ring
                const phaseProgress = {
                    planning: 20,
                    preparation: 40,
                    execution: 60,
                    marketing: 80,
                    completed: 100
                };
                const progress = phaseProgress[urgent.phase] || 20;
                
                missionProgress.innerHTML = `
                    <svg width="120" height="120">
                        <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                        <circle cx="60" cy="60" r="54" fill="none" stroke="#8b5cf6" stroke-width="8" 
                                stroke-dasharray="${2 * Math.PI * 54}" 
                                stroke-dashoffset="${2 * Math.PI * 54 * (1 - progress / 100)}"
                                transform="rotate(-90 60 60)"
                                style="transition: stroke-dashoffset 1s ease;"/>
                        <text x="60" y="60" text-anchor="middle" dominant-baseline="middle" fill="white" font-size="24" font-weight="700">${progress}%</text>
                    </svg>
                `;
                
                missionStats.innerHTML = `
                    <div style="margin-bottom: 0.5rem;">üìç ${urgent.location || 'ÏúÑÏπò ÎØ∏Ï†ï'}</div>
                    <div style="margin-bottom: 0.5rem;">üë§ ${urgent.curator || 'Îã¥ÎãπÏûê ÎØ∏Ï†ï'}</div>
                    <div>üìÖ ${urgent.start_date || 'ÏãúÏûëÏùº ÎØ∏Ï†ï'}</div>
                `;
                
                // Render top 3 urgent alerts inline
                renderUrgentAlertsInline();
            } else {
                missionTitle.textContent = 'ÏßÑÌñâ Ï§ëÏù∏ Í∏¥Í∏â ÏóÖÎ¨¥Í∞Ä ÏóÜÏäµÎãàÎã§';
                missionDday.innerHTML = '';
                missionProgress.innerHTML = '<div style="font-size: 4rem; opacity: 0.3;">‚úÖ</div>';
                missionStats.innerHTML = '<div>Î™®Îì† ÏóÖÎ¨¥Í∞Ä ÏàúÏ°∞Î°≠Í≤å ÏßÑÌñâ Ï§ëÏûÖÎãàÎã§!</div>';
            }
        }
        
        function renderUrgentAlertsInline() {
            const urgentAlerts = allProjects
                .filter(p => p.status === 'active')
                .map(p => ({...p, dday: calculateDDay(p.end_date)}))
                .filter(p => p.dday !== null && p.dday >= 0 && p.dday <= 7)
                .sort((a, b) => a.dday - b.dday)
                .slice(0, 3);
            
            const container = document.getElementById('urgent-alerts-inline');
            
            if (urgentAlerts.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = `
                <div style="font-size: 0.875rem; font-weight: 600; color: rgba(255, 255, 255, 0.8); margin-bottom: 0.75rem;">
                    <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> Í∏¥Í∏â ÏïåÎ¶º
                </div>
                ${urgentAlerts.map(alert => `
                    <div style="background: rgba(239, 68, 68, 0.1); border-left: 3px solid #ef4444; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                        <div style="font-size: 0.875rem; font-weight: 600; color: white; margin-bottom: 0.25rem;">${alert.title}</div>
                        <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6);">D-${alert.dday} ‚Ä¢ ${alert.type || 'Ï†ÑÏãú'}</div>
                    </div>
                `).join('')}
            `;
        }
    </script>

    <!-- Floating Action Button -->
    <script src="/static/js/components/floating-action.js"></script>
    
    <!-- Mobile Navigation -->
    <script src="/static/js/components/mobile-nav.js"></script>
    
    <!-- API Client -->
    <script src="/static/js/api-client-d1.js"></script>
    
    <!-- Export/Import System -->
    <script src="/static/js/components/export-import-system.js"></script>
    
    <!-- Template Library -->
    <script src="/static/js/components/template-library.js"></script>
    
    <!-- Saved Searches System -->
    <script src="/static/js/components/saved-searches.js"></script>
    
    <!-- Collaboration System -->
    <script src="/static/js/collaboration-system.js"></script>
    
    <!-- AI Assistant -->
    <script>
        function openAIAssistant() {
            // Open AI Assistant modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(10, 10, 15, 0.98);
                backdrop-filter: blur(20px);
                padding: 2rem;
                border-radius: 20px;
                border: 1px solid rgba(139, 92, 246, 0.3);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                z-index: 10000;
                max-width: 600px;
                width: 90%;
                color: white;
            `;
            modal.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <h2 style="font-size: 1.1rem; font-weight: 700; background: linear-gradient(135deg, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="fas fa-magic"></i> AI Assistant
                    </h2>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="margin-bottom: 0.75rem;">
                    <p style="color: var(--text-primary); line-height: 1.6;">
                        AI Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º ÏµúÏ†ÅÌôîÌïòÍ≥† ÏûëÏóÖÏùÑ ÏûêÎèôÌôîÌïòÏÑ∏Ïöî.
                    </p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <a href="/ai-assistant-demo.html" style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem; padding: 1.5rem; background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s;" onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.background='rgba(139, 92, 246, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-robot" style="font-size: 1.4rem; color: #8b5cf6;"></i>
                        <span style="font-weight: 600;">AI Chat</span>
                    </a>
                    <a href="/canvas-v3.html" style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem; padding: 1.5rem; background: rgba(236, 72, 153, 0.1); border: 1px solid rgba(236, 72, 153, 0.3); border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s;" onmouseover="this.style.background='rgba(236, 72, 153, 0.2)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.background='rgba(236, 72, 153, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-project-diagram" style="font-size: 1.4rem; color: #ec4899;"></i>
                        <span style="font-weight: 600;">Workflow Gen</span>
                    </a>
                    <a href="/behavior-analytics.html" style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem; padding: 1.5rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.2)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-chart-line" style="font-size: 1.4rem; color: #f59e0b;"></i>
                        <span style="font-weight: 600;">Analytics</span>
                    </a>
                    <a href="/ar-vr-demo.html" style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem; padding: 1.5rem; background: rgba(6, 182, 212, 0.1); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s;" onmouseover="this.style.background='rgba(6, 182, 212, 0.2)'; this.style.transform='translateY(-4px)'" onmouseout="this.style.background='rgba(6, 182, 212, 0.1)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-vr-cardboard" style="font-size: 1.4rem; color: #06b6d4;"></i>
                        <span style="font-weight: 600;">AR/VR</span>
                    </a>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Export/Import Menu Functions
        function exportProjectsMenu() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 500px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-download" style="color: #10b981;"></i>
                            ÌîÑÎ°úÏ†ùÌä∏ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        ÌòÑÏû¨ ${allProjects.length}Í∞úÏùò ÌîÑÎ°úÏ†ùÌä∏Î•º ÎÇ¥Î≥¥ÎÇº Ïàò ÏûàÏäµÎãàÎã§.
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button onclick="exportJSON()" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-file-code" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">JSON ÌòïÏãù</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ (Í∞ÄÏ†∏Ïò§Í∏∞ Í∞ÄÎä•)</div>
                            </div>
                        </button>

                        <button onclick="exportCSV()" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-table" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">CSV ÌòïÏãù</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">ÏóëÏÖÄÏóêÏÑú Ïó¥Í∏∞ Í∞ÄÎä•Ìïú Î™©Î°ù</div>
                            </div>
                        </button>

                        <button onclick="exportExcel()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-file-excel" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">Excel ÌòïÏãù</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">ÏÉÅÏÑ∏ Î¶¨Ìè¨Ìä∏ Ìè¨Ìï® (.xlsx)</div>
                            </div>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function importProjectsMenu() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1e293b, #0f172a); padding: 2.5rem; border-radius: 20px; max-width: 500px; width: 90%; border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.75rem;">
                            <i class="fas fa-upload" style="color: #3b82f6;"></i>
                            ÌîÑÎ°úÏ†ùÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞
                        </h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.1rem; cursor: pointer;">‚úï</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        JSON Î∞±ÏóÖ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏó¨ ÌîÑÎ°úÏ†ùÌä∏Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.
                    </p>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button onclick="importJSON('skip')" style="background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-plus-circle" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î°ú Ï∂îÍ∞Ä</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Í∏∞Ï°¥ ÌîÑÎ°úÏ†ùÌä∏Îäî Ïú†ÏßÄ</div>
                            </div>
                        </button>

                        <button onclick="importJSON('replace')" style="background: linear-gradient(135deg, #f59e0b, #d97706); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-sync-alt" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">Ï§ëÎ≥µ Ïãú ÍµêÏ≤¥</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Í∞ôÏùÄ IDÎäî ÎçÆÏñ¥Ïì∞Í∏∞</div>
                            </div>
                        </button>

                        <button onclick="importJSON('merge')" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; padding: 1.25rem; border-radius: 12px; color: white; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 1rem; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-code-branch" style="font-size: 1.1rem;"></i>
                            <div style="text-align: left;">
                                <div style="font-size: 1.1rem;">Î≥ëÌï© Î™®Îìú</div>
                                <div style="font-size: 0.85rem; opacity: 0.8;">Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏôÄ Î≥ëÌï©</div>
                            </div>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function exportJSON() {
            document.querySelector('[style*="z-index: 10000"]')?.remove();
            await window.exportImportSystem.exportJSON(allProjects, {
                includeTasks: true,
                includeBudget: true,
                includeMetadata: true,
                includeTimestamps: true
            });
        }

        async function exportCSV() {
            document.querySelector('[style*="z-index: 10000"]')?.remove();
            await window.exportImportSystem.exportCSV(allProjects);
        }

        async function exportExcel() {
            await window.exportImportSystem.exportExcel(allProjects);
        }

        async function importJSON(mergeMode) {
            try {
                document.querySelector('[style*="z-index: 10000"]')?.remove();
                
                const file = await window.exportImportSystem.selectFile('.json');
                const result = await window.exportImportSystem.importJSON(file, { mergeMode });
                
                if (result.success) {
                    // ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                    setTimeout(() => {
                        loadProjects();
                    }, 1000);
                }
            } catch (error) {
                console.error('Import error:', error);
            }
        }
    </script>
    
    <!-- Error Logger -->
    <script src="/static/js/error-logger.js"></script>
    
    <!-- Notification Automation -->
    <script src="/static/js/notification-automation.js"></script>
    
    <!-- PWA Installer -->
    <script src="/static/js/pwa-installer.js"></script>
    
    <!-- Advanced Features -->
    <script src="/static/js/advanced-features.js"></script>
    
    <!-- Onboarding Tour -->
    <script src="/static/js/onboarding-tour.js"></script>
    <script>
        // Initialize onboarding tour for Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const tourSteps = [
                {
                    target: '.navbar',
                    icon: 'üéØ',
                    title: 'MuseFlowÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!',
                    description: 'Î∞ïÎ¨ºÍ¥Ä ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º AIÏôÄ Ìï®Íªò Í¥ÄÎ¶¨ÌïòÎäî Ïä§ÎßàÌä∏ ÌîåÎû´ÌèºÏûÖÎãàÎã§. Í∞ÑÎã®Ìïú Ìà¨Ïñ¥Î°ú Ï£ºÏöî Í∏∞Îä•ÏùÑ ÏïåÏïÑÎ≥¥ÏÑ∏Ïöî!'
                },
                {
                    target: '[onclick="showAIRecommendations()"]',
                    icon: 'ü§ñ',
                    title: 'AI Ï∂îÏ≤ú',
                    description: 'AIÍ∞Ä Í∏¥Í∏âÌïú ÌîÑÎ°úÏ†ùÌä∏, ÏòàÏÇ∞ Ï¥àÍ≥º, Ïû•Í∏∞ ÎØ∏ÏßÑÌñâ Îì±ÏùÑ ÏûêÎèôÏúºÎ°ú Î∂ÑÏÑùÌïòÏó¨ Ï∂îÏ≤úÌï¥ÎìúÎ¶ΩÎãàÎã§.'
                },
                {
                    target: '[onclick="filterFavorites()"]',
                    icon: '‚≠ê',
                    title: 'Ï¶êÍ≤®Ï∞æÍ∏∞',
                    description: 'Ï§ëÏöîÌïú ÌîÑÎ°úÏ†ùÌä∏Î•º Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Ï∂îÍ∞ÄÌïòÍ≥† Îπ†Î•¥Í≤å ÌïÑÌÑ∞ÎßÅÌï† Ïàò ÏûàÏäµÎãàÎã§.'
                },
                {
                    target: '#hero-mission',
                    icon: 'üìã',
                    title: 'Ïò§ÎäòÏùò ÌïµÏã¨ ÏóÖÎ¨¥',
                    description: 'Ïò§Îäò ÏßëÏ§ëÌï¥Ïïº Ìï† ÌîÑÎ°úÏ†ùÌä∏ÏôÄ Í∏¥Í∏â ÏïåÎ¶ºÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.'
                },
                {
                    target: '#projects-grid',
                    icon: 'üìÅ',
                    title: 'ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨',
                    description: 'Î™®Îì† ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïúÎààÏóê Î≥¥Í≥† Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§. Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî!'
                }
            ];
            
            onboardingTour.init(tourSteps);
        });
    </script>
    
    <!-- Genspark AI Search Functions (NEW) -->
    <script>
        // Set search query from suggestion buttons
        function setGensparkQuery(query) {
            const searchInput = document.getElementById('genspark-ai-search');
            if (searchInput) {
                searchInput.value = query;
                searchInput.focus();
            }
        }
        
        // Handle AI search
        async function handleGensparkSearch() {
            const searchInput = document.getElementById('genspark-ai-search');
            const query = searchInput ? searchInput.value.trim() : '';
            
            if (!query) {
                console.warn('Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            console.log('[Genspark AI] Search query:', query);
            
            // Show loading notification
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    `ü§ñ AI Ï≤òÎ¶¨ Ï§ë: "${query}"`, 
                    'info'
                );
            }
            
            try {
                // Determine the action based on query
                if (query.includes('ÎùºÎ≤®') || query.includes('label')) {
                    handleLabelGeneration(query);
                } else if (query.includes('Ïö∞ÏÑ†ÏàúÏúÑ') || query.includes('priority')) {
                    handlePriorityQuery(query);
                } else if (query.includes('SNS') || query.includes('ÏÜåÏÖú')) {
                    handleSNSGeneration(query);
                } else if (query.includes('Ïù¥Î©îÏùº') || query.includes('email')) {
                    handleEmailGeneration(query);
                } else if (query.includes('Î¶¨Ìè¨Ìä∏') || query.includes('report')) {
                    handleReportGeneration(query);
                } else {
                    // Generic AI query - show Google MCP modal
                    handleGenericAIQuery(query);
                }
            } catch (error) {
                console.error('[Genspark AI] Error:', error);
                if (window.notificationSystem) {
                    window.notificationSystem.showInAppNotification(
                        '‚ùå AI Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 
                        'error'
                    );
                }
            }
        }
        
        // Handle label generation
        function handleLabelGeneration(query) {
            console.log('[Genspark AI] Label generation:', query);
            // Open Google MCP modal for label generation
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üè∑Ô∏è Ï†ÑÏãú ÎùºÎ≤® ÏÉùÏÑ± Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê©ÎãàÎã§!', 
                    'success'
                );
            }
        }
        
        // Handle priority query
        function handlePriorityQuery(query) {
            console.log('[Genspark AI] Priority query:', query);
            // Scroll to mission section
            const missionSection = document.getElementById('hero-mission');
            if (missionSection) {
                missionSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                missionSection.style.animation = 'pulse 1s ease-in-out';
                setTimeout(() => {
                    missionSection.style.animation = '';
                }, 1000);
            }
            
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üéØ Ïò§ÎäòÏùò Ïö∞ÏÑ†ÏàúÏúÑ ÏûëÏóÖÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî!', 
                    'info'
                );
            }
        }
        
        // Handle SNS generation
        function handleSNSGeneration(query) {
            console.log('[Genspark AI] SNS generation:', query);
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üì± SNS ÏΩòÌÖêÏ∏† ÏÉùÏÑ± Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê©ÎãàÎã§!', 
                    'success'
                );
            }
        }
        
        // Handle email generation
        function handleEmailGeneration(query) {
            console.log('[Genspark AI] Email generation:', query);
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üìß Ïù¥Î©îÏùº Ï¥àÏïà ÏÉùÏÑ± Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê©ÎãàÎã§!', 
                    'success'
                );
            }
        }
        
        // Handle report generation
        function handleReportGeneration(query) {
            console.log('[Genspark AI] Report generation:', query);
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üìÑ ÏùºÏùº Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Í∏∞Îä•Ïù¥ Í≥ß Ï†úÍ≥µÎê©ÎãàÎã§!', 
                    'success'
                );
            }
        }
        
        // Handle generic AI query
        function handleGenericAIQuery(query) {
            console.log('[Genspark AI] Generic query:', query);
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    `ü§ñ AI Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏: "${query}" Ï≤òÎ¶¨ Ï§ë...`, 
                    'info'
                );
            }
            
            // Show Google MCP modal (will be implemented later)
            setTimeout(() => {
                if (window.notificationSystem) {
                    window.notificationSystem.showInAppNotification(
                        '‚ú® Google MCP ÌÜµÌï©Ïù¥ Í≥ß Ï†úÍ≥µÎê©ÎãàÎã§!', 
                        'success'
                    );
                }
            }, 1500);
        }
        
        // Open Google MCP interface
        function openGoogleMCP() {
            console.log('[Genspark AI] Opening Google MCP...');
            if (window.notificationSystem) {
                window.notificationSystem.showInAppNotification(
                    'üöÄ Google AI Studio ÌÜµÌï© ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§!', 
                    'info'
                );
            }
            
            // Redirect to Google MCP page (will be created)
            setTimeout(() => {
                window.location.href = '/google-mcp.html';
            }, 500);
        }
    </script>
    
    <!-- Minimalism Animations -->
    <script src="/static/js/dashboard-minimalism-animations.js"></script>
</body>
</html>
