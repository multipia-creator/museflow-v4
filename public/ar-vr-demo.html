<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR/VR Demo - MuseFlow V4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r170/three.min.js"></script>
    <script src="static/libs/three/GLTFLoader.js"></script>
    <script src="static/libs/three/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: radial-gradient(ellipse at top, #1e1b4b 0%, #0f0a1f 50%, #000000 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .neon-border {
            border: 2px solid;
            border-image: linear-gradient(135deg, #a78bfa, #ec4899) 1;
            box-shadow: 0 0 20px rgba(167, 139, 250, 0.4);
        }
        
        .model-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(167, 139, 250, 0.5);
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script src="/static/js/tracker.js"></script>
</head>
<body>
    <!-- Load Unified Navigation -->
    <!-- Header -->
    <header class="glass-card mx-4 mt-4 mb-0">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <img 
                        src="/static/images/logo-square.png" 
                        alt="MuseFlow" 
                        class="w-12 h-12 rounded-xl shadow-lg"
                        style="box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);"
                    />
                    <div>
                        <h1 class="text-2xl font-bold text-white">
                            <i class="fas fa-vr-cardboard mr-2 text-purple-400"></i>
                            AR/VR Experience
                        </h1>
                        <p class="text-purple-200 text-sm">Immersive Museum Tour</p>
                    </div>
                </div>
                <a href="/" class="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-all duration-300 font-medium">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Home
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Capability Check -->
        <div id="capability-check" class="glass-card p-6 mb-6 fade-in">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-check-circle mr-2 text-green-400"></i>
                Device Capabilities
            </h2>
            <div id="capability-status" class="space-y-2">
                <p class="text-purple-200">Checking WebXR support...</p>
            </div>
        </div>

        <!-- 3D Model Selection -->
        <div class="glass-card p-6 mb-6 fade-in">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-cube mr-2 text-blue-400"></i>
                Select 3D Cultural Heritage
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <button onclick="loadModel('sample1')" class="model-btn glass-card p-6 border-2 border-purple-500 border-opacity-30 rounded-2xl transition-all duration-300">
                    <i class="fas fa-vase text-5xl text-purple-400 mb-4"></i>
                    <p class="font-bold text-white text-lg mb-2">Korean Celadon</p>
                    <p class="text-sm text-purple-200">Traditional pottery masterpiece</p>
                </button>
                <button onclick="loadModel('sample2')" class="model-btn glass-card p-6 border-2 border-blue-500 border-opacity-30 rounded-2xl transition-all duration-300">
                    <i class="fas fa-monument text-5xl text-blue-400 mb-4"></i>
                    <p class="font-bold text-white text-lg mb-2">Stone Buddha</p>
                    <p class="text-sm text-purple-200">Ancient sacred sculpture</p>
                </button>
                <button onclick="loadModel('sample3')" class="model-btn glass-card p-6 border-2 border-yellow-500 border-opacity-30 rounded-2xl transition-all duration-300">
                    <i class="fas fa-crown text-5xl text-yellow-400 mb-4"></i>
                    <p class="font-bold text-white text-lg mb-2">Gold Crown</p>
                    <p class="text-sm text-purple-200">Silla Dynasty treasure</p>
                </button>
            </div>

            <!-- 3D Viewer -->
            <div id="viewer-container" class="relative bg-black rounded-2xl overflow-hidden border-2 border-purple-500 border-opacity-30" style="height: 500px;">
                <canvas id="viewer-canvas"></canvas>
                <div id="loading-indicator" class="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-purple-900 to-black bg-opacity-90">
                    <div class="text-center text-white">
                        <i class="fas fa-spinner fa-spin text-5xl mb-4 text-purple-400"></i>
                        <p class="text-xl font-medium">Loading 3D model...</p>
                        <p class="text-purple-300 text-sm mt-2">Please wait</p>
                    </div>
                </div>
            </div>

            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <button id="view-ar-btn" onclick="enterAR()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                    <i class="fas fa-mobile-alt mr-3 text-2xl"></i>
                    Launch AR Experience
                </button>
                <button id="view-vr-btn" onclick="enterVR()" class="bg-gradient-to-r from-purple-500 to-pink-600 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                    <i class="fas fa-vr-cardboard mr-3 text-2xl"></i>
                    Enter VR Museum
                </button>
            </div>
        </div>

        <!-- Feature Guide -->
        <div class="glass-card p-8 fade-in">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-info-circle mr-2 text-blue-400"></i>
                Experience Guide
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass-card p-6 border-2 border-green-500 border-opacity-30">
                    <h3 class="font-bold text-xl mb-4 text-white">
                        <i class="fas fa-mobile-alt mr-2 text-green-400"></i>
                        AR Mode (Mobile)
                    </h3>
                    <ul class="space-y-3 text-purple-100">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-400 mr-3 mt-1"></i>
                            <span>Requires AR-capable device (ARCore/ARKit)</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-400 mr-3 mt-1"></i>
                            <span>Point camera at flat surface</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-400 mr-3 mt-1"></i>
                            <span>Tap to place 3D cultural heritage</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-400 mr-3 mt-1"></i>
                            <span>Walk around to explore all angles</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-400 mr-3 mt-1"></i>
                            <span>Pinch to scale and examine details</span>
                        </li>
                    </ul>
                </div>
                <div class="glass-card p-6 border-2 border-purple-500 border-opacity-30">
                    <h3 class="font-bold text-xl mb-4 text-white">
                        <i class="fas fa-vr-cardboard mr-2 text-purple-400"></i>
                        VR Museum Mode
                    </h3>
                    <ul class="space-y-3 text-purple-100">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-purple-400 mr-3 mt-1"></i>
                            <span>Requires VR headset (Meta Quest, HTC Vive)</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-purple-400 mr-3 mt-1"></i>
                            <span>Fully immersive 3D museum environment</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-purple-400 mr-3 mt-1"></i>
                            <span>360Â° view by natural head movement</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-purple-400 mr-3 mt-1"></i>
                            <span>Hand controllers for interaction</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-purple-400 mr-3 mt-1"></i>
                            <span>Menu button to exit experience</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentModel = null;
        let arSupported = false;
        let vrSupported = false;

        // Check WebXR capabilities
        async function checkCapabilities() {
            try {
                const response = await fetch('/api/webxr/capabilities');
                const data = await response.json();

                if (data.success) {
                    const cap = data.capabilities;
                    arSupported = cap.arSupported;
                    vrSupported = cap.vrSupported;

                    const statusDiv = document.getElementById('capability-status');
                    statusDiv.innerHTML = `
                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex items-center ${arSupported ? 'text-green-600' : 'text-red-600'}">
                                <i class="fas ${arSupported ? 'fa-check-circle' : 'fa-times-circle'} mr-2"></i>
                                <span>AR Support: ${arSupported ? 'Available' : 'Not Available'}</span>
                            </div>
                            <div class="flex items-center ${vrSupported ? 'text-green-600' : 'text-red-600'}">
                                <i class="fas ${vrSupported ? 'fa-check-circle' : 'fa-times-circle'} mr-2"></i>
                                <span>VR Support: ${vrSupported ? 'Available' : 'Not Available'}</span>
                            </div>
                        </div>
                        ${cap.features && cap.features.length > 0 ? `
                        <div class="mt-4">
                            <p class="font-semibold text-gray-700 mb-2">Available Features:</p>
                            <div class="flex flex-wrap gap-2">
                                ${cap.features.map(f => `<span class="px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm">${f}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                    `;

                    // Enable/disable buttons
                    document.getElementById('view-ar-btn').disabled = !arSupported;
                    document.getElementById('view-vr-btn').disabled = !vrSupported;
                }
            } catch (error) {
                console.error('Failed to check capabilities:', error);
                document.getElementById('capability-status').innerHTML = `
                    <p class="text-red-600"><i class="fas fa-exclamation-triangle mr-2"></i>Failed to check WebXR capabilities</p>
                `;
            }
        }

        // Load 3D model (placeholder)
        function loadModel(modelId) {
            const loadingDiv = document.getElementById('loading-indicator');
            loadingDiv.style.display = 'flex';

            // Simulate loading
            setTimeout(() => {
                currentModel = modelId;
                loadingDiv.style.display = 'none';
                console.log(`Model "${modelId}" loaded!\n\nNote: This is a demo. In production, actual 3D models from KCISA API would be loaded using Three.js.`);
            }, 1000);
        }

        // Enter AR mode
        async function enterAR() {
            if (!arSupported) {
                console.log('AR is not supported on this device.');
                return;
            }

            if (!currentModel) {
                console.log('Please select a 3D model first.');
                return;
            }

            try {
                console.log('Starting AR session...\n\nNote: In production, this would initialize WebXR AR session and allow you to place the model in your physical space.');
                
                // In production, this would call:
                // const response = await fetch('/api/webxr/session/ar', { method: 'POST', ... });
            } catch (error) {
                console.error('Failed to start AR:', error);
                console.log('Failed to start AR session.');
            }
        }

        // Enter VR mode
        async function enterVR() {
            if (!vrSupported) {
                console.log('VR is not supported on this device.');
                return;
            }

            if (!currentModel) {
                console.log('Please select a 3D model first.');
                return;
            }

            try {
                console.log('Entering VR mode...\n\nNote: In production, this would launch an immersive VR environment where you can explore the 3D model in virtual reality.');
                
                // In production, this would call:
                // const response = await fetch('/api/webxr/session/vr', { method: 'POST', ... });
            } catch (error) {
                console.error('Failed to start VR:', error);
                console.log('Failed to enter VR mode.');
            }
        }

        // Initialize
        checkCapabilities();
    </script>
</body>
</html>
