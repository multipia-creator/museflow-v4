<!-- MuseFlow Unified Navigation Bar Component - V10.5.1 -->
<!-- Styles moved to /static/css/unified-navbar.css to prevent conflicts -->

<nav class="unified-navbar">
    <div class="unified-nav-container">
        <!-- Logo -->
        <a href="/landing.html" class="unified-nav-logo">
            <img src="/static/images/logo-neon-m.png" alt="MuseFlow" loading="lazy">
            <span>MuseFlow</span>
        </a>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="메뉴 열기/닫기">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Main Navigation - Icon Only -->
        <ul class="unified-nav-links" id="unifiedNavLinks">
            <li><a href="/landing.html" data-page="home" data-tooltip="Home">
                <i class="fas fa-home"></i>
            </a></li>
            <li><a href="/dashboard.html" data-page="dashboard" data-tooltip="Dashboard">
                <i class="fas fa-chart-line"></i>
            </a></li>
            <li><a href="/canvas-v4-hybrid.html" data-page="canvas" data-tooltip="Canvas">
                <i class="fas fa-project-diagram"></i>
            </a></li>
            <li><a href="/workflow-tools.html" data-page="workflow" data-tooltip="Tools">
                <i class="fas fa-tools"></i>
            </a></li>
            <li><a href="/budget.html" data-page="budget" data-tooltip="Budget">
                <i class="fas fa-dollar-sign"></i>
            </a></li>
            <li><a href="/analytics-dashboard.html" data-page="analytics" data-tooltip="Analytics">
                <i class="fas fa-chart-bar"></i>
            </a></li>
            <li><a href="/google-mcp.html" data-page="google-mcp" data-tooltip="Google AI">
                <i class="fab fa-google"></i>
            </a></li>
        </ul>
        
        <!-- Actions - Icon Only -->
        <div class="unified-nav-actions">
            <!-- Dashboard-specific controls (visible only on dashboard-v2) -->
            <div id="dashboard-controls" style="display: none; align-items: center; gap: 0.5rem; margin-right: 1rem;">
                <!-- Theme Toggle -->
                <button class="unified-nav-btn" onclick="toggleTheme && toggleTheme()" data-tooltip="테마 전환" id="navThemeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                
                <!-- Edit Mode Toggle -->
                <button class="unified-nav-btn primary" onclick="toggleEditMode && toggleEditMode()" data-tooltip="편집 모드" id="navEditModeBtn">
                    <i class="fas fa-edit"></i>
                </button>
                
                <!-- Edit Mode Actions (visible only in edit mode) -->
                <div id="navEditModeActions" style="display: none; align-items: center; gap: 0.5rem;">
                    <button class="unified-nav-btn" onclick="openWidgetLibrary && openWidgetLibrary()" data-tooltip="위젯 추가">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="unified-nav-btn" onclick="saveLayout && saveLayout()" data-tooltip="저장">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="unified-nav-btn" onclick="resetLayout && resetLayout()" data-tooltip="초기화">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
            </div>
            
            <!-- AI Recommendations -->
            <button class="unified-nav-btn primary" onclick="showAIRecommendations()" data-tooltip="AI 추천">
                <i class="fas fa-robot"></i>
            </button>
            
            <!-- Favorites -->
            <button class="unified-nav-btn" onclick="filterFavorites()" data-tooltip="즐겨찾기">
                <i class="fas fa-star"></i>
            </button>
            
            <!-- Notifications -->
            <button class="unified-nav-btn" onclick="toggleNotifications()" data-tooltip="알림">
                <i class="fas fa-bell"></i>
            </button>
            
            <!-- Help -->
            <a href="/help-center.html" class="unified-nav-btn" data-tooltip="도움말">
                <i class="fas fa-question-circle"></i>
            </a>
            
            <!-- Settings -->
            <a href="/account.html" class="unified-nav-btn" data-tooltip="설정">
                <i class="fas fa-cog"></i>
            </a>
            
            <!-- Account -->
            <a href="/account.html" class="unified-nav-btn" data-tooltip="내 계정">
                <i class="fas fa-user"></i>
            </a>
        </div>
    </div>
</nav>

<script>
    // Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const unifiedNavLinks = document.getElementById('unifiedNavLinks');
    
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            unifiedNavLinks.classList.toggle('mobile-open');
            
            // Change icon
            const icon = this.querySelector('i');
            if (unifiedNavLinks.classList.contains('mobile-open')) {
                icon.className = 'fas fa-times';
            } else {
                icon.className = 'fas fa-bars';
            }
        });
        
        // Close menu when clicking a link
        document.querySelectorAll('.unified-nav-links a').forEach(link => {
            link.addEventListener('click', function() {
                unifiedNavLinks.classList.remove('mobile-open');
                mobileMenuToggle.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                icon.className = 'fas fa-bars';
            });
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.unified-navbar')) {
                unifiedNavLinks.classList.remove('mobile-open');
                mobileMenuToggle.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (icon) icon.className = 'fas fa-bars';
            }
        });
    }
    
    // Auto-highlight active page
    document.addEventListener('DOMContentLoaded', function() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.unified-nav-links a');
        
        navLinks.forEach(link => {
            const page = link.getAttribute('data-page');
            if (currentPath.includes(page) || 
                (page === 'home' && (currentPath === '/' || currentPath === '/index.html')) ||
                (page === 'dashboard' && currentPath.includes('dashboard')) ||
                (page === 'canvas' && currentPath.includes('canvas')) ||
                (page === 'workflow' && currentPath.includes('workflow')) ||
                (page === 'budget' && currentPath.includes('budget')) ||
                (page === 'analytics' && currentPath.includes('analytics')) ||
                (page === 'google-mcp' && currentPath.includes('google-mcp'))) {
                link.classList.add('active');
            }
        });
        
        // Add padding to body to account for fixed navbar
        document.body.style.paddingTop = '80px';
    });
    
    // Fallback functions if not defined on page
    window.showAIRecommendations = window.showAIRecommendations || function() {
        console.log('[Navbar] AI Recommendations clicked');
        if (window.location.pathname.includes('dashboard')) {
            // If on dashboard, trigger AI recommendations
            if (window.showAIProjectRecommendations) {
                window.showAIProjectRecommendations();
            }
        } else {
            window.location.href = '/dashboard.html';
        }
    };
    
    window.filterFavorites = window.filterFavorites || function() {
        console.log('[Navbar] Favorites clicked');
        if (window.location.pathname.includes('dashboard')) {
            // If on dashboard, trigger favorites filter
            if (window.toggleFavoritesFilter) {
                window.toggleFavoritesFilter();
            }
        } else {
            window.location.href = '/dashboard.html';
        }
    };
    
    window.toggleNotifications = window.toggleNotifications || function() {
        console.log('[Navbar] Notifications clicked');
        if (window.notificationSystem) {
            window.notificationSystem.showInAppNotification('알림 센터', 'info');
        } else {
            console.log('알림 센터가 곧 열립니다.');
        }
    };
    
    // Scroll Animation - Hide/Show Navbar
    let lastScrollTop = 0;
    let scrollTimeout;
    
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.unified-navbar');
        if (!navbar) return;
        
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        
        // Add scrolled class for shadow effect
        if (currentScroll > 50) {
            navbar.classList.add('navbar-scrolled');
        } else {
            navbar.classList.remove('navbar-scrolled');
        }
        
        // Hide navbar on scroll down, show on scroll up
        if (currentScroll > lastScrollTop && currentScroll > 100) {
            navbar.classList.add('navbar-hidden');
        } else {
            navbar.classList.remove('navbar-hidden');
        }
        
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
        
        // Show navbar when user stops scrolling
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
            navbar.classList.remove('navbar-hidden');
        }, 1500);
    });
    
    // Page Transition Animation
    document.querySelectorAll('.unified-nav-links a, .unified-nav-logo').forEach(link => {
        link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            
            // Skip animation for external links or anchors
            if (!href || href.startsWith('#') || href.startsWith('http')) {
                return;
            }
            
            e.preventDefault();
            
            // Add fade-out animation
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.3s ease';
            
            // Navigate after animation
            setTimeout(() => {
                window.location.href = href;
            }, 300);
        });
    });
    
    // Fade-in animation on page load
    document.addEventListener('DOMContentLoaded', function() {
        document.body.style.opacity = '0';
        requestAnimationFrame(() => {
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '1';
        });
        
        // Show dashboard controls if on dashboard-v2 page
        if (window.location.pathname.includes('dashboard-v2')) {
            const dashboardControls = document.getElementById('dashboard-controls');
            if (dashboardControls) {
                dashboardControls.style.display = 'flex';
            }
        }
    });
</script>
